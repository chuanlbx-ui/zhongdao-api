# âœ¨ è¿œç¨‹å¼€å‘æ–¹æ¡ˆå·²å®Œæˆé…ç½®

## ğŸ‰ ä½ ç°åœ¨æ‹¥æœ‰çš„åŠŸèƒ½

### âœ… å·²ä¸ºä½ åˆ›å»ºçš„æ–‡ä»¶

1. **`ecosystem.config.js`** - PM2è¿›ç¨‹ç®¡ç†é…ç½®
   - é…ç½®3ä¸ªæœåŠ¡ï¼šzd-apiã€zd-h5ã€zd-admin
   - å¯ç”¨æ–‡ä»¶ç›‘å¬ï¼ˆçƒ­é‡è½½ï¼‰
   - é›†ç¾¤æ¨¡å¼è¿è¡Œ
   - è‡ªåŠ¨é‡å¯å’Œæ—¥å¿—ç®¡ç†

2. **`scripts/deploy-to-server.sh`** - å®Œæ•´éƒ¨ç½²è„šæœ¬
   - è‡ªåŠ¨æ‹‰å–æœ€æ–°ä»£ç ï¼ˆGitï¼‰
   - å®‰è£…ç”Ÿäº§ä¾èµ–
   - TypeScriptç¼–è¯‘
   - PM2å¯åŠ¨å’Œé…ç½®
   - å¼€æœºè‡ªå¯è®¾ç½®

3. **`scripts/check-deploy.sh`** - éƒ¨ç½²çŠ¶æ€æ£€æŸ¥è„šæœ¬
   - ç¯å¢ƒå˜é‡æ£€æŸ¥
   - PM2è¿›ç¨‹çŠ¶æ€
   - æœåŠ¡å¥åº·æ£€æŸ¥
   - æ—¥å¿—æŸ¥çœ‹

4. **`.remote.json`** - è¿œç¨‹æœåŠ¡å™¨é…ç½®
   - æœåŠ¡å™¨åœ°å€ï¼š162.14.114.224
   - SSHç”¨æˆ·ï¼šroot
   - é¡¹ç›®è·¯å¾„ï¼š3ä¸ªé¡¹ç›®è·¯å¾„

5. **`deploy-remote.bat`** - Windowsæ‰¹å¤„ç†è„šæœ¬
   - åŒå‡»è¿è¡Œå³å¯éƒ¨ç½²
   - è‡ªåŠ¨ä¸Šä¼ é…ç½®æ–‡ä»¶
   - è‡ªåŠ¨æ‰§è¡Œéƒ¨ç½²è„šæœ¬

6. **`deploy-remote.ps1`** - PowerShellè„šæœ¬
   - PowerShellç”¨æˆ·å¯ç›´æ¥è¿è¡Œ

7. **`scripts/remote-exec.ts`** - è¿œç¨‹å‘½ä»¤æ‰§è¡Œå·¥å…·
   - å¯æ‰§è¡Œä»»æ„è¿œç¨‹å‘½ä»¤

8. **`REMOTE-DEPLOY-GUIDE.md`** - å®Œæ•´éƒ¨ç½²æŒ‡å—
   - è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜
   - æ•…éšœæ’é™¤
   - æœ€ä½³å®è·µ

9. **`package.json`** - æ›´æ–°äº†npmå‘½ä»¤
   - `npm run remote:deploy` - ä¸€é”®éƒ¨ç½²
   - `npm run remote:status` - æŸ¥çœ‹çŠ¶æ€
   - `npm run remote:logs` - æŸ¥çœ‹æ—¥å¿—
   - `npm run remote:restart` - é‡å¯æœåŠ¡

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆä¸‰é€‰ä¸€ï¼‰

### **æ–¹å¼1ï¸âƒ£ï¼šWindowsç”¨æˆ·ï¼ˆæœ€ç®€å•ï¼‰**
```bash
# 1. åŒå‡»è¿è¡Œè¿™ä¸ªæ–‡ä»¶
deploy-remote.bat

# æˆ–è€…åœ¨CMD/PowerShellä¸­è¿è¡Œ
cd d:\wwwroot\zhongdao-mall
deploy-remote.bat
```

### **æ–¹å¼2ï¸âƒ£ï¼šä½¿ç”¨npmå‘½ä»¤ï¼ˆæ¨èï¼‰**
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd d:\wwwroot\zhongdao-mall

# ä¸€é”®éƒ¨ç½²
npm run remote:deploy

# æŸ¥çœ‹çŠ¶æ€
npm run remote:status

# æŸ¥çœ‹æ—¥å¿—
npm run remote:logs

# é‡å¯æœåŠ¡
npm run remote:restart
```

### **æ–¹å¼3ï¸âƒ£ï¼šç›´æ¥SSHå‘½ä»¤**
```bash
# ç™»å½•æœåŠ¡å™¨
ssh root@162.14.114.224

# æ‰§è¡Œéƒ¨ç½²è„šæœ¬
bash /www/wwwroot/zd-api.wenbita.cn/deploy-to-server.sh

# æŸ¥çœ‹çŠ¶æ€
bash /www/wwwroot/zd-api.wenbita.cn/check-deploy.sh
```

---

## ğŸ“ å…¸å‹å·¥ä½œæµ

### æ—¥å¸¸å¼€å‘å¾ªç¯ï¼š

```
1. ä¿®æ”¹æœ¬åœ°ä»£ç ï¼ˆsrc/ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼‰
   â†“
2. Gitæäº¤ï¼šgit add . && git commit -m "ä¿®å¤xx"
   â†“
3. ä¸€é”®éƒ¨ç½²ï¼šnpm run remote:deploy
   â†“
4. æŸ¥çœ‹ç»“æœï¼šnpm run remote:status
   â†“
5. æ£€æŸ¥æ—¥å¿—ï¼šnpm run remote:logs
```

---

## ğŸ”¥ å…³é”®ç‰¹æ€§

### âœ¨ çƒ­é‡è½½
- ä¿®æ”¹ `src/` ç›®å½•çš„æ–‡ä»¶åï¼ŒPM2ä¼šè‡ªåŠ¨ï¼š
  1. æ£€æµ‹åˆ°æ–‡ä»¶å˜åŒ–
  2. è‡ªåŠ¨ç¼–è¯‘TypeScript
  3. è‡ªåŠ¨é‡å¯Nodeè¿›ç¨‹
  4. æœåŠ¡æ— éœ€åœæ­¢

### ğŸ”„ è‡ªåŠ¨éƒ¨ç½²
- `npm run remote:deploy` ä¸€ä¸ªå‘½ä»¤ï¼š
  1. ä¸Šä¼ æ‰€æœ‰é…ç½®æ–‡ä»¶
  2. æ‹‰å–æœ€æ–°Gitä»£ç 
  3. å®‰è£…ä¾èµ–
  4. ç¼–è¯‘é¡¹ç›®
  5. å¯åŠ¨PM2æœåŠ¡

### ğŸ“Š å®Œæ•´ç›‘æ§
- `npm run remote:status` æ˜¾ç¤ºï¼š
  - ç¯å¢ƒå˜é‡çŠ¶æ€
  - PM2è¿›ç¨‹çŠ¶æ€
  - APIå¥åº·æ£€æŸ¥
  - æ—¥å¿—æ‘˜è¦

### ğŸ›¡ï¸ å®‰å…¨æ€§
- æœåŠ¡å™¨ä¿¡æ¯ä¿å­˜åœ¨ `.remote.json`ï¼ˆä¸è¦ä¸Šä¼ åˆ°Gitï¼‰
- æ”¯æŒSSHå¯†é’¥è®¤è¯
- è‡ªåŠ¨è®¾ç½®å¼€æœºè‡ªå¯

---

## ğŸ“ æœåŠ¡åœ°å€

éƒ¨ç½²å®Œæˆåï¼Œä½ å¯ä»¥è®¿é—®ï¼š

```
ğŸŒ APIæœåŠ¡
   https://zd-api.wenbita.cn
   å†…éƒ¨ç«¯å£ï¼š3000

ğŸŒ H5å‰ç«¯
   https://zd-h5.wenbita.cn
   å†…éƒ¨ç«¯å£ï¼š3001

ğŸŒ ç®¡ç†åå°
   https://zd-admin.wenbita.cn
   å†…éƒ¨ç«¯å£ï¼š3002
```

---

## ğŸ¯ å¸¸è§æ“ä½œ

### æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹
```bash
ssh root@162.14.114.224 "pm2 list"
```

### æŸ¥çœ‹APIæ—¥å¿—ï¼ˆæœ€å100è¡Œï¼‰
```bash
ssh root@162.14.114.224 "pm2 logs zd-api --lines 100"
```

### å®æ—¶ç›‘æ§èµ„æºä½¿ç”¨
```bash
ssh root@162.14.114.224 "pm2 monit"
```

### é‡å¯APIæœåŠ¡
```bash
ssh root@162.14.114.224 "pm2 restart zd-api"
```

### åœæ­¢æ‰€æœ‰æœåŠ¡
```bash
ssh root@162.14.114.224 "pm2 stop all"
```

### å¯åŠ¨æ‰€æœ‰æœåŠ¡
```bash
ssh root@162.14.114.224 "pm2 start all"
```

---

## ğŸš¨ å¦‚æœå‡ºç°é—®é¢˜

### 1. SSHè¿æ¥å¤±è´¥
- Windowséœ€è¦è£…Git Bashæˆ–OpenSSH
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- æ£€æŸ¥æœåŠ¡å™¨IPæ˜¯å¦æ­£ç¡®

### 2. PM2æ‰¾ä¸åˆ°è„šæœ¬
```bash
npm run remote:deploy  # é‡æ–°éƒ¨ç½²ä¸€æ¬¡
```

### 3. æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
```bash
npm run remote:logs    # æŸ¥çœ‹å®æ—¶æ—¥å¿—
```

---

## ğŸ’¡ ä¸‹ä¸€æ­¥å»ºè®®

1. **é¦–æ¬¡éƒ¨ç½²**ï¼šè¿è¡Œ `npm run remote:deploy`

2. **éªŒè¯éƒ¨ç½²**ï¼šè¿è¡Œ `npm run remote:status`

3. **æŸ¥çœ‹æ—¥å¿—**ï¼šè¿è¡Œ `npm run remote:logs`

4. **æµ‹è¯•API**ï¼šè®¿é—® https://zd-api.wenbita.cn/health

5. **å®šæœŸæ£€æŸ¥**ï¼šæ¯å¤©æ£€æŸ¥ `npm run remote:status`

---

## ğŸ“š å®Œæ•´æ–‡æ¡£

è¯¦ç»†ä½¿ç”¨è¯´æ˜è¯·æŸ¥çœ‹ï¼š**`REMOTE-DEPLOY-GUIDE.md`**

---

## âœ… é…ç½®æ¸…å•

- âœ… PM2é…ç½®æ–‡ä»¶å·²åˆ›å»ºï¼ˆ`ecosystem.config.js`ï¼‰
- âœ… éƒ¨ç½²è„šæœ¬å·²åˆ›å»ºï¼ˆ`scripts/deploy-to-server.sh`ï¼‰
- âœ… æ£€æŸ¥è„šæœ¬å·²åˆ›å»ºï¼ˆ`scripts/check-deploy.sh`ï¼‰
- âœ… è¿œç¨‹é…ç½®å·²ä¿å­˜ï¼ˆ`.remote.json`ï¼‰
- âœ… Windowséƒ¨ç½²è„šæœ¬å·²åˆ›å»ºï¼ˆ`deploy-remote.bat`ï¼‰
- âœ… npmå‘½ä»¤å·²æ·»åŠ åˆ° `package.json`
- âœ… å®Œæ•´æŒ‡å—å·²ç¼–å†™ï¼ˆ`REMOTE-DEPLOY-GUIDE.md`ï¼‰

---

**ç°åœ¨ä¸€åˆ‡å°±ç»ªï¼ğŸš€ ä½ å¯ä»¥å¼€å§‹ä½¿ç”¨äº†ï¼**

```bash
npm run remote:deploy
```

ç¥éƒ¨ç½²é¡ºåˆ©ï¼ğŸ‰
