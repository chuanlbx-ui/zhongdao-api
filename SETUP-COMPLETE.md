📋 远程开发部署方案 - 完整总结

═══════════════════════════════════════════════════════════════

✨ 为你创建的完整套件

1. 配置文件
   └─ ecosystem.config.js
      - PM2进程管理配置
      - 3个服务配置（API、H5、后台）
      - 文件监听和热重载
      - 自动重启和日志管理

2. 部署脚本
   ├─ scripts/deploy-to-server.sh
   │  └─ 完整的自动化部署脚本
   │     • Git代码更新
   │     • 依赖安装
   │     • TypeScript编译
   │     • PM2启动配置
   │     • 开机自启设置
   │
   ├─ scripts/check-deploy.sh
   │  └─ 部署状态检查脚本
   │     • 环境变量检查
   │     • PM2进程状态
   │     • 服务健康检查
   │     • 日志查看
   │
   └─ scripts/remote-exec.ts
      └─ 远程命令执行工具

3. 操作系统脚本
   ├─ deploy-remote.bat (Windows)
   │  └─ 双击运行即可部署
   │
   └─ deploy-remote.ps1 (PowerShell)
      └─ PowerShell用户可用

4. 配置管理
   ├─ .remote.json
   │  └─ 服务器连接信息
   │     • 主机：162.14.114.224
   │     • 用户：root
   │     • 项目路径配置
   │
   └─ package.json (已更新)
      └─ 新增npm命令
         • npm run remote:deploy
         • npm run remote:status
         • npm run remote:logs
         • npm run remote:restart

5. 文档
   ├─ REMOTE-DEPLOY-GUIDE.md
   │  └─ 346行详细指南
   │     • 完整使用说明
   │     • 故障排除方案
   │     • 最佳实践建议
   │
   ├─ DEPLOYMENT-READY.md
   │  └─ 部署准备清单和快速开始
   │
   └─ QUICK-REFERENCE.txt
      └─ 快速参考卡片

═══════════════════════════════════════════════════════════════

🚀 立即开始使用

【最简单方式 - Windows用户】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
双击运行：deploy-remote.bat
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【推荐方式 - npm命令】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# 一键部署（第一次必须执行）
npm run remote:deploy

# 查看部署状态
npm run remote:status

# 查看实时日志
npm run remote:logs

# 重启服务
npm run remote:restart
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【高级方式 - 直接SSH】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
ssh root@162.14.114.224
bash /www/wwwroot/zd-api.wenbita.cn/deploy-to-server.sh
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

═══════════════════════════════════════════════════════════════

💡 工作流程

【日常开发流程】
┌─────────────────┐
│  修改本地代码    │
│  (src目录)       │
└────────┬────────┘
         │
         ↓
┌─────────────────┐
│  Git提交代码    │
│  git add .      │
│  git commit -m  │
└────────┬────────┘
         │
         ↓
┌─────────────────┐
│  一键部署       │
│ npm run remote  │
│    :deploy      │
└────────┬────────┘
         │
         ↓
┌─────────────────┐
│  检查部署结果   │
│ npm run remote  │
│    :status      │
└─────────────────┘

═══════════════════════════════════════════════════════════════

🔥 关键特性

✨ 热重载
   • 修改src/目录的文件
   • PM2自动检测并重新编译
   • 服务自动重启
   • 无需手动操作

🔄 自动化部署
   • 一个命令完成所有步骤
   • 代码更新、依赖安装、编译、启动
   • 包含开机自启配置

📊 完整监控
   • 实时进程状态
   • 服务健康检查
   • 日志实时输出
   • 资源使用情况

🛡️ 生产级别
   • 集群模式运行
   • 自动故障重启
   • 日志完整记录
   • 开机自启支持

═══════════════════════════════════════════════════════════════

📍 部署信息一览

服务器地址：162.14.114.224
SSH用户：root

API服务
  路径：/www/wwwroot/zd-api.wenbita.cn
  域名：https://zd-api.wenbita.cn
  端口：3000 (内部) / 443 (HTTPS)
  进程名：zd-api

H5前端
  路径：/www/wwwroot/zd-h5.wenbita.cn
  域名：https://zd-h5.wenbita.cn
  端口：3001 (内部) / 443 (HTTPS)
  进程名：zd-h5

管理后台
  路径：/www/wwwroot/zd-admin.wenbita.cn
  域名：https://zd-admin.wenbita.cn
  端口：3002 (内部) / 443 (HTTPS)
  进程名：zd-admin

═══════════════════════════════════════════════════════════════

📚 文档指南

快速开始：
  👉 QUICK-REFERENCE.txt
     快速参考卡片，常用命令一览

详细使用：
  👉 REMOTE-DEPLOY-GUIDE.md
     完整的部署和操作指南

部署准备：
  👉 DEPLOYMENT-READY.md
     部署配置清单和建议

配置详情：
  👉 ecosystem.config.js
     PM2完整配置说明

═══════════════════════════════════════════════════════════════

🎯 常见操作

【查看服务状态】
npm run remote:status

【查看实时日志】
npm run remote:logs

【重启API服务】
npm run remote:restart

【SSH登录服务器】
ssh root@162.14.114.224

【查看PM2进程列表】
ssh root@162.14.114.224 "pm2 list"

【查看API日志（最后100行）】
ssh root@162.14.114.224 "pm2 logs zd-api --lines 100"

【监控资源使用】
ssh root@162.14.114.224 "pm2 monit"

═══════════════════════════════════════════════════════════════

🆘 故障排除

问题：SSH连接失败
解决：Windows安装Git Bash或OpenSSH

问题：PM2启动失败
解决：运行 npm run remote:deploy 重新部署

问题：服务无响应
解决：运行 npm run remote:logs 查看日志

问题：修改代码后不生效
解决：确保已git提交，运行 npm run remote:deploy

═══════════════════════════════════════════════════════════════

✅ 首次部署检查清单

☐ 确认服务器IP：162.14.114.224
☐ 确认SSH用户：root
☐ 确认项目路径：/www/wwwroot/zd-api.wenbita.cn
☐ 确认本地代码已提交到Git
☐ 运行：npm run remote:deploy
☐ 运行：npm run remote:status 确认成功
☐ 访问：https://zd-api.wenbita.cn/health 检查API

═══════════════════════════════════════════════════════════════

💬 技术支持

问题排查步骤：
1. 查看实时日志：npm run remote:logs
2. 检查服务状态：npm run remote:status
3. SSH登录查看详细错误：ssh root@162.14.114.224
4. 参考完整文档：REMOTE-DEPLOY-GUIDE.md

═══════════════════════════════════════════════════════════════

🎓 最佳实践

✓ 每次修改前在本地测试：npm run dev
✓ 使用Git管理版本
✓ 定期检查服务状态：npm run remote:status
✓ 监控日志发现问题：npm run remote:logs
✓ 保持代码和部署脚本同步

═══════════════════════════════════════════════════════════════

🎉 祝贺！

你现在拥有了一套完整的远程开发部署系统！

随时可以：
  • 修改代码 → 一键部署
  • 监控日志 → 实时反馈
  • 管理服务 → 完整控制

立即开始：npm run remote:deploy

═══════════════════════════════════════════════════════════════
最后更新：2025年11月26日
远程开发系统 v1.0
═══════════════════════════════════════════════════════════════
