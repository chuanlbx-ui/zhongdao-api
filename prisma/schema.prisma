generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model admins {
  id             String        @id
  username       String        @unique
  password       String
  real_name      String?
  email          String?
  phone          String?
  avatar         String?
  role           admins_role   @default(ADMIN)
  status         admins_status @default(ACTIVE)
  last_login_at  DateTime?
  last_login_ip  String?
  permissions    Json?
  login_attempts Int           @default(0)
  locked_until   DateTime?
  created_at     DateTime      @default(now())
  updated_at     DateTime
}

model commission_calculations {
  id                  String                         @id
  user_id             String
  period              String
  total_commission    Float                          @default(0)
  personal_commission Float                          @default(0)
  team_commission     Float                          @default(0)
  referral_commission Float                          @default(0)
  bonus_commission    Float                          @default(0)
  status              commission_calculations_status @default(PENDING)
  paid_date           DateTime?
  calculated_at       DateTime                       @default(now())
  created_at          DateTime                       @default(now())
  updated_at          DateTime
  users               users                          @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([calculated_at])
  @@index([period])
  @@index([status])
  @@index([user_id], map: "commission_calculations_user_id_fkey")
  @@index([user_id, period], map: "commission_calculations_user_period_idx")
}

model gift_records {
  id           String              @id
  user_id      String
  order_id     String
  product_id   String
  quantity     Int
  value        Float
  type         gift_records_type
  status       gift_records_status @default(PENDING)
  metadata     Json?
  remarks      String?
  created_at   DateTime            @default(now())
  updated_at   DateTime
  shipped_at   DateTime?
  completed_at DateTime?
  orders       orders              @relation(fields: [order_id], references: [id])
  products     products            @relation(fields: [product_id], references: [id])
  users        users               @relation(fields: [user_id], references: [id])

  @@index([order_id], map: "gift_records_order_id_fkey")
  @@index([product_id], map: "gift_records_product_id_fkey")
  @@index([user_id], map: "gift_records_user_id_fkey")
}

model inventory_alerts {
  id                                        String                          @id
  user_id                                   String
  product_id                                String
  spec_id                                   String?
  shop_id                                   String?
  alert_type                                inventory_alerts_alert_type
  current_quantity                          Int
  threshold                                 Int
  warehouse_type                            inventory_alerts_warehouse_type
  is_read                                   Boolean                         @default(false)
  is_resolved                               Boolean                         @default(false)
  resolved_at                               DateTime?
  resolved_by                               String?
  resolve_note                              String?
  notification_sent                         Boolean                         @default(false)
  last_notified_at                          DateTime?
  created_at                                DateTime                        @default(now())
  updated_at                                DateTime
  products                                  products                        @relation(fields: [product_id], references: [id])
  users_inventory_alerts_resolved_byTousers users?                          @relation("inventory_alerts_resolved_byTousers", fields: [resolved_by], references: [id])
  shops                                     shops?                          @relation(fields: [shop_id], references: [id])
  product_specs                             product_specs?                  @relation(fields: [spec_id], references: [id])
  users_inventory_alerts_user_idTousers     users                           @relation("inventory_alerts_user_idTousers", fields: [user_id], references: [id])

  @@index([product_id], map: "inventory_alerts_product_id_fkey")
  @@index([resolved_by], map: "inventory_alerts_resolved_by_fkey")
  @@index([shop_id], map: "inventory_alerts_shop_id_fkey")
  @@index([spec_id], map: "inventory_alerts_spec_id_fkey")
  @@index([user_id], map: "inventory_alerts_user_id_fkey")
}

model inventory_items {
  id              String                         @id
  user_id         String
  product_id      String
  spec_id         String?
  shop_id         String?
  warehouse_type  inventory_items_warehouse_type
  quantity        Int                            @default(0)
  frozen_quantity Int                            @default(0)
  min_stock       Int                            @default(10)
  last_in_at      DateTime?
  last_out_at     DateTime?
  last_alert_at   DateTime?
  alert_count     Int                            @default(0)
  created_at      DateTime                       @default(now())
  updated_at      DateTime
  products        products                       @relation(fields: [product_id], references: [id])
  shops           shops?                         @relation(fields: [shop_id], references: [id])
  product_specs   product_specs?                 @relation(fields: [spec_id], references: [id])
  users           users                          @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, product_id, spec_id, warehouse_type])
  @@index([product_id], map: "inventory_items_product_id_fkey")
  @@index([shop_id], map: "inventory_items_shop_id_fkey")
  @@index([spec_id], map: "inventory_items_spec_id_fkey")
}

model inventory_logs {
  id                                      String                        @id
  user_id                                 String
  product_id                              String
  spec_id                                 String?
  shop_id                                 String?
  operation_type                          inventory_logs_operation_type
  quantity                                Int
  quantity_before                         Int
  quantity_after                          Int
  warehouse_type                          inventory_logs_warehouse_type
  related_order_id                        String?
  related_purchase_id                     String?
  adjustment_reason                       String?
  operator_id                             String
  operator_type                           inventory_logs_operator_type
  remarks                                 String?
  created_at                              DateTime                      @default(now())
  users_inventory_logs_operator_idTousers users                         @relation("inventory_logs_operator_idTousers", fields: [operator_id], references: [id])
  products                                products                      @relation(fields: [product_id], references: [id])
  shops                                   shops?                        @relation(fields: [shop_id], references: [id])
  product_specs                           product_specs?                @relation(fields: [spec_id], references: [id])
  users_inventory_logs_user_idTousers     users                         @relation("inventory_logs_user_idTousers", fields: [user_id], references: [id])

  @@index([created_at])
  @@index([created_at, user_id], map: "inventory_logs_date_user_idx")
  @@index([operator_id], map: "inventory_logs_operator_id_fkey")
  @@index([product_id], map: "inventory_logs_product_id_fkey")
  @@index([shop_id], map: "inventory_logs_shop_id_fkey")
  @@index([spec_id], map: "inventory_logs_spec_id_fkey")
  @@index([user_id], map: "inventory_logs_user_id_fkey")
  @@index([user_id, warehouse_type], map: "inventory_logs_user_warehouse_idx")
}

model inventory_stocks {
  id                String                         @id
  productId         String
  specId            String?
  warehouseType     inventory_stocks_warehouseType
  userId            String?
  shopId            String?
  quantity          Int                            @default(0)
  reservedQuantity  Int                            @default(0)
  availableQuantity Int                            @default(0)
  batchNumber       String?
  location          String?
  expiry_date       DateTime?
  cost              Float                          @default(0)
  salePrice         Float                          @default(0)
  turnoverRate      Float                          @default(0)
  outOfStockCount   Int                            @default(0)
  created_at        DateTime                       @default(now())
  updated_at        DateTime
  products          products                       @relation(fields: [productId], references: [id], onDelete: Cascade)
  shops             shops?                         @relation(fields: [shopId], references: [id])
  product_specs     product_specs?                 @relation(fields: [specId], references: [id])
  users             users?                         @relation(fields: [userId], references: [id])

  @@index([productId])
  @@index([shopId])
  @@index([specId], map: "inventory_stocks_specId_fkey")
  @@index([userId])
  @@index([warehouseType])
}

model level_upgrade_records {
  id             String                               @id
  user_id        String
  previous_level level_upgrade_records_previous_level
  new_level      level_upgrade_records_new_level
  upgrade_type   level_upgrade_records_upgrade_type
  approved_by_id String
  approved_at    DateTime                             @default(now())
  remarks        String?
  stats          Json?
  requirements   Json?
  metadata       Json?
  created_at     DateTime                             @default(now())
  users          users                                @relation(fields: [user_id], references: [id])

  @@index([user_id], map: "level_upgrade_records_user_id_fkey")
}

model logistics_companies {
  id                  String                            @id
  code                String                            @unique
  name                String
  display_name        String
  logo                String?
  website             String?
  phone               String?
  service_scope       logistics_companies_service_scope
  delivery_types      String
  normal_delivery     Int                               @default(48)
  express_delivery    Int                               @default(24)
  api_provider        String?
  api_config          Json?
  api_enabled         Boolean                           @default(false)
  is_active           Boolean                           @default(true)
  sort                Int                               @default(0)
  created_at          DateTime                          @default(now())
  updated_at          DateTime
  logistics_shipments logistics_shipments[]
}

model logistics_info {
  id                      String                @id
  order_id                String                @unique
  express_company         String
  tracking_number         String
  status                  logistics_info_status @default(NOT_SHIPPED)
  current_location        String?
  estimated_delivery_date DateTime?
  tracks                  String?
  metadata                String?
  created_at              DateTime              @default(now())
  updated_at              DateTime
  orders                  orders                @relation(fields: [order_id], references: [id], onDelete: Cascade)
}

model logistics_shipments {
  id                   String                            @id
  shipment_no          String                            @unique
  order_id             String
  user_id              String
  company_id           String
  tracking_number      String
  express_type         String?
  sender_name          String
  sender_phone         String
  sender_address       String
  sender_province      String?
  sender_city          String?
  sender_district      String?
  sender_postal_code   String?
  receiver_name        String
  receiver_phone       String
  receiver_address     String
  receiver_province    String?
  receiver_city        String?
  receiver_district    String?
  receiver_postal_code String?
  package_count        Int                               @default(1)
  package_weight       Float?
  package_volume       Float?
  package_desc         String?
  goods_value          Float?
  delivery_type        logistics_shipments_delivery_type @default(STANDARD)
  delivery_fee         Float                             @default(0)
  cod_amount           Float?
  estimated_delivery   DateTime?
  actual_delivery      DateTime?
  delivery_photo       String?
  delivery_signature   String?
  status               logistics_shipments_status        @default(NOT_SHIPPED)
  last_status          String?
  last_location        String?
  is_exception         Boolean                           @default(false)
  exception_reason     String?
  exception_time       DateTime?
  resolved_at          DateTime?
  api_synced_at        DateTime?
  sync_status          logistics_shipments_sync_status   @default(PENDING)
  remarks              String?
  created_at           DateTime                          @default(now())
  updated_at           DateTime
  shipped_at           DateTime?
  completed_at         DateTime?
  logistics_companies  logistics_companies               @relation(fields: [company_id], references: [id])
  orders               orders                            @relation(fields: [order_id], references: [id])
  users                users                             @relation(fields: [user_id], references: [id])
  logistics_tracks     logistics_tracks[]

  @@index([company_id], map: "logistics_shipments_company_id_fkey")
  @@index([order_id], map: "logistics_shipments_order_id_fkey")
  @@index([user_id], map: "logistics_shipments_user_id_fkey")
}

model logistics_tracks {
  id                  String                  @id
  shipment_id         String
  time                DateTime
  status              String
  location            String?
  description         String?
  operator            String?
  operatorPhone       String?
  source              logistics_tracks_source @default(MANUAL)
  source_code         String?
  created_at          DateTime                @default(now())
  logistics_shipments logistics_shipments     @relation(fields: [shipment_id], references: [id], onDelete: Cascade)

  @@index([shipment_id], map: "logistics_tracks_shipment_id_fkey")
}

model notification_channels {
  id              String                             @id
  channel_type    notification_channels_channel_type
  name            String
  description     String?
  config          Json
  is_active       Boolean                            @default(true)
  canRetry        Boolean                            @default(true)
  max_retries     Int                                @default(3)
  timeout_seconds Int                                @default(30)
  daily_limit     Int?
  rate_limit      Int?
  batch_size      Int                                @default(100)
  created_at      DateTime                           @default(now())
  updated_at      DateTime
}

model notification_preferences {
  id                  String   @id
  user_id             String   @unique
  is_enabled          Boolean  @default(true)
  quiet_hours_start   String?
  quiet_hours_end     String?
  channel_preferences Json
  category_settings   Json
  created_at          DateTime @default(now())
  updated_at          DateTime
  users               users    @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model notification_statistics {
  id                    String                               @id
  date                  DateTime
  category              notification_statistics_category
  channel_type          notification_statistics_channel_type
  total_sent            Int                                  @default(0)
  total_success         Int                                  @default(0)
  total_failed          Int                                  @default(0)
  successRate           Float                                @default(0)
  average_response_time Float?
  errorReasons          Json?
  created_at            DateTime                             @default(now())
  updated_at            DateTime

  @@unique([date, category, channel_type])
}

model notification_templates {
  id              String                          @id
  code            String                          @unique
  name            String
  category        notification_templates_category
  title           String
  content         String
  variables       Json?
  enabledChannels Json
  defaultChannels String
  isSystem        Boolean                         @default(false)
  isActive        Boolean                         @default(true)
  priority        notification_templates_priority @default(NORMAL)
  daily_limit     Int?
  rate_limit      Int?
  created_at      DateTime                        @default(now())
  updated_at      DateTime
  notifications   notifications[]
}

model notifications {
  id                     String                       @id
  recipient_id           String
  recipient_type         notifications_recipient_type
  template_id            String?
  category               notifications_category
  type                   notifications_type
  title                  String
  content                String
  variables              Json?
  channels               Json
  sent_channels          String
  failed_channels        String?
  status                 notifications_status         @default(PENDING)
  priority               notifications_priority       @default(NORMAL)
  is_read                Boolean                      @default(false)
  read_at                DateTime?
  sendResult             Json?
  error_reason           String?
  retry_count            Int                          @default(0)
  max_retries            Int                          @default(3)
  related_type           String?
  related_id             String?
  businessData           Json?
  scheduled_at           DateTime?
  sent_at                DateTime?
  completed_at           DateTime?
  created_at             DateTime                     @default(now())
  updated_at             DateTime
  users                  users                        @relation(fields: [recipient_id], references: [id], onDelete: Cascade)
  notification_templates notification_templates?      @relation(fields: [template_id], references: [id])

  @@index([recipient_id], map: "notifications_recipient_id_fkey")
  @@index([template_id], map: "notifications_template_id_fkey")
}

model order_items {
  id              String         @id
  order_id        String
  product_id      String
  product_name    String
  product_spec    String?
  product_image   String?
  quantity        Int
  discount_amount Float          @default(0)
  final_price     Float
  metadata        String?
  sku_id          String?
  total_price     Float
  unit_price      Float
  orders          orders         @relation(fields: [order_id], references: [id], onDelete: Cascade)
  products        products       @relation(fields: [product_id], references: [id])
  product_specs   product_specs? @relation(fields: [sku_id], references: [id])

  @@index([order_id], map: "order_items_order_id_fkey")
  @@index([product_id], map: "order_items_product_id_fkey")
  @@index([sku_id], map: "order_items_sku_id_fkey")
}

model orders {
  id                            String                @id
  order_no                      String                @unique
  total_amount                  Float
  discount_amount               Float                 @default(0)
  final_amount                  Float
  status                        orders_status         @default(PENDING)
  paymentStatus                 orders_paymentStatus  @default(UNPAID)
  created_at                    DateTime              @default(now())
  updated_at                    DateTime
  paid_at                       DateTime?
  shipped_at                    DateTime?
  delivered_at                  DateTime?
  buyer_id                      String
  buyer_notes                   String?
  cancelled_at                  DateTime?
  cash_amount                   Float?
  completed_at                  DateTime?
  metadata                      String?
  paymentMethod                 orders_paymentMethod?
  points_amount                 Float?
  promotion_info                String?
  seller_id                     String?
  seller_notes                  String?
  shipping_address              String?
  shipping_fee                  Float                 @default(0)
  type                          orders_type
  gift_records                  gift_records[]
  logistics_info                logistics_info?
  logistics_shipments           logistics_shipments[]
  order_items                   order_items[]
  users_orders_buyer_idTousers  users                 @relation("orders_buyer_idTousers", fields: [buyer_id], references: [id])
  users_orders_seller_idTousers users?                @relation("orders_seller_idTousers", fields: [seller_id], references: [id])
  payment_records               payment_records[]

  @@index([buyer_id], map: "orders_buyer_id_fkey")
  @@index([buyer_id, status], map: "orders_buyer_status_idx")
  @@index([created_at])
  @@index([paymentStatus], map: "orders_payment_status_idx")
  @@index([seller_id], map: "orders_seller_id_fkey")
  @@index([status])
}

model payment_locks {
  id         String   @id
  lockKey    String   @unique
  order_id   String
  user_id    String
  amount     Float
  expires_at DateTime
  is_active  Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime

  @@index([expires_at])
  @@index([lockKey])
  @@index([order_id])
  @@index([user_id])
}

model payment_logs {
  id              String                      @id
  payment_id      String
  action          payment_logs_action
  description     String
  before_status   payment_logs_before_status?
  after_status    payment_logs_after_status?
  request_data    String?
  response_data   String?
  operator_id     String?
  client_ip       String?
  user_agent      String?
  extra           String?
  created_at      DateTime                    @default(now())
  users           users?                      @relation(fields: [operator_id], references: [id])
  payment_records payment_records             @relation(fields: [payment_id], references: [id], onDelete: Cascade)

  @@index([action])
  @@index([created_at])
  @@index([operator_id], map: "payment_logs_operator_id_fkey")
  @@index([payment_id])
}

model payment_reconciliations {
  id                String                         @id
  reconcile_no      String                         @unique
  reconcile_date    DateTime
  total_count       Int                            @default(0)
  total_amount      Float                          @default(0)
  success_count     Int                            @default(0)
  success_amount    Float                          @default(0)
  failed_count      Int                            @default(0)
  failed_amount     Float                          @default(0)
  status            payment_reconciliations_status @default(PENDING)
  error_message     String?
  channel_data_file String?
  system_data_file  String?
  report_file       String?
  extra             String?
  created_at        DateTime                       @default(now())
  updated_at        DateTime
  completed_at      DateTime?

  @@index([reconcile_date])
  @@index([status])
}

model payment_records {
  id                     String                          @id
  order_id               String?
  payment_method         payment_records_payment_method
  amount                 Float
  status                 payment_records_status
  paid_at                DateTime?
  created_at             DateTime                        @default(now())
  updated_at             DateTime
  channel_order_id       String?
  channel_transaction_id String?
  client_ip              String?
  currency               String                          @default("CNY")
  description            String?
  expired_at             DateTime?
  extra                  String?
  notified_at            DateTime?
  notify_data            String?
  payment_channel        payment_records_payment_channel
  payment_no             String                          @unique
  prepay_id              String?
  subject                String?
  user_agent             String?
  user_id                String
  payment_logs           payment_logs[]
  orders                 orders?                         @relation(fields: [order_id], references: [id])
  users                  users                           @relation(fields: [user_id], references: [id])
  payment_refunds        payment_refunds[]

  @@index([channel_order_id])
  @@index([created_at])
  @@index([order_id])
  @@index([payment_channel])
  @@index([status])
  @@index([user_id])
}

model payment_refunds {
  id                                           String                 @id
  refund_no                                    String                 @unique
  payment_id                                   String
  refund_amount                                Float
  refund_reason                                String?
  apply_user_id                                String
  approve_user_id                              String?
  channel_refund_id                            String?
  channel_transaction_id                       String?
  status                                       payment_refunds_status @default(PENDING)
  refunded_at                                  DateTime?
  failed_reason                                String?
  notify_data                                  String?
  notified_at                                  DateTime?
  extra                                        String?
  created_at                                   DateTime               @default(now())
  updated_at                                   DateTime
  users_payment_refunds_apply_user_idTousers   users                  @relation("payment_refunds_apply_user_idTousers", fields: [apply_user_id], references: [id])
  users_payment_refunds_approve_user_idTousers users?                 @relation("payment_refunds_approve_user_idTousers", fields: [approve_user_id], references: [id])
  payment_records                              payment_records        @relation(fields: [payment_id], references: [id], onDelete: Cascade)

  @@index([apply_user_id])
  @@index([approve_user_id], map: "payment_refunds_approve_user_id_fkey")
  @@index([payment_id])
  @@index([status])
}

model performance_metrics {
  id                  String                           @id
  user_id             String
  period              String
  personal_sales      Float                            @default(0)
  personal_orders     Int                              @default(0)
  new_customers       Int                              @default(0)
  repeat_rate         Float                            @default(0)
  average_order_value Float                            @default(0)
  team_sales          Float                            @default(0)
  team_orders         Int                              @default(0)
  new_members         Int                              @default(0)
  active_rate         Float                            @default(0)
  direct_referrals    Int                              @default(0)
  referral_revenue    Float                            @default(0)
  current_role        performance_metrics_current_role @default(MEMBER)
  progress_percentage Float                            @default(0)
  requirements_met    Json?
  calculation_date    DateTime                         @default(now())
  created_at          DateTime                         @default(now())
  updated_at          DateTime
  users               users                            @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, period])
}

model points_transactions {
  id                                            String                     @id
  transaction_no                                String                     @unique
  from_user_id                                  String?
  to_user_id                                    String
  amount                                        Float
  type                                          points_transactions_type
  related_order_id                              String?
  description                                   String?
  metadata                                      Json?
  status                                        points_transactions_status @default(PENDING)
  balance_before                                Float
  balance_after                                 Float
  created_at                                    DateTime                   @default(now())
  completed_at                                  DateTime?
  users_points_transactions_from_user_idTousers users?                     @relation("points_transactions_from_user_idTousers", fields: [from_user_id], references: [id])
  users_points_transactions_to_user_idTousers   users                      @relation("points_transactions_to_user_idTousers", fields: [to_user_id], references: [id])

  @@index([from_user_id], map: "points_transactions_from_user_id_fkey")
  @@index([to_user_id], map: "points_transactions_to_user_id_fkey")
}

model product_categories {
  id                       String               @id
  name                     String
  parent_id                String?
  level                    Int                  @default(1)
  sort                     Int                  @default(0)
  icon                     String?
  description              String?
  is_active                Boolean              @default(true)
  created_at               DateTime             @default(now())
  updated_at               DateTime
  product_categories       product_categories?  @relation("product_categoriesToproduct_categories", fields: [parent_id], references: [id])
  other_product_categories product_categories[] @relation("product_categoriesToproduct_categories")
  products                 products[]

  @@index([parent_id], map: "product_categories_parent_id_fkey")
}

model product_pricings {
  id            String                      @id
  product_id    String
  spec_id       String?
  user_level    product_pricings_user_level
  price         Float
  created_at    DateTime                    @default(now())
  updated_at    DateTime
  products      products                    @relation(fields: [product_id], references: [id], onDelete: Cascade)
  product_specs product_specs?              @relation(fields: [spec_id], references: [id])

  @@unique([product_id, spec_id, user_level])
  @@index([spec_id], map: "product_pricings_spec_id_fkey")
}

model product_specs {
  id               String             @id
  product_id       String
  name             String
  sku              String             @unique
  price            Float
  stock            Int                @default(0)
  minStock         Int                @default(10)
  images           String?
  is_active        Boolean            @default(true)
  sort             Int                @default(0)
  created_at       DateTime           @default(now())
  updated_at       DateTime
  inventory_alerts inventory_alerts[]
  inventory_items  inventory_items[]
  inventory_logs   inventory_logs[]
  inventory_stocks inventory_stocks[]
  order_items      order_items[]
  product_pricings product_pricings[]
  products         products           @relation(fields: [product_id], references: [id], onDelete: Cascade)

  @@index([product_id], map: "product_specs_product_id_fkey")
}

model product_tag_links {
  id           String       @id
  product_id   String
  tag_id       String
  created_at   DateTime     @default(now())
  products     products     @relation(fields: [product_id], references: [id], onDelete: Cascade)
  product_tags product_tags @relation(fields: [tag_id], references: [id], onDelete: Cascade)

  @@unique([product_id, tag_id])
  @@index([tag_id], map: "product_tag_links_tag_id_fkey")
}

model product_tags {
  id                String              @id
  name              String              @unique
  color             String?
  description       String?
  sort              Int                 @default(0)
  created_at        DateTime            @default(now())
  updated_at        DateTime
  product_tag_links product_tag_links[]
}

model products {
  id                 String              @id
  category_id        String
  name               String
  description        String?
  code               String              @unique
  sku                String              @unique
  base_price         Float
  total_stock        Int                 @default(0)
  min_stock          Int                 @default(10)
  images             String
  video_url          String?
  details            Json?
  status             products_status     @default(ACTIVE)
  is_featured        Boolean             @default(false)
  sort               Int                 @default(0)
  schedule_on_at     DateTime?
  schedule_off_at    DateTime?
  created_at         DateTime            @default(now())
  updated_at         DateTime
  shop_id            String?
  gift_records       gift_records[]
  inventory_alerts   inventory_alerts[]
  inventory_items    inventory_items[]
  inventory_logs     inventory_logs[]
  inventory_stocks   inventory_stocks[]
  order_items        order_items[]
  product_pricings   product_pricings[]
  product_specs      product_specs[]
  product_tag_links  product_tag_links[]
  product_categories product_categories  @relation(fields: [category_id], references: [id])
  shops              shops?              @relation(fields: [shop_id], references: [id])
  purchase_orders    purchase_orders[]

  @@index([category_id], map: "products_category_id_fkey")
  @@index([shop_id], map: "products_shop_id_fkey")
}

model purchase_orders {
  id                                     String                 @id
  order_no                               String                 @unique
  buyer_id                               String
  seller_id                              String
  product_id                             String
  quantity                               Int
  unit_price                             Float
  total_amount                           Float
  purchase_path                          String
  commission_details                     Json?
  status                                 purchase_orders_status @default(PENDING)
  created_at                             DateTime               @default(now())
  updated_at                             DateTime
  completed_at                           DateTime?
  users_purchase_orders_buyer_idTousers  users                  @relation("purchase_orders_buyer_idTousers", fields: [buyer_id], references: [id])
  products                               products               @relation(fields: [product_id], references: [id])
  users_purchase_orders_seller_idTousers users                  @relation("purchase_orders_seller_idTousers", fields: [seller_id], references: [id])

  @@index([buyer_id], map: "purchase_orders_buyer_id_fkey")
  @@index([product_id], map: "purchase_orders_product_id_fkey")
  @@index([seller_id], map: "purchase_orders_seller_id_fkey")
}

model referral_relationships {
  id                  String                                  @id
  referrer_id         String
  referee_id          String
  relationshipType    referral_relationships_relationshipType @default(DIRECT)
  level               Int                                     @default(1)
  path                String
  referral_sales      Float                                   @default(0)
  referral_commission Float                                   @default(0)
  is_active           Boolean                                 @default(true)
  established_date    DateTime                                @default(now())
  last_active_date    DateTime?
  created_at          DateTime                                @default(now())
  updated_at          DateTime
}

model shops {
  id               String             @id
  user_id          String
  shopType         shops_shopType
  shop_level       Int                @default(1)
  shop_name        String?
  shop_description String?
  contact_name     String?
  contact_phone    String?
  address          String?
  total_sales      Float              @default(0)
  total_orders     Int                @default(0)
  total_revenue    Float              @default(0)
  status           shops_status       @default(PENDING)
  created_at       DateTime           @default(now())
  updated_at       DateTime
  inventory_alerts inventory_alerts[]
  inventory_items  inventory_items[]
  inventory_logs   inventory_logs[]
  inventory_stocks inventory_stocks[]
  products         products[]
  users            users              @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id], map: "shops_user_id_fkey")
}

model sms_verifications {
  id        String                 @id
  phone     String
  code      String
  type      sms_verifications_type
  attempts  Int                    @default(0)
  isUsed    Boolean                @default(false)
  expiresAt DateTime
  createdAt DateTime               @default(now())
}

model system_configs {
  id               String              @id
  key              String              @unique
  value            String              @db.LongText
  description      String?
  category         String
  type             system_configs_type
  last_modified_by String?
  created_at       DateTime            @default(now())
  updated_at       DateTime
  is_editable      Boolean             @default(true)
  is_system        Boolean             @default(false)

  @@index([category])
  @@index([type])
}

model team_members {
  id               String              @id
  user_id          String              @unique
  team_id          String
  role             team_members_role   @default(MEMBER)
  level            Int                 @default(1)
  status           team_members_status @default(ACTIVE)
  position         String?
  referrer_id      String?
  upline_id        String?
  personal_sales   Float               @default(0)
  team_sales       Float               @default(0)
  direct_count     Int                 @default(0)
  team_count       Int                 @default(0)
  join_date        DateTime            @default(now())
  promoted_date    DateTime?
  last_active_date DateTime?
  created_at       DateTime            @default(now())
  updated_at       DateTime
  teams            teams               @relation(fields: [team_id], references: [id], onDelete: Cascade)
  users            users               @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([team_id], map: "team_members_team_id_fkey")
}

model teams {
  id               String         @id
  name             String
  description      String?
  leader_id        String
  total_members    Int            @default(0)
  active_members   Int            @default(0)
  total_levels     Int            @default(1)
  total_sales      Float          @default(0)
  status           teams_status   @default(ACTIVE)
  established_date DateTime       @default(now())
  created_at       DateTime       @default(now())
  updated_at       DateTime
  team_members     team_members[]
  users            users          @relation(fields: [leader_id], references: [id])

  @@index([leader_id], map: "teams_leader_id_fkey")
}

model users {
  id                                                          String                    @id
  openid                                                      String                    @unique
  nickname                                                    String?
  avatar_url                                                  String?
  phone                                                       String?                   @unique
  level                                                       users_level               @default(NORMAL)
  status                                                      users_status              @default(ACTIVE)
  parent_id                                                   String?
  team_path                                                   String?
  team_level                                                  Int                       @default(1)
  total_sales                                                 Float                     @default(0)
  total_bottles                                               Int                       @default(0)
  direct_sales                                                Float                     @default(0)
  team_sales                                                  Float                     @default(0)
  direct_count                                                Int                       @default(0)
  team_count                                                  Int                       @default(0)
  cloud_shop_level                                            Int?
  has_wutong_shop                                             Boolean                   @default(false)
  points_balance                                              Float                     @default(0)
  points_frozen                                               Float                     @default(0)
  created_at                                                  DateTime                  @default(now())
  updated_at                                                  DateTime                  @default(now())
  last_login_at                                               DateTime?
  referral_code                                               String?                   @unique
  user_number                                                 String?                   @unique
  commission_calculations                                     commission_calculations[]
  gift_records                                                gift_records[]
  inventory_alerts_inventory_alerts_resolved_byTousers        inventory_alerts[]        @relation("inventory_alerts_resolved_byTousers")
  inventory_alerts_inventory_alerts_user_idTousers            inventory_alerts[]        @relation("inventory_alerts_user_idTousers")
  inventory_items                                             inventory_items[]
  inventory_logs_inventory_logs_operator_idTousers            inventory_logs[]          @relation("inventory_logs_operator_idTousers")
  inventory_logs_inventory_logs_user_idTousers                inventory_logs[]          @relation("inventory_logs_user_idTousers")
  inventory_stocks                                            inventory_stocks[]
  level_upgrade_records                                       level_upgrade_records[]
  logistics_shipments                                         logistics_shipments[]
  notification_preferences                                    notification_preferences?
  notifications                                               notifications[]
  orders_orders_buyer_idTousers                               orders[]                  @relation("orders_buyer_idTousers")
  orders_orders_seller_idTousers                              orders[]                  @relation("orders_seller_idTousers")
  payment_logs                                                payment_logs[]
  payment_records                                             payment_records[]
  payment_refunds_payment_refunds_apply_user_idTousers        payment_refunds[]         @relation("payment_refunds_apply_user_idTousers")
  payment_refunds_payment_refunds_approve_user_idTousers      payment_refunds[]         @relation("payment_refunds_approve_user_idTousers")
  performance_metrics                                         performance_metrics[]
  points_transactions_points_transactions_from_user_idTousers points_transactions[]     @relation("points_transactions_from_user_idTousers")
  points_transactions_points_transactions_to_user_idTousers   points_transactions[]     @relation("points_transactions_to_user_idTousers")
  purchase_orders_purchase_orders_buyer_idTousers             purchase_orders[]         @relation("purchase_orders_buyer_idTousers")
  purchase_orders_purchase_orders_seller_idTousers            purchase_orders[]         @relation("purchase_orders_seller_idTousers")
  shops                                                       shops[]
  team_members                                                team_members?
  teams                                                       teams[]
  users                                                       users?                    @relation("usersTousers", fields: [parent_id], references: [id])
  other_users                                                 users[]                   @relation("usersTousers")

  @@index([parent_id], map: "users_parent_id_fkey")
}

enum notification_channels_channel_type {
  IN_APP
  SMS
  EMAIL
  WECHAT_MINI
  WECHAT_OFFICIAL
  PUSH
  WEBHOOK
}

enum level_upgrade_records_previous_level {
  NORMAL
  VIP
  STAR_1
  STAR_2
  STAR_3
  STAR_4
  STAR_5
  DIRECTOR
}

enum notification_statistics_category {
  SYSTEM
  ORDER
  PAYMENT
  LOGISTICS
  USER_LEVEL
  SHOP
  INVENTORY
  PROMOTION
  ANNOUNCEMENT
  SECURITY
  FINANCIAL
  TEAM
  ACTIVITY
}

enum notifications_recipient_type {
  USER
  ADMIN
  SYSTEM
  GROUP
}

enum payment_logs_action {
  CREATE
  QUERY
  SUCCESS
  FAILED
  CANCEL
  CLOSE
  EXPIRE
  NOTIFY
  REFUND_CREATE
  REFUND_SUCCESS
  REFUND_FAILED
}

enum payment_records_payment_method {
  WECHAT
  ALIPAY
  POINTS
  MIXED
}

enum shops_shopType {
  CLOUD
  WUTONG
}

enum inventory_stocks_warehouseType {
  PLATFORM
  CLOUD
  LOCAL
}

enum level_upgrade_records_new_level {
  NORMAL
  VIP
  STAR_1
  STAR_2
  STAR_3
  STAR_4
  STAR_5
  DIRECTOR
}

enum notification_statistics_channel_type {
  IN_APP
  SMS
  EMAIL
  WECHAT_MINI
  WECHAT_OFFICIAL
  PUSH
  WEBHOOK
}

enum notification_templates_category {
  SYSTEM
  ORDER
  PAYMENT
  LOGISTICS
  USER_LEVEL
  SHOP
  INVENTORY
  PROMOTION
  ANNOUNCEMENT
  SECURITY
  FINANCIAL
  TEAM
  ACTIVITY
}

enum product_pricings_user_level {
  NORMAL
  VIP
  STAR_1
  STAR_2
  STAR_3
  STAR_4
  STAR_5
  DIRECTOR
}

enum referral_relationships_relationshipType {
  DIRECT
  INDIRECT
  NETWORK
}

enum sms_verifications_type {
  BIND
  UNBIND
  LOGIN
  TRANSFER
}

enum team_members_role {
  MEMBER
  CAPTAIN
  MANAGER
  DIRECTOR
  SENIOR_DIRECTOR
  PARTNER
  AMBASSADOR
}

enum level_upgrade_records_upgrade_type {
  AUTO
  MANUAL
  WUTONG_PRIVILEGE
  TEAM_ACHIEVEMENT
  SPECIAL_PROMOTION
}

enum logistics_info_status {
  NOT_SHIPPED
  SHIPPED
  IN_TRANSIT
  OUT_FOR_DELIVERY
  DELIVERED
  EXCEPTION
}

enum notifications_category {
  SYSTEM
  ORDER
  PAYMENT
  LOGISTICS
  USER_LEVEL
  SHOP
  INVENTORY
  PROMOTION
  ANNOUNCEMENT
  SECURITY
  FINANCIAL
  TEAM
  ACTIVITY
}

enum payment_logs_before_status {
  UNPAID
  PAYING
  PAID
  FAILED
  REFUNDING
  REFUNDED
}

enum payment_records_status {
  UNPAID
  PAYING
  PAID
  FAILED
  REFUNDING
  REFUNDED
}

enum inventory_alerts_alert_type {
  LOW_STOCK
  OUT_OF_STOCK
  EXCESS_STOCK
  EXPIRED
}

enum inventory_items_warehouse_type {
  PLATFORM
  CLOUD
  LOCAL
}

enum inventory_logs_operation_type {
  MANUAL_IN
  MANUAL_OUT
  ORDER_OUT
  PURCHASE_IN
  ADJUSTMENT
  TRANSFER_IN
  TRANSFER_OUT
  RETURN_IN
  DAMAGE_OUT
  INITIAL
}

enum notifications_type {
  INFO
  SUCCESS
  WARNING
  ERROR
  REMINDER
  PROMOTION
  ANNOUNCEMENT
  ALERT
}

enum orders_status {
  PENDING
  PAID
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum payment_logs_after_status {
  UNPAID
  PAYING
  PAID
  FAILED
  REFUNDING
  REFUNDED
}

enum points_transactions_type {
  PURCHASE
  TRANSFER
  RECHARGE
  WITHDRAW
  REFUND
  COMMISSION
  REWARD
  FREEZE
  UNFREEZE
}

enum system_configs_type {
  JSON
  STRING
  NUMBER
  BOOLEAN
  ARRAY
}

enum team_members_status {
  ACTIVE
  INACTIVE
  SUSPENDED
  TERMINATED
}

enum users_level {
  NORMAL
  VIP
  STAR_1
  STAR_2
  STAR_3
  STAR_4
  STAR_5
  DIRECTOR
}

enum gift_records_type {
  BUY_TEN_GET_ONE
  PROMOTION_GIFT
  VIP_GIFT
  WUTONG_BUY_TEN_GET_ONE
  REWARD_GIFT
  COMPENSATION_GIFT
}

enum orders_paymentStatus {
  UNPAID
  PAYING
  PAID
  FAILED
  REFUNDING
  REFUNDED
}

enum users_status {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum admins_role {
  SUPER_ADMIN
  ADMIN
  OPERATOR
}

enum gift_records_status {
  PENDING
  PROCESSING
  SHIPPED
  COMPLETED
  CANCELLED
  EXPIRED
}

enum logistics_companies_service_scope {
  NATIONAL
  INTERNATIONAL
  LOCAL
  SAME_CITY
}

enum admins_status {
  ACTIVE
  INACTIVE
  LOCKED
}

enum commission_calculations_status {
  PENDING
  CALCULATED
  APPROVED
  PAID
  CANCELLED
}

enum inventory_alerts_warehouse_type {
  PLATFORM
  CLOUD
  LOCAL
}

enum logistics_tracks_source {
  MANUAL
  API
  WEBHOOK
  IMPORT
}

enum teams_status {
  ACTIVE
  INACTIVE
  SUSPENDED
  TERMINATED
}

enum inventory_logs_warehouse_type {
  PLATFORM
  CLOUD
  LOCAL
}

enum payment_reconciliations_status {
  PENDING
  PROCESSING
  SUCCESS
  FAILED
  CANCELLED
}

enum payment_refunds_status {
  PENDING
  PROCESSING
  SUCCESS
  FAILED
  CANCELLED
}

enum points_transactions_status {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}

enum purchase_orders_status {
  PENDING
  APPROVED
  REJECTED
  COMPLETED
  CANCELLED
}

enum notification_templates_priority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum notifications_status {
  PENDING
  SENDING
  SENT
  PARTIAL_SUCCESS
  FAILED
  COMPLETED
  CANCELLED
  RETRYING
}

enum products_status {
  ACTIVE
  INACTIVE
  PRESALE
  OUT_OF_STOCK
}

enum shops_status {
  PENDING
  APPROVED
  ACTIVE
  SUSPENDED
  CLOSED
}

enum notifications_priority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum inventory_logs_operator_type {
  SYSTEM
  ADMIN
  USER
  SYSTEM_BATCH
}

enum performance_metrics_current_role {
  MEMBER
  CAPTAIN
  MANAGER
  DIRECTOR
  SENIOR_DIRECTOR
  PARTNER
  AMBASSADOR
}

enum payment_records_payment_channel {
  WECHAT
  ALIPAY
  POINTS
  MIXED
}

enum orders_paymentMethod {
  WECHAT
  ALIPAY
  POINTS
  MIXED
}

enum orders_type {
  RETAIL
  PURCHASE
  TEAM
  EXCHANGE
}

enum logistics_shipments_delivery_type {
  STANDARD
  EXPRESS
  SAME_DAY
  NEXT_DAY
  PICKUP
}

enum logistics_shipments_status {
  NOT_SHIPPED
  SHIPPED
  IN_TRANSIT
  OUT_FOR_DELIVERY
  DELIVERED
  EXCEPTION
}

enum logistics_shipments_sync_status {
  PENDING
  SYNCING
  SUCCESS
  FAILED
}
