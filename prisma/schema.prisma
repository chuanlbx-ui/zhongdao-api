generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model admins {
  id            String        @id
  username      String        @unique
  password      String
  realName      String?
  email         String?
  phone         String?
  avatar        String?
  role          admins_role   @default(ADMIN)
  status        admins_status @default(ACTIVE)
  lastLoginAt   DateTime?
  lastLoginIp   String?
  permissions   Json?
  loginAttempts Int           @default(0)
  lockedUntil   DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime
}

model commissionCalculations {
  id                 String                        @id
  userId             String
  period             String
  totalCommission    Float                         @default(0)
  personalCommission Float                         @default(0)
  teamCommission     Float                         @default(0)
  referralCommission Float                         @default(0)
  bonusCommission    Float                         @default(0)
  status             commissionCalculations_status @default(PENDING)
  paidDate           DateTime?
  calculatedAt       DateTime                      @default(now())
  createdAt          DateTime                      @default(now())
  updatedAt          DateTime
  users              users                         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "commissionCalculationsUserIdFkey")
  @@index([userId, period], map: "commissionCalculationsUserPeriodIdx")
  @@index([calculatedAt])
  @@index([period])
  @@index([status])
}

model giftRecords {
  id          String             @id
  userId      String
  orderId     String
  productId   String
  quantity    Int
  value       Float
  type        giftRecords_type
  status      giftRecords_status @default(PENDING)
  metadata    Json?
  remarks     String?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime
  shippedAt   DateTime?
  completedAt DateTime?
  orders      orders             @relation(fields: [orderId], references: [id])
  products    products           @relation(fields: [productId], references: [id])
  users       users              @relation(fields: [userId], references: [id])

  @@index([orderId], map: "giftRecordsOrderIdFkey")
  @@index([productId], map: "giftRecordsProductIdFkey")
  @@index([userId], map: "giftRecordsUserIdFkey")
}

model inventoryAlerts {
  id                                      String                        @id
  userId                                  String
  productId                               String
  specId                                  String?
  shopId                                  String?
  alertType                               inventoryAlerts_alertType
  currentQuantity                         Int
  threshold                               Int
  warehouseType                           inventoryAlerts_warehouseType
  isRead                                  Boolean                       @default(false)
  isResolved                              Boolean                       @default(false)
  resolvedAt                              DateTime?
  resolvedBy                              String?
  resolveNote                             String?
  notificationSent                        Boolean                       @default(false)
  lastNotifiedAt                          DateTime?
  createdAt                               DateTime                      @default(now())
  updatedAt                               DateTime
  products                                products                      @relation(fields: [productId], references: [id])
  users_inventoryAlerts_resolvedByTousers users?                        @relation("inventoryAlerts_resolvedByTousers", fields: [resolvedBy], references: [id])
  shops                                   shops?                        @relation(fields: [shopId], references: [id])
  productSpecs                            productSpecs?                 @relation(fields: [specId], references: [id])
  users_inventoryAlerts_userIdTousers     users                         @relation("inventoryAlerts_userIdTousers", fields: [userId], references: [id])

  @@index([productId], map: "inventoryAlertsProductIdFkey")
  @@index([resolvedBy], map: "inventoryAlertsResolvedByFkey")
  @@index([shopId], map: "inventoryAlertsShopIdFkey")
  @@index([specId], map: "inventoryAlertsSpecIdFkey")
  @@index([userId], map: "inventoryAlertsUserIdFkey")
}

model inventoryItems {
  id             String                       @id
  userId         String
  productId      String
  specId         String?
  shopId         String?
  warehouseType  inventoryItems_warehouseType
  quantity       Int                          @default(0)
  frozenQuantity Int                          @default(0)
  minStock       Int                          @default(10)
  lastInAt       DateTime?
  lastOutAt      DateTime?
  lastAlertAt    DateTime?
  alertCount     Int                          @default(0)
  createdAt      DateTime                     @default(now())
  updatedAt      DateTime
  products       products                     @relation(fields: [productId], references: [id])
  shops          shops?                       @relation(fields: [shopId], references: [id])
  productSpecs   productSpecs?                @relation(fields: [specId], references: [id])
  users          users                        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId, specId, warehouseType])
  @@index([productId], map: "inventoryItemsProductIdFkey")
  @@index([shopId], map: "inventoryItemsShopIdFkey")
  @@index([specId], map: "inventoryItemsSpecIdFkey")
}

model inventoryLogs {
  id                                    String                      @id
  userId                                String
  productId                             String
  specId                                String?
  shopId                                String?
  operationType                         inventoryLogs_operationType
  quantity                              Int
  quantityBefore                        Int
  quantityAfter                         Int
  warehouseType                         inventoryLogs_warehouseType
  relatedOrderId                        String?
  relatedPurchaseId                     String?
  adjustmentReason                      String?
  operatorId                            String
  operatorType                          inventoryLogs_operatorType
  remarks                               String?
  createdAt                             DateTime                    @default(now())
  users_inventoryLogs_operatorIdTousers users                       @relation("inventoryLogs_operatorIdTousers", fields: [operatorId], references: [id])
  products                              products                    @relation(fields: [productId], references: [id])
  shops                                 shops?                      @relation(fields: [shopId], references: [id])
  productSpecs                          productSpecs?               @relation(fields: [specId], references: [id])
  users_inventoryLogs_userIdTousers     users                       @relation("inventoryLogs_userIdTousers", fields: [userId], references: [id])

  @@index([createdAt, userId], map: "inventoryLogsDateUserIdx")
  @@index([operatorId], map: "inventoryLogsOperatorIdFkey")
  @@index([productId], map: "inventoryLogsProductIdFkey")
  @@index([shopId], map: "inventoryLogsShopIdFkey")
  @@index([specId], map: "inventoryLogsSpecIdFkey")
  @@index([userId], map: "inventoryLogsUserIdFkey")
  @@index([userId, warehouseType], map: "inventoryLogsUserWarehouseIdx")
  @@index([createdAt])
}

model inventoryStocks {
  id                String                        @id
  productId         String
  specId            String?
  warehouseType     inventoryStocks_warehouseType
  userId            String?
  shopId            String?
  quantity          Int                           @default(0)
  reservedQuantity  Int                           @default(0)
  availableQuantity Int                           @default(0)
  batchNumber       String?
  location          String?
  expiryDate        DateTime?
  cost              Float                         @default(0)
  salePrice         Float                         @default(0)
  turnoverRate      Float                         @default(0)
  outOfStockCount   Int                           @default(0)
  createdAt         DateTime                      @default(now())
  updatedAt         DateTime
  products          products                      @relation(fields: [productId], references: [id], onDelete: Cascade)
  shops             shops?                        @relation(fields: [shopId], references: [id])
  productSpecs      productSpecs?                 @relation(fields: [specId], references: [id])
  users             users?                        @relation(fields: [userId], references: [id])

  @@index([specId], map: "inventoryStocksSpecIdFkey")
  @@index([productId])
  @@index([shopId])
  @@index([userId])
  @@index([warehouseType])
}

model levelUpgradeRecords {
  id            String                            @id
  userId        String
  previousLevel levelUpgradeRecords_previousLevel
  newLevel      levelUpgradeRecords_newLevel
  upgradeType   levelUpgradeRecords_upgradeType
  approvedById  String
  approvedAt    DateTime                          @default(now())
  remarks       String?
  stats         Json?
  requirements  Json?
  metadata      Json?
  createdAt     DateTime                          @default(now())
  users         users                             @relation(fields: [userId], references: [id])

  @@index([userId], map: "levelUpgradeRecordsUserIdFkey")
}

model logisticsCompanies {
  id                 String                          @id
  code               String                          @unique
  name               String
  displayName        String
  logo               String?
  website            String?
  phone              String?
  serviceScope       logisticsCompanies_serviceScope
  deliveryTypes      String
  normalDelivery     Int                             @default(48)
  expressDelivery    Int                             @default(24)
  apiProvider        String?
  apiConfig          Json?
  apiEnabled         Boolean                         @default(false)
  isActive           Boolean                         @default(true)
  sort               Int                             @default(0)
  createdAt          DateTime                        @default(now())
  updatedAt          DateTime
  logisticsShipments logisticsShipments[]
}

model logisticsInfo {
  id                    String               @id
  orderId               String               @unique
  expressCompany        String
  trackingNumber        String
  status                logisticsInfo_status @default(NOT_SHIPPED)
  currentLocation       String?
  estimatedDeliveryDate DateTime?
  tracks                String?
  metadata              String?
  createdAt             DateTime             @default(now())
  updatedAt             DateTime
  orders                orders               @relation(fields: [orderId], references: [id], onDelete: Cascade)
}

model logisticsShipments {
  id                 String                          @id
  shipmentNo         String                          @unique
  orderId            String
  userId             String
  companyId          String
  trackingNumber     String
  expressType        String?
  senderName         String
  senderPhone        String
  senderAddress      String
  senderProvince     String?
  senderCity         String?
  senderDistrict     String?
  senderPostalCode   String?
  receiverName       String
  receiverPhone      String
  receiverAddress    String
  receiverProvince   String?
  receiverCity       String?
  receiverDistrict   String?
  receiverPostalCode String?
  packageCount       Int                             @default(1)
  packageWeight      Float?
  packageVolume      Float?
  packageDesc        String?
  goodsValue         Float?
  deliveryType       logisticsShipments_deliveryType @default(STANDARD)
  deliveryFee        Float                           @default(0)
  codAmount          Float?
  estimatedDelivery  DateTime?
  actualDelivery     DateTime?
  deliveryPhoto      String?
  deliverySignature  String?
  status             logisticsShipments_status       @default(NOT_SHIPPED)
  lastStatus         String?
  lastLocation       String?
  isException        Boolean                         @default(false)
  exceptionReason    String?
  exceptionTime      DateTime?
  resolvedAt         DateTime?
  apiSyncedAt        DateTime?
  syncStatus         logisticsShipments_syncStatus   @default(PENDING)
  remarks            String?
  createdAt          DateTime                        @default(now())
  updatedAt          DateTime
  shippedAt          DateTime?
  completedAt        DateTime?
  logisticsCompanies logisticsCompanies              @relation(fields: [companyId], references: [id])
  orders             orders                          @relation(fields: [orderId], references: [id])
  users              users                           @relation(fields: [userId], references: [id])
  logisticsTracks    logisticsTracks[]

  @@index([companyId], map: "logisticsShipmentsCompanyIdFkey")
  @@index([orderId], map: "logisticsShipmentsOrderIdFkey")
  @@index([userId], map: "logisticsShipmentsUserIdFkey")
}

model logisticsTracks {
  id                 String                 @id
  shipmentId         String
  time               DateTime
  status             String
  location           String?
  description        String?
  operator           String?
  operatorPhone      String?
  source             logisticsTracks_source @default(MANUAL)
  sourceCode         String?
  createdAt          DateTime               @default(now())
  logisticsShipments logisticsShipments     @relation(fields: [shipmentId], references: [id], onDelete: Cascade)

  @@index([shipmentId], map: "logisticsTracksShipmentIdFkey")
}

model notificationChannels {
  id             String                           @id
  channelType    notificationChannels_channelType
  name           String
  description    String?
  config         Json
  isActive       Boolean                          @default(true)
  canRetry       Boolean                          @default(true)
  maxRetries     Int                              @default(3)
  timeoutSeconds Int                              @default(30)
  dailyLimit     Int?
  rateLimit      Int?
  batchSize      Int                              @default(100)
  createdAt      DateTime                         @default(now())
  updatedAt      DateTime
}

model notificationPreferences {
  id                 String   @id
  userId             String   @unique
  isEnabled          Boolean  @default(true)
  quietHoursStart    String?
  quietHoursEnd      String?
  channelPreferences Json
  categorySettings   Json
  createdAt          DateTime @default(now())
  updatedAt          DateTime
  users              users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model notificationStatistics {
  id                  String                             @id
  date                DateTime
  category            notificationStatistics_category
  channelType         notificationStatistics_channelType
  totalSent           Int                                @default(0)
  totalSuccess        Int                                @default(0)
  totalFailed         Int                                @default(0)
  successRate         Float                              @default(0)
  averageResponseTime Float?
  errorReasons        Json?
  createdAt           DateTime                           @default(now())
  updatedAt           DateTime

  @@unique([date, category, channelType])
}

model notificationTemplates {
  id              String                         @id
  code            String                         @unique
  name            String
  category        notificationTemplates_category
  title           String
  content         String
  variables       Json?
  enabledChannels Json
  defaultChannels String
  isSystem        Boolean                        @default(false)
  isActive        Boolean                        @default(true)
  priority        notificationTemplates_priority @default(NORMAL)
  dailyLimit      Int?
  rateLimit       Int?
  createdAt       DateTime                       @default(now())
  updatedAt       DateTime
  notifications   notifications[]
}

model notifications {
  id                    String                      @id
  recipientId           String
  recipientType         notifications_recipientType
  templateId            String?
  category              notifications_category
  type                  notifications_type
  title                 String
  content               String
  variables             Json?
  channels              Json
  sentChannels          String
  failedChannels        String?
  status                notifications_status        @default(PENDING)
  priority              notifications_priority      @default(NORMAL)
  isRead                Boolean                     @default(false)
  readAt                DateTime?
  sendResult            Json?
  errorReason           String?
  retryCount            Int                         @default(0)
  maxRetries            Int                         @default(3)
  relatedType           String?
  relatedId             String?
  businessData          Json?
  scheduledAt           DateTime?
  sentAt                DateTime?
  completedAt           DateTime?
  createdAt             DateTime                    @default(now())
  updatedAt             DateTime
  users                 users                       @relation(fields: [recipientId], references: [id], onDelete: Cascade)
  notificationTemplates notificationTemplates?      @relation(fields: [templateId], references: [id])

  @@index([recipientId, id], map: "idx_notifications_recipient_id")
  @@index([recipientId, isRead], map: "idx_notifications_recipient_read")
  @@index([recipientId], map: "notificationsRecipientIdFkey")
  @@index([templateId], map: "notificationsTemplateIdFkey")
}

model orderItems {
  id             String        @id
  orderId        String
  productId      String
  productName    String
  productSpec    String?
  productImage   String?
  quantity       Int
  discountAmount Float         @default(0)
  finalPrice     Float
  metadata       String?
  skuId          String?
  totalPrice     Float
  unitPrice      Float
  orders         orders        @relation(fields: [orderId], references: [id], onDelete: Cascade)
  products       products      @relation(fields: [productId], references: [id])
  productSpecs   productSpecs? @relation(fields: [skuId], references: [id])

  @@index([orderId], map: "orderItemsOrderIdFkey")
  @@index([productId], map: "orderItemsProductIdFkey")
  @@index([skuId], map: "orderItemsSkuIdFkey")
}

model orders {
  id                           String                @id
  orderNo                      String                @unique
  totalAmount                  Float
  discountAmount               Float                 @default(0)
  finalAmount                  Float
  status                       orders_status         @default(PENDING)
  paymentStatus                orders_paymentStatus  @default(UNPAID)
  createdAt                    DateTime              @default(now())
  updatedAt                    DateTime
  paidAt                       DateTime?
  shippedAt                    DateTime?
  deliveredAt                  DateTime?
  buyerId                      String
  buyerNotes                   String?
  cancelledAt                  DateTime?
  cashAmount                   Float?
  completedAt                  DateTime?
  metadata                     String?
  paymentMethod                orders_paymentMethod?
  pointsAmount                 Float?
  promotionInfo                String?
  sellerId                     String?
  sellerNotes                  String?
  shippingAddress              String?
  shippingFee                  Float                 @default(0)
  type                         orders_type
  giftRecords                  giftRecords[]
  logisticsInfo                logisticsInfo?
  logisticsShipments           logisticsShipments[]
  orderItems                   orderItems[]
  users_orders_buyerIdTousers  users                 @relation("orders_buyerIdTousers", fields: [buyerId], references: [id])
  users_orders_sellerIdTousers users?                @relation("orders_sellerIdTousers", fields: [sellerId], references: [id])
  paymentRecords               paymentRecords[]

  @@index([buyerId], map: "ordersBuyerIdFkey")
  @@index([buyerId, status], map: "ordersBuyerStatusIdx")
  @@index([paymentStatus], map: "ordersPaymentStatusIdx")
  @@index([sellerId], map: "ordersSellerIdFkey")
  @@index([createdAt])
  @@index([status])
}

model paymentLocks {
  id        String   @id
  lockKey   String   @unique
  orderId   String
  userId    String
  amount    Float
  expiresAt DateTime
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@index([expiresAt])
  @@index([lockKey])
  @@index([orderId])
  @@index([userId])
}

model paymentLogs {
  id             String                    @id
  paymentId      String
  action         paymentLogs_action
  description    String
  beforeStatus   paymentLogs_beforeStatus?
  afterStatus    paymentLogs_afterStatus?
  requestData    String?
  responseData   String?
  operatorId     String?
  clientIp       String?
  userAgent      String?
  extra          String?
  createdAt      DateTime                  @default(now())
  users          users?                    @relation(fields: [operatorId], references: [id])
  paymentRecords paymentRecords            @relation(fields: [paymentId], references: [id], onDelete: Cascade)

  @@index([operatorId], map: "paymentLogsOperatorIdFkey")
  @@index([action])
  @@index([createdAt])
  @@index([paymentId])
}

model paymentCallbackLogs {
  id              String   @id
  provider        String   // WECHAT, ALIPAY
  orderId         String?  // 关联的订单ID
  transactionId   String?  // 支付平台交易号
  callbackId      String   // 回调唯一标识
  ip              String   // 请求IP
  action          String   // RECEIVED, VERIFIED, PROCESSED, FAILED, REJECTED
  details         Json     // 详细信息
  rawRequest      String?  // 原始请求数据
  processingTime  Int?     // 处理耗时（毫秒）
  createdAt       DateTime @default(now())

  @@index([provider, callbackId])
  @@index([orderId])
  @@index([transactionId])
  @@index([ip])
  @@index([action])
  @@index([createdAt])
}

model paymentRetryTasks {
  id            String   @id
  type          String   // PAYMENT_PROCESS, COMMISSION_CALC, INVENTORY_ADJUST, REFUND_PROCESS
  data          Json     // 任务数据
  attempt       Int      @default(0)
  maxRetries    Int      @default(5)
  nextRetryAt   DateTime
  lastError     String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime

  @@index([type, nextRetryAt])
  @@index([attempt])
}

model paymentCompensations {
  id            String                           @id
  orderId       String
  transactionId String?
  type          paymentCompensations_type
  status        paymentCompensations_status     @default(PENDING)
  reason        String
  data          Json
  createdAt     DateTime                         @default(now())
  processedAt   DateTime?
  updatedAt     DateTime                         @default(now())

  @@index([orderId])
  @@index([transactionId])
  @@index([type, status])
}

model paymentReconciliations {
  id              String                        @id
  reconcileNo     String                        @unique
  reconcileDate   DateTime
  totalCount      Int                           @default(0)
  totalAmount     Float                         @default(0)
  successCount    Int                           @default(0)
  successAmount   Float                         @default(0)
  failedCount     Int                           @default(0)
  failedAmount    Float                         @default(0)
  status          paymentReconciliations_status @default(PENDING)
  errorMessage    String?
  channelDataFile String?
  systemDataFile  String?
  reportFile      String?
  extra           String?
  createdAt       DateTime                      @default(now())
  updatedAt       DateTime
  completedAt     DateTime?

  @@index([reconcileDate])
  @@index([status])
}

model paymentRecords {
  id                   String                        @id
  orderId              String?
  paymentMethod        paymentRecords_paymentMethod
  amount               Float
  status               paymentRecords_status
  paidAt               DateTime?
  createdAt            DateTime                      @default(now())
  updatedAt            DateTime
  channelOrderId       String?
  channelTransactionId String?
  clientIp             String?
  currency             String                        @default("CNY")
  description          String?
  expiredAt            DateTime?
  extra                String?
  notifiedAt           DateTime?
  notifyData           String?
  paymentChannel       paymentRecords_paymentChannel
  paymentNo            String                        @unique
  prepayId             String?
  subject              String?
  userAgent            String?
  userId               String
  paymentLogs          paymentLogs[]
  orders               orders?                       @relation(fields: [orderId], references: [id])
  users                users                         @relation(fields: [userId], references: [id])
  paymentRefunds       paymentRefunds[]

  @@index([channelOrderId])
  @@index([createdAt])
  @@index([orderId])
  @@index([paymentChannel])
  @@index([status])
  @@index([userId])
}

model paymentRefunds {
  id                                        String                @id
  refundNo                                  String                @unique
  paymentId                                 String
  refundAmount                              Float
  refundReason                              String?
  applyUserId                               String
  approveUserId                             String?
  channelRefundId                           String?
  channelTransactionId                      String?
  status                                    paymentRefunds_status @default(PENDING)
  refundedAt                                DateTime?
  failedReason                              String?
  notifyData                                String?
  notifiedAt                                DateTime?
  extra                                     String?
  createdAt                                 DateTime              @default(now())
  updatedAt                                 DateTime
  users_paymentRefunds_applyUserIdTousers   users                 @relation("paymentRefunds_applyUserIdTousers", fields: [applyUserId], references: [id])
  users_paymentRefunds_approveUserIdTousers users?                @relation("paymentRefunds_approveUserIdTousers", fields: [approveUserId], references: [id])
  paymentRecords                            paymentRecords        @relation(fields: [paymentId], references: [id], onDelete: Cascade)

  @@index([approveUserId], map: "paymentRefundsApproveUserIdFkey")
  @@index([applyUserId])
  @@index([paymentId])
  @@index([status])
}

model performanceMetrics {
  id                 String                         @id
  userId             String
  period             String
  personalSales      Float                          @default(0)
  personalOrders     Int                            @default(0)
  newCustomers       Int                            @default(0)
  repeatRate         Float                          @default(0)
  averageOrderValue  Float                          @default(0)
  teamSales          Float                          @default(0)
  teamOrders         Int                            @default(0)
  newMembers         Int                            @default(0)
  activeRate         Float                          @default(0)
  directReferrals    Int                            @default(0)
  referralRevenue    Float                          @default(0)
  currentRole        performanceMetrics_currentRole @default(MEMBER)
  progressPercentage Float                          @default(0)
  requirementsMet    Json?
  calculationDate    DateTime                       @default(now())
  createdAt          DateTime                       @default(now())
  updatedAt          DateTime
  users              users                          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, period])
}

model pointsTransactions {
  id                                         String                    @id
  transactionNo                              String                    @unique
  fromUserId                                 String?
  toUserId                                   String
  amount                                     Float
  type                                       pointsTransactions_type
  relatedOrderId                             String?
  description                                String?
  metadata                                   Json?
  status                                     pointsTransactions_status @default(PENDING)
  balanceBefore                              Float
  balanceAfter                               Float
  createdAt                                  DateTime                  @default(now())
  completedAt                                DateTime?
  users_pointsTransactions_fromUserIdTousers users?                    @relation("pointsTransactions_fromUserIdTousers", fields: [fromUserId], references: [id])
  users_pointsTransactions_toUserIdTousers   users                     @relation("pointsTransactions_toUserIdTousers", fields: [toUserId], references: [id])

  @@index([fromUserId], map: "pointsTransactionsFromUserIdFkey")
  @@index([toUserId], map: "pointsTransactionsToUserIdFkey")
  @@index([fromUserId, toUserId], map: "idx_points_transactions_user")
  @@index([fromUserId, createdAt], map: "idx_points_transactions_from_time")
  @@index([toUserId, createdAt], map: "idx_points_transactions_to_time")
  @@index([type, createdAt], map: "idx_points_transactions_type_time")
  @@index([status, createdAt], map: "idx_points_transactions_status_time")
}

model productCategories {
  id                      String              @id
  name                    String
  parentId                String?
  level                   Int                 @default(1)
  sort                    Int                 @default(0)
  icon                    String?
  description             String?
  isActive                Boolean             @default(true)
  createdAt               DateTime            @default(now())
  updatedAt               DateTime
  productCategories       productCategories?  @relation("productCategoriesToproductCategories", fields: [parentId], references: [id])
  other_productCategories productCategories[] @relation("productCategoriesToproductCategories")
  products                products[]

  @@index([parentId], map: "productCategoriesParentIdFkey")
  @@index([isActive, level, sort], map: "idx_categories_level_sort")
  @@index([isActive, parentId], map: "idx_categories_parent_active")
  @@index([isActive, sort], map: "idx_categories_active_sort")
}

model productPricings {
  id           String                    @id
  productId    String
  specId       String?
  userLevel    productPricings_userLevel
  price        Float
  createdAt    DateTime                  @default(now())
  updatedAt    DateTime
  products     products                  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productSpecs productSpecs?             @relation(fields: [specId], references: [id])

  @@unique([productId, specId, userLevel])
  @@index([specId], map: "productPricingsSpecIdFkey")
  @@index([productId, userLevel], map: "idx_pricings_product_level")
}

model productSpecs {
  id              String            @id
  productId       String
  name            String
  sku             String            @unique
  price           Float
  stock           Int               @default(0)
  minStock        Int               @default(10)
  images          String?
  isActive        Boolean           @default(true)
  sort            Int               @default(0)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  inventoryAlerts inventoryAlerts[]
  inventoryItems  inventoryItems[]
  inventoryLogs   inventoryLogs[]
  inventoryStocks inventoryStocks[]
  orderItems      orderItems[]
  productPricings productPricings[]
  products        products          @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId], map: "productSpecsProductIdFkey")
  @@index([productId, isActive, sort], map: "idx_specs_product_active_sort")
  @@index([productId, name], map: "idx_specs_product_name")
  @@index([isActive, sort], map: "idx_specs_active_sort")
}

model productTagLinks {
  id          String      @id
  productId   String
  tagId       String
  createdAt   DateTime    @default(now())
  products    products    @relation(fields: [productId], references: [id], onDelete: Cascade)
  productTags productTags @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([productId, tagId])
  @@index([tagId], map: "productTagLinksTagIdFkey")
}

model productTags {
  id              String            @id
  name            String            @unique
  color           String?
  description     String?
  sort            Int               @default(0)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  productTagLinks productTagLinks[]

  @@index([name, sort], map: "idx_tags_name_sort")
  @@index([sort], map: "idx_tags_sort")
}

model products {
  id                String            @id
  categoryId        String
  name              String
  description       String?
  code              String            @unique
  sku               String            @unique
  basePrice         Float
  totalStock        Int               @default(0)
  minStock          Int               @default(10)
  images            String
  videoUrl          String?
  details           Json?
  status            products_status   @default(ACTIVE)
  isFeatured        Boolean           @default(false)
  sort              Int               @default(0)
  scheduleOnAt      DateTime?
  scheduleOffAt     DateTime?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  shopId            String?
  giftRecords       giftRecords[]
  inventoryAlerts   inventoryAlerts[]
  inventoryItems    inventoryItems[]
  inventoryLogs     inventoryLogs[]
  inventoryStocks   inventoryStocks[]
  orderItems        orderItems[]
  productPricings   productPricings[]
  productSpecs      productSpecs[]
  productTagLinks   productTagLinks[]
  productCategories productCategories @relation(fields: [categoryId], references: [id])
  shops             shops?            @relation(fields: [shopId], references: [id])
  purchaseOrders    purchaseOrders[]

  @@index([categoryId], map: "productsCategoryIdFkey")
  @@index([shopId], map: "productsShopIdFkey")
  @@index([status, isFeatured, sort, createdAt], map: "idx_products_status_featured")
  @@index([status, categoryId, sort], map: "idx_products_status_category")
  @@index([status, sort, createdAt], map: "idx_products_status_sort")
  @@index([name], map: "idx_products_name")
  @@index([code], map: "idx_products_code")
  @@index([sku], map: "idx_products_sku")
}

model purchaseOrders {
  id                                   String                @id
  orderNo                              String                @unique
  buyerId                              String
  sellerId                             String
  productId                            String
  quantity                             Int
  unitPrice                            Float
  totalAmount                          Float
  purchasePath                         String
  commissionDetails                    Json?
  status                               purchaseOrders_status @default(PENDING)
  createdAt                            DateTime              @default(now())
  updatedAt                            DateTime
  completedAt                          DateTime?
  users_purchaseOrders_buyerIdTousers  users                 @relation("purchaseOrders_buyerIdTousers", fields: [buyerId], references: [id])
  products                             products              @relation(fields: [productId], references: [id])
  users_purchaseOrders_sellerIdTousers users                 @relation("purchaseOrders_sellerIdTousers", fields: [sellerId], references: [id])

  @@index([buyerId], map: "purchaseOrdersBuyerIdFkey")
  @@index([productId], map: "purchaseOrdersProductIdFkey")
  @@index([sellerId], map: "purchaseOrdersSellerIdFkey")
}

model referralRelationships {
  id                 String                                 @id
  referrerId         String
  refereeId          String
  relationshipType   referralRelationships_relationshipType @default(DIRECT)
  level              Int                                    @default(1)
  path               String
  referralSales      Float                                  @default(0)
  referralCommission Float                                  @default(0)
  isActive           Boolean                                @default(true)
  establishedDate    DateTime                               @default(now())
  lastActiveDate     DateTime?
  createdAt          DateTime                               @default(now())
  updatedAt          DateTime
}

model shops {
  id              String            @id
  userId          String
  shopType        shops_shopType
  shopLevel       Int               @default(1)
  shopName        String?
  shopDescription String?
  contactName     String?
  contactPhone    String?
  address         String?
  totalSales      Float             @default(0)
  totalOrders     Int               @default(0)
  totalRevenue    Float             @default(0)
  status          shops_status      @default(PENDING)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  inventoryAlerts inventoryAlerts[]
  inventoryItems  inventoryItems[]
  inventoryLogs   inventoryLogs[]
  inventoryStocks inventoryStocks[]
  products        products[]
  users           users             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "shopsUserIdFkey")
}

model smsVerifications {
  id        String                @id
  phone     String
  code      String
  type      smsVerifications_type
  attempts  Int                   @default(0)
  isUsed    Boolean               @default(false)
  expiresAt DateTime
  createdAt DateTime              @default(now())
}

model systemConfigs {
  id             String             @id
  key            String             @unique
  value          String             @db.LongText
  description    String?
  category       String
  type           systemConfigs_type
  lastModifiedBy String?
  createdAt      DateTime           @default(now())
  updatedAt      DateTime
  isEditable     Boolean            @default(true)
  isSystem       Boolean            @default(false)

  @@index([category])
  @@index([type])
}

model teamMembers {
  id             String             @id
  userId         String             @unique
  teamId         String
  role           teamMembers_role   @default(MEMBER)
  level          Int                @default(1)
  status         teamMembers_status @default(ACTIVE)
  position       String?
  referrerId     String?
  uplineId       String?
  personalSales  Float              @default(0)
  teamSales      Float              @default(0)
  directCount    Int                @default(0)
  teamCount      Int                @default(0)
  joinDate       DateTime           @default(now())
  promotedDate   DateTime?
  lastActiveDate DateTime?
  createdAt      DateTime           @default(now())
  updatedAt      DateTime
  teams          teams              @relation(fields: [teamId], references: [id], onDelete: Cascade)
  users          users              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([teamId], map: "teamMembersTeamIdFkey")
}

model teams {
  id              String        @id
  name            String
  description     String?
  leaderId        String
  totalMembers    Int           @default(0)
  activeMembers   Int           @default(0)
  totalLevels     Int           @default(1)
  totalSales      Float         @default(0)
  status          teams_status  @default(ACTIVE)
  establishedDate DateTime      @default(now())
  createdAt       DateTime      @default(now())
  updatedAt       DateTime
  teamMembers     teamMembers[]
  users           users         @relation(fields: [leaderId], references: [id])

  @@index([leaderId], map: "teamsLeaderIdFkey")
}

model users {
  id                                                      String                   @id
  openid                                                  String                   @unique
  nickname                                                String?
  avatarUrl                                               String?
  phone                                                   String?                  @unique
  email                                                   String?                  @unique
  level                                                   users_level              @default(NORMAL)
  status                                                  users_status             @default(ACTIVE)
  parentId                                                String?
  teamPath                                                String?
  teamLevel                                               Int                      @default(1)
  totalSales                                              Float                    @default(0)
  totalBottles                                            Int                      @default(0)
  directSales                                             Float                    @default(0)
  teamSales                                               Float                    @default(0)
  directCount                                             Int                      @default(0)
  teamCount                                               Int                      @default(0)
  cloudShopLevel                                          Int?
  hasWutongShop                                           Boolean                  @default(false)
  pointsBalance                                           Float                    @default(0)
  pointsFrozen                                            Float                    @default(0)
  createdAt                                               DateTime                 @default(now())
  updatedAt                                               DateTime                 @default(now())
  lastLoginAt                                             DateTime?
  referralCode                                            String?                  @unique
  userNumber                                              String?                  @unique
  password                                                String?
  commissionCalculations                                  commissionCalculations[]
  giftRecords                                             giftRecords[]
  inventoryAlerts_inventoryAlerts_resolvedByTousers       inventoryAlerts[]        @relation("inventoryAlerts_resolvedByTousers")
  inventoryAlerts_inventoryAlerts_userIdTousers           inventoryAlerts[]        @relation("inventoryAlerts_userIdTousers")
  inventoryItems                                          inventoryItems[]
  inventoryLogs_inventoryLogs_operatorIdTousers           inventoryLogs[]          @relation("inventoryLogs_operatorIdTousers")
  inventoryLogs_inventoryLogs_userIdTousers               inventoryLogs[]          @relation("inventoryLogs_userIdTousers")
  inventoryStocks                                         inventoryStocks[]
  levelUpgradeRecords                                     levelUpgradeRecords[]
  logisticsShipments                                      logisticsShipments[]
  notificationPreferences                                 notificationPreferences?
  notifications                                           notifications[]
  orders_orders_buyerIdTousers                            orders[]                 @relation("orders_buyerIdTousers")
  orders_orders_sellerIdTousers                           orders[]                 @relation("orders_sellerIdTousers")
  paymentLogs                                             paymentLogs[]
  paymentRecords                                          paymentRecords[]
  paymentRefunds_paymentRefunds_applyUserIdTousers        paymentRefunds[]         @relation("paymentRefunds_applyUserIdTousers")
  paymentRefunds_paymentRefunds_approveUserIdTousers      paymentRefunds[]         @relation("paymentRefunds_approveUserIdTousers")
  performanceMetrics                                      performanceMetrics[]
  pointsTransactions_pointsTransactions_fromUserIdTousers pointsTransactions[]     @relation("pointsTransactions_fromUserIdTousers")
  pointsTransactions_pointsTransactions_toUserIdTousers   pointsTransactions[]     @relation("pointsTransactions_toUserIdTousers")
  purchaseOrders_purchaseOrders_buyerIdTousers            purchaseOrders[]         @relation("purchaseOrders_buyerIdTousers")
  purchaseOrders_purchaseOrders_sellerIdTousers           purchaseOrders[]         @relation("purchaseOrders_sellerIdTousers")
  shops                                                   shops[]
  teamMembers                                             teamMembers?
  teams                                                   teams[]
  users                                                   users?                   @relation("usersTousers", fields: [parentId], references: [id])
  other_users                                             users[]                  @relation("usersTousers")

  @@index([phone, id], map: "idx_users_phone_id")
  @@index([parentId], map: "usersParentIdFkey")
}

enum notificationChannels_channelType {
  IN_APP
  SMS
  EMAIL
  WECHAT_MINI
  WECHAT_OFFICIAL
  PUSH
  WEBHOOK
}

enum levelUpgradeRecords_previousLevel {
  NORMAL
  VIP
  STAR_1
  STAR_2
  STAR_3
  STAR_4
  STAR_5
  DIRECTOR
}

enum notifications_recipientType {
  USER
  ADMIN
  SYSTEM
  GROUP
}

enum notificationStatistics_category {
  SYSTEM
  ORDER
  PAYMENT
  LOGISTICS
  USER_LEVEL
  SHOP
  INVENTORY
  PROMOTION
  ANNOUNCEMENT
  SECURITY
  FINANCIAL
  TEAM
  ACTIVITY
}

enum paymentLogs_action {
  CREATE
  QUERY
  SUCCESS
  FAILED
  CANCEL
  CLOSE
  EXPIRE
  NOTIFY
  REFUND_CREATE
  REFUND_SUCCESS
  REFUND_FAILED
}

enum paymentRecords_paymentMethod {
  WECHAT
  ALIPAY
  POINTS
  MIXED
}

enum shops_shopType {
  CLOUD
  WUTONG
}

enum inventoryStocks_warehouseType {
  PLATFORM
  CLOUD
  LOCAL
}

enum levelUpgradeRecords_newLevel {
  NORMAL
  VIP
  STAR_1
  STAR_2
  STAR_3
  STAR_4
  STAR_5
  DIRECTOR
}

enum notificationStatistics_channelType {
  IN_APP
  SMS
  EMAIL
  WECHAT_MINI
  WECHAT_OFFICIAL
  PUSH
  WEBHOOK
}

enum notificationTemplates_category {
  SYSTEM
  ORDER
  PAYMENT
  LOGISTICS
  USER_LEVEL
  SHOP
  INVENTORY
  PROMOTION
  ANNOUNCEMENT
  SECURITY
  FINANCIAL
  TEAM
  ACTIVITY
}

enum productPricings_userLevel {
  NORMAL
  VIP
  STAR_1
  STAR_2
  STAR_3
  STAR_4
  STAR_5
  DIRECTOR
}

enum referralRelationships_relationshipType {
  DIRECT
  INDIRECT
  NETWORK
}

enum smsVerifications_type {
  BIND
  UNBIND
  LOGIN
  TRANSFER
}

enum teamMembers_role {
  MEMBER
  CAPTAIN
  MANAGER
  DIRECTOR
  SENIOR_DIRECTOR
  PARTNER
  AMBASSADOR
}

enum levelUpgradeRecords_upgradeType {
  AUTO
  MANUAL
  WUTONG_PRIVILEGE
  TEAM_ACHIEVEMENT
  SPECIAL_PROMOTION
}

enum logisticsInfo_status {
  NOT_SHIPPED
  SHIPPED
  IN_TRANSIT
  OUT_FOR_DELIVERY
  DELIVERED
  EXCEPTION
}

enum notifications_category {
  SYSTEM
  ORDER
  PAYMENT
  LOGISTICS
  USER_LEVEL
  SHOP
  INVENTORY
  PROMOTION
  ANNOUNCEMENT
  SECURITY
  FINANCIAL
  TEAM
  ACTIVITY
}

enum paymentLogs_beforeStatus {
  UNPAID
  PAYING
  PAID
  FAILED
  REFUNDING
  REFUNDED
}

enum paymentRecords_status {
  UNPAID
  PAYING
  PAID
  FAILED
  REFUNDING
  REFUNDED
}

enum inventoryAlerts_alertType {
  LOW_STOCK
  OUT_OF_STOCK
  EXCESS_STOCK
  EXPIRED
}

enum inventoryItems_warehouseType {
  PLATFORM
  CLOUD
  LOCAL
}

enum inventoryLogs_operationType {
  MANUAL_IN
  MANUAL_OUT
  ORDER_OUT
  PURCHASE_IN
  ADJUSTMENT
  TRANSFER_IN
  TRANSFER_OUT
  RETURN_IN
  DAMAGE_OUT
  INITIAL
}

enum notifications_type {
  INFO
  SUCCESS
  WARNING
  ERROR
  REMINDER
  PROMOTION
  ANNOUNCEMENT
  ALERT
}

enum orders_status {
  PENDING
  PAID
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum paymentLogs_afterStatus {
  UNPAID
  PAYING
  PAID
  FAILED
  REFUNDING
  REFUNDED
}

enum pointsTransactions_type {
  PURCHASE
  TRANSFER
  RECHARGE
  WITHDRAW
  REFUND
  COMMISSION
  REWARD
  FREEZE
  UNFREEZE
}

enum systemConfigs_type {
  JSON
  STRING
  NUMBER
  BOOLEAN
  ARRAY
}

enum teamMembers_status {
  ACTIVE
  INACTIVE
  SUSPENDED
  TERMINATED
}

enum users_level {
  NORMAL
  VIP
  STAR_1
  STAR_2
  STAR_3
  STAR_4
  STAR_5
  DIRECTOR
}

enum giftRecords_type {
  BUY_TEN_GET_ONE
  PROMOTION_GIFT
  VIP_GIFT
  WUTONG_BUY_TEN_GET_ONE
  REWARD_GIFT
  COMPENSATION_GIFT
}

enum orders_paymentStatus {
  UNPAID
  PAYING
  PAID
  FAILED
  REFUNDING
  REFUNDED
}

enum users_status {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum admins_role {
  SUPER_ADMIN
  ADMIN
  OPERATOR
}

enum giftRecords_status {
  PENDING
  PROCESSING
  SHIPPED
  COMPLETED
  CANCELLED
  EXPIRED
}

enum logisticsCompanies_serviceScope {
  NATIONAL
  INTERNATIONAL
  LOCAL
  SAME_CITY
}

enum admins_status {
  ACTIVE
  INACTIVE
  LOCKED
}

enum commissionCalculations_status {
  PENDING
  CALCULATED
  APPROVED
  PAID
  CANCELLED
}

enum inventoryAlerts_warehouseType {
  PLATFORM
  CLOUD
  LOCAL
}

enum logisticsTracks_source {
  MANUAL
  API
  WEBHOOK
  IMPORT
}

enum teams_status {
  ACTIVE
  INACTIVE
  SUSPENDED
  TERMINATED
}

enum inventoryLogs_warehouseType {
  PLATFORM
  CLOUD
  LOCAL
}

enum paymentReconciliations_status {
  PENDING
  PROCESSING
  SUCCESS
  FAILED
  CANCELLED
}

enum paymentRefunds_status {
  PENDING
  PROCESSING
  SUCCESS
  FAILED
  CANCELLED
}

enum pointsTransactions_status {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}

enum purchaseOrders_status {
  PENDING
  APPROVED
  REJECTED
  COMPLETED
  CANCELLED
}

enum notificationTemplates_priority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum notifications_status {
  PENDING
  SENDING
  SENT
  PARTIAL_SUCCESS
  FAILED
  COMPLETED
  CANCELLED
  RETRYING
}

enum products_status {
  ACTIVE
  INACTIVE
  PRESALE
  OUT_OF_STOCK
}

enum shops_status {
  PENDING
  APPROVED
  ACTIVE
  SUSPENDED
  CLOSED
}

enum notifications_priority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum inventoryLogs_operatorType {
  SYSTEM
  ADMIN
  USER
  SYSTEM_BATCH
}

enum performanceMetrics_currentRole {
  MEMBER
  CAPTAIN
  MANAGER
  DIRECTOR
  SENIOR_DIRECTOR
  PARTNER
  AMBASSADOR
}

enum paymentRecords_paymentChannel {
  WECHAT
  ALIPAY
  POINTS
  MIXED
}

enum orders_paymentMethod {
  WECHAT
  ALIPAY
  POINTS
  MIXED
}

enum orders_type {
  RETAIL
  PURCHASE
  TEAM
  EXCHANGE
}

enum logisticsShipments_deliveryType {
  STANDARD
  EXPRESS
  SAME_DAY
  NEXT_DAY
  PICKUP
}

enum logisticsShipments_status {
  NOT_SHIPPED
  SHIPPED
  IN_TRANSIT
  OUT_FOR_DELIVERY
  DELIVERED
  EXCEPTION
}

enum logisticsShipments_syncStatus {
  PENDING
  SYNCING
  SUCCESS
  FAILED
}

// 审计日志表
model auditLogs {
  id          String           @id
  adminId     String
  adminName   String?
  type        auditLogs_type
  level       auditLogs_level
  module      String
  action      String
  targetId    String?
  targetType  String?
  description String?
  details     String?          @db.Text
  ipAddress   String?
  userAgent   String?          @db.Text
  result      auditLogs_result @default(SUCCESS)
  errorMessage String?         @db.Text
  duration    Int?             // 操作耗时（毫秒）
  createdAt   DateTime         @default(now())

  @@index([adminId, createdAt])
  @@index([module, action])
  @@index([type, createdAt])
  @@index([level, createdAt])
  @@index([targetId, targetType])
  @@index([createdAt])
}

enum auditLogs_type {
  LOGIN
  LOGOUT
  CREATE
  UPDATE
  DELETE
  VIEW
  EXPORT
  APPROVE
  REJECT
  SUSPEND
  ACTIVATE
  RESET_PASSWORD
  CHANGE_ROLE
  SENSITIVE_OPERATION
  SYSTEM_CONFIG
  DATA_IMPORT
  BULK_OPERATION
}

enum auditLogs_level {
  INFO
  WARNING
  ERROR
  CRITICAL
}

enum auditLogs_result {
  SUCCESS
  FAILED
}

// 支付补偿类型
enum paymentCompensations_type {
  ROLLBACK_ORDER
  REFUND_PAYMENT
  ADJUST_INVENTORY
  CANCEL_COMMISSION
}

// 支付补偿状态
enum paymentCompensations_status {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

// 配置变更历史表
model configChangeHistory {
  id           String   @id
  configId     String
  configKey    String
  oldValue     String   @db.Text
  newValue     String   @db.Text
  changedBy    String
  changeReason String   @db.Text
  createdAt    DateTime @default(now())

  @@index([configId])
  @@index([configKey])
  @@index([changedBy])
  @@index([createdAt])
}

// 安全日志表
model securityLogs {
  id         String            @id
  adminId    String
  type       securityLogs_type
  ipAddress  String
  userAgent  String?           @db.Text
  details    String?           @db.Text
  createdAt  DateTime          @default(now())

  @@index([adminId])
  @@index([type])
  @@index([ipAddress])
  @@index([createdAt])
}

enum securityLogs_type {
  LOGIN_FAILED
  IP_BLOCKED
  SESSION_TIMEOUT
  SUSPICIOUS_OPERATION
  TOKEN_INVALID
}

model banners {
  id          String        @id
  title       String
  image       String
  link        String?
  alt         String?
  description String?
  isActive    Boolean       @default(true) @map("is_active")
  sortOrder   Int           @default(0) @map("sort_order")
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt
}
