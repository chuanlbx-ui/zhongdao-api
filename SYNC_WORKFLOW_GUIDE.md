# æœ¬åœ°ä»£ç ä¸æœåŠ¡å™¨åŒæ­¥å·¥ä½œæµæŒ‡å—

**æ›´æ–°æ—¥æœŸ**: 2025-12-01
**ç‰ˆæœ¬**: 1.0.0

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°äº†å¦‚ä½•å°†æœ¬åœ°ä¿®æ”¹çš„ä»£ç åŒæ­¥åˆ°è¿œç¨‹æœåŠ¡å™¨çš„å®Œæ•´å·¥ä½œæµç¨‹ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬æ§åˆ¶ã€ç¼–è¯‘å’Œéƒ¨ç½²è‡ªåŠ¨åŒ–ã€‚

## ğŸ—ï¸ æ¶æ„è¯´æ˜

### Gitä»“åº“ç»“æ„
```
GitHub Repository: https://github.com/chuanlbx-ui/zd-api.aierxin.com.git
â””â”€â”€ mainåˆ†æ”¯ - ç”Ÿäº§ä»£ç 
```

### æœåŠ¡å™¨ä¿¡æ¯
- **æœåŠ¡å™¨IP**: 220.163.107.50
- **éƒ¨ç½²è·¯å¾„**: /www/wwwroot/zd-api.aierxin.com
- **APIåŸŸå**: https://zd-api.aierxin.com
- **æ•°æ®åº“**: 220.163.107.50:14306

### ç¯å¢ƒé…ç½®
- **æœ¬åœ°å¼€å‘**: è¿æ¥æœ¬åœ°æ•°æ®åº“ (127.0.0.1:3306)
- **æœåŠ¡å™¨åŒæ­¥**: è¿æ¥æœåŠ¡å™¨æ•°æ®åº“ (220.163.107.50:14306)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é¦–æ¬¡è®¾ç½®

```bash
# 1.1 ç¡®ä¿Gitä»“åº“å·²é…ç½®
git remote -v
# åº”è¯¥æ˜¾ç¤º: origin https://github.com/chuanlbx-ui/zd-api.aierxin.com.git

# 1.2 åˆå§‹åŒ–é¡¹ç›®ï¼ˆå¦‚æœéœ€è¦ï¼‰
npm run workflow:setup

# 1.3 æŸ¥çœ‹å½“å‰çŠ¶æ€
npm run workflow:status
```

### 2. æ—¥å¸¸å¼€å‘æµç¨‹

#### åœºæ™¯1ï¼šå®Œæ•´éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# æ‰§è¡Œå®Œæ•´çš„éƒ¨ç½²æµç¨‹
npm run workflow:deploy
```

æ­¤å‘½ä»¤ä¼šè‡ªåŠ¨ï¼š
1. æ£€æŸ¥ä»£ç å˜æ›´
2. åˆ‡æ¢åˆ°æœåŠ¡å™¨åŒæ­¥ç¯å¢ƒ
3. ç¼–è¯‘TypeScriptä»£ç 
4. æäº¤åˆ°Gitä»“åº“
5. éƒ¨ç½²åˆ°ç”Ÿäº§æœåŠ¡å™¨
6. éªŒè¯éƒ¨ç½²ç»“æœ

#### åœºæ™¯2ï¼šä»…æäº¤ä»£ç 

```bash
# åªæäº¤ä»£ç åˆ°Gitï¼Œä¸éƒ¨ç½²
npm run workflow:commit
```

#### åœºæ™¯3ï¼šä»…éƒ¨ç½²ï¼ˆä»£ç å·²æäº¤ï¼‰

```bash
# åªéƒ¨ç½²æœåŠ¡å™¨ï¼ˆä½¿ç”¨æœ€æ–°æäº¤ï¼‰
npm run workflow:deploy
```

## ğŸ“ è¯¦ç»†æ“ä½œæ­¥éª¤

### æ–¹å¼ä¸€ï¼šè‡ªåŠ¨åŒ–å·¥ä½œæµï¼ˆæ¨èï¼‰

#### 1. æœ¬åœ°å¼€å‘é˜¶æ®µ

```bash
# åˆ‡æ¢åˆ°æœ¬åœ°å¼€å‘ç¯å¢ƒ
npm run env:switch-local

# å¯åŠ¨æœ¬åœ°å¼€å‘æœåŠ¡å™¨
npm run dev:local
```

#### 2. ä»£ç ä¿®æ”¹åéƒ¨ç½²

```bash
# æ‰§è¡Œè‡ªåŠ¨åŒ–éƒ¨ç½²
npm run workflow:deploy
```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨æ“ä½œ

#### 1. åˆ‡æ¢ç¯å¢ƒ

```bash
# åˆ‡æ¢åˆ°æœåŠ¡å™¨åŒæ­¥ç¯å¢ƒ
npm run env:switch-server
```

#### 2. ç¼–è¯‘ä»£ç 

```bash
# ç¼–è¯‘TypeScript
npm run build
```

#### 3. Gitæ“ä½œ

```bash
# æŸ¥çœ‹å˜æ›´
git status

# æ·»åŠ æ‰€æœ‰æ›´æ”¹
git add .

# æäº¤ï¼ˆè¾“å…¥æœ‰æ„ä¹‰çš„æäº¤ä¿¡æ¯ï¼‰
git commit -m "feat: æ·»åŠ æ–°åŠŸèƒ½"

# æ¨é€åˆ°è¿œç¨‹ä»“åº“
git push origin main
```

#### 4. éƒ¨ç½²åˆ°æœåŠ¡å™¨

```bash
# ä½¿ç”¨ç°æœ‰çš„åŒæ­¥è„šæœ¬
npm run sync:server
```

### æ–¹å¼ä¸‰ï¼šä½¿ç”¨PowerShellè„šæœ¬

```powershell
# æŸ¥çœ‹å¸®åŠ©
.\scripts\deploy-workflow.ps1 help

# æ‰§è¡Œå®Œæ•´æµç¨‹
.\scripts\deploy-workflow.ps1 all

# ä»…æäº¤ä»£ç 
.\scripts\deploy-workflow.ps1 commit

# æŸ¥çœ‹çŠ¶æ€
.\scripts\deploy-workflow.ps1 status
```

## ğŸ”§ ç¯å¢ƒç®¡ç†å‘½ä»¤

### ç¯å¢ƒåˆ‡æ¢

```bash
# åˆ‡æ¢åˆ°æœ¬åœ°å¼€å‘ç¯å¢ƒï¼ˆè¿æ¥æœ¬åœ°æ•°æ®åº“ï¼‰
npm run env:switch-local
npm run dev:local

# åˆ‡æ¢åˆ°æœåŠ¡å™¨åŒæ­¥ç¯å¢ƒï¼ˆè¿æ¥æœåŠ¡å™¨æ•°æ®åº“ï¼‰
npm run env:switch-server
npm run dev:prod
```

### éªŒè¯ç¯å¢ƒ

```bash
# æŸ¥çœ‹å½“å‰çŠ¶æ€
npm run workflow:status

# å¥åº·æ£€æŸ¥ï¼ˆæœåŠ¡å™¨ç¯å¢ƒï¼‰
curl https://zd-api.aierxin.com/health

# æœ¬åœ°å¥åº·æ£€æŸ¥
curl http://localhost:3003/health
```

## ğŸ“Š å·¥ä½œæµå‘½ä»¤å‚è€ƒ

### NPMè„šæœ¬å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `npm run workflow:deploy` | æ‰§è¡Œå®Œæ•´éƒ¨ç½²æµç¨‹ |
| `npm run workflow:commit` | ä»…æäº¤ä»£ç åˆ°Git |
| `npm run workflow:status` | æŸ¥çœ‹å½“å‰çŠ¶æ€ |
| `npm run workflow:setup` | åˆå§‹åŒ–é¡¹ç›®è®¾ç½® |
| `npm run env:switch-server` | åˆ‡æ¢åˆ°æœåŠ¡å™¨ç¯å¢ƒ |
| `npm run env:switch-local` | åˆ‡æ¢åˆ°æœ¬åœ°ç¯å¢ƒ |
| `npm run dev:prod` | ä»¥ç”Ÿäº§æ¨¡å¼å¯åŠ¨ |
| `npm run dev:local` | ä»¥å¼€å‘æ¨¡å¼å¯åŠ¨ |

### PowerShellè„šæœ¬é€‰é¡¹

| å‚æ•° | è¯´æ˜ |
|------|------|
| `all` | æ‰§è¡Œå®Œæ•´æµç¨‹ï¼ˆé»˜è®¤ï¼‰ |
| `commit` | ä»…æäº¤ä»£ç åˆ°Git |
| `deploy` | ä»…éƒ¨ç½²åˆ°æœåŠ¡å™¨ |
| `status` | æŸ¥çœ‹å½“å‰çŠ¶æ€ |
| `setup` | åˆå§‹åŒ–è®¾ç½® |
| `help` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ |

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ç¯å¢ƒéš”ç¦»

- æœ¬åœ°å¼€å‘æ—¶ä½¿ç”¨ `npm run dev:local`ï¼Œè¿æ¥æœ¬åœ°æ•°æ®åº“
- éƒ¨ç½²å‰ä½¿ç”¨ `npm run dev:prod` éªŒè¯ä»£ç åœ¨æœåŠ¡å™¨ç¯å¢ƒæ˜¯å¦æ­£å¸¸
- åˆ‡æ¢ç¯å¢ƒååŠ¡å¿…é‡å¯å¼€å‘æœåŠ¡å™¨

### 2. Gitæäº¤è§„èŒƒ

å»ºè®®çš„æäº¤ä¿¡æ¯æ ¼å¼ï¼š
- `feat:` æ–°åŠŸèƒ½
- `fix:` ä¿®å¤bug
- `docs:` æ–‡æ¡£æ›´æ–°
- `style:` ä»£ç æ ¼å¼è°ƒæ•´
- `refactor:` ä»£ç é‡æ„
- `test:` æµ‹è¯•ç›¸å…³
- `chore:` æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨

ç¤ºä¾‹ï¼š
```bash
git commit -m "feat: æ·»åŠ ç”¨æˆ·ç®¡ç†æ¨¡å—"
git commit -m "fix: ä¿®å¤ç§¯åˆ†è®¡ç®—é”™è¯¯"
```

### 3. éƒ¨ç½²å‰æ£€æŸ¥

- [ ] ä»£ç å·²é€šè¿‡TypeScriptç¼–è¯‘ (`npm run build`)
- [ ] æœ¬åœ°æµ‹è¯•å·²é€šè¿‡
- [ ] ç¯å¢ƒå˜é‡å·²æ­£ç¡®é…ç½®
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] é‡è¦åŠŸèƒ½å·²æµ‹è¯•

### 4. å›æ»šç­–ç•¥

å¦‚æœéƒ¨ç½²å‡ºç°é—®é¢˜ï¼š

```bash
# 1. å›æ»šGitç‰ˆæœ¬
git reset --hard HEAD~1
git push -f origin main

# 2. æœåŠ¡å™¨å›æ»šï¼ˆéœ€è¦SSHç™»å½•ï¼‰
ssh root@220.163.107.50
cd /www/wwwroot/zd-api.aierxin.com
pm2 reload zd-api

# 3. æŸ¥çœ‹æ—¥å¿—
pm2 logs zd-api
```

## ğŸ› å¸¸è§é—®é¢˜

### Q1: ç¼–è¯‘å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
A: æ£€æŸ¥TypeScriptç±»å‹é”™è¯¯ï¼š
```bash
npm run type-check
```

### Q2: éƒ¨ç½²åAPIæ— æ³•è®¿é—®ï¼Ÿ
A: æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€ï¼š
```bash
# æŸ¥çœ‹PM2çŠ¶æ€
ssh root@220.163.107.50 'pm2 status'

# æŸ¥çœ‹æ—¥å¿—
ssh root@220.163.107.50 'pm2 logs zd-api --lines 50'
```

### Q3: Gitæ¨é€å¤±è´¥ï¼Ÿ
A: å¯èƒ½æ˜¯æƒé™é—®é¢˜æˆ–åˆ†æ”¯å†²çªï¼š
```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# è§£å†³å†²çªåé‡æ–°æäº¤
git add .
git commit -m "è§£å†³å†²çª"
git push origin main
```

### Q4: æ•°æ®åº“è¿æ¥é”™è¯¯ï¼Ÿ
A: æ£€æŸ¥ç¯å¢ƒé…ç½®ï¼š
```bash
# æŸ¥çœ‹å½“å‰ç¯å¢ƒ
npm run workflow:status

# ç¡®è®¤æ•°æ®åº“è¿æ¥
grep -E "DB_HOST|DB_PORT|DB_NAME" .env.local
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### æœ‰ç”¨é“¾æ¥

- [GitHubä»“åº“](https://github.com/chuanlbx-ui/zd-api.aierxin.com)
- [APIæ–‡æ¡£](https://zd-api.aierxin.com/api-docs)
- [å¥åº·æ£€æŸ¥](https://zd-api.aierxin.com/health)

### ç´§æ€¥è”ç³»

å¦‚æœç”Ÿäº§ç¯å¢ƒå‡ºç°é—®é¢˜ï¼š
1. ç«‹å³æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
2. ä½¿ç”¨ `pm2 restart zd-api` é‡å¯æœåŠ¡
3. å¿…è¦æ—¶å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬

---

**è®°ä½**ï¼šå§‹ç»ˆåœ¨æœ¬åœ°å……åˆ†æµ‹è¯•åå†éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼