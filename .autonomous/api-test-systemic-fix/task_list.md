# API测试系统性修复任务清单

## Phase 1: 基础设施修复（最高优先级）

### 1.1 停止所有后台进程
- [ ] 停止所有后台测试进程
- [ ] 备份当前测试结果到文件
- [ ] 清理临时文件和缓存

### 1.2 数据库完全同步
- [ ] 检查当前数据库schema状态
- [ ] 运行 `npx prisma db pull` 同步schema
- [ ] 重新生成Prisma客户端 `npx prisma generate`
- [ ] 验证所有表是否存在于数据库
- [ ] 检查表结构是否与schema一致

### 1.3 测试数据管理器修复
- [ ] 修复 test-data-manager.ts 中的表名错误（user → users）
- [ ] 检查并修复所有Prisma模型引用
- [ ] 创建完整的测试数据初始化脚本
- [ ] 验证测试数据管理器功能

### 1.4 环境配置验证
- [ ] 验证 DATABASE_URL 配置
- [ ] 检查 .env.test 配置
- [ ] 验证数据库连接权限
- [ ] 确保测试数据库隔离

## Phase 2: 核心系统修复

### 2.1 认证系统彻底修复
- [ ] 检查JWT中间件实现
- [ ] 修复token生成逻辑
- [ ] 修复token验证逻辑
- [ ] 确保测试辅助函数正确工作
- [ ] 创建认证测试用例

### 2.2 模型名称统一
- [ ] 全项目搜索并替换错误的模型名
- [ ] 修复所有 usersss → users 的引用
- [ ] 修复所有 shopss → shops 的引用
- [ ] 建立命名规范文档
- [ ] 添加lint规则防止未来错误

### 2.3 API路由修复
- [ ] 修复所有500内部服务器错误
- [ ] 统一错误响应格式
- [ ] 完善错误处理中间件
- [ ] 验证所有路由响应

## Phase 3: 渐进式测试恢复

### 3.1 建立测试金字塔
- [ ] 创建基础连接测试
- [ ] 创建数据库操作测试
- [ ] 创建认证功能测试
- [ ] 恢复支付模块测试（保持通过）
- [ ] 恢复库存模块测试（保持通过）
- [ ] 恢复店铺模块测试
- [ ] 恢复用户模块测试
- [ ] 恢复商品模块测试
- [ ] 恢复订单模块测试
- [ ] 恢复团队模块测试
- [ ] 恢复佣金模块测试

### 3.2 创建测试验证脚本
- [ ] 创建自动问题检测脚本
- [ ] 生成测试前检查清单
- [ ] 创建测试修复建议工具
- [ ] 建立持续集成检查

## Phase 4: 质量保证

### 4.1 文档更新
- [ ] 记录所有修复内容
- [ ] 更新开发指南
- [ ] 创建API测试最佳实践文档
- [ ] 编写故障排除指南

### 4.2 长期维护
- [ ] 建立测试质量门禁
- [ ] 创建自动化测试流水线
- [ ] 设置回归测试
- [ ] 培训团队成员

## 总计
- Phase 1: 14个任务
- Phase 2: 11个任务
- Phase 3: 14个任务
- Phase 4: 8个任务
- **总计：47个任务**