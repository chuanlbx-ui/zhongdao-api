{
  "name": "用户认证系统 - auth.test.ts",
  "command": "npm test tests/api/auth.test.ts",
  "startTime": "2025-12-09T09:40:43.434Z",
  "status": "failed",
  "output": "",
  "error": "Command failed: npm test tests/api/auth.test.ts\n\u001b[90mstderr\u001b[2m | api/auth.test.ts\u001b[2m > \u001b[22m\u001b[2m认证API测试\u001b[2m > \u001b[22m\u001b[2mPOST /auth/refresh\u001b[2m > \u001b[22m\u001b[2m应该能够刷新访问令牌\n\u001b[22m\u001b[39m跳过token刷新测试 - 缺少refreshToken\n\n\u001b[90mstderr\u001b[2m | api/auth.test.ts\u001b[2m > \u001b[22m\u001b[2m认证API测试\u001b[2m > \u001b[22m\u001b[2mPOST /auth/logout\u001b[2m > \u001b[22m\u001b[2m应该能够成功登出\n\u001b[22m\u001b[39m跳过登出测试 - 缺少authToken\n\n\u001b[90mstderr\u001b[2m | api/auth.test.ts\u001b[2m > \u001b[22m\u001b[2m认证API测试\u001b[2m > \u001b[22m\u001b[2mGET /auth/me\u001b[2m > \u001b[22m\u001b[2m应该能够获取当前用户信息\n\u001b[22m\u001b[39m跳过用户信息测试 - 缺少authToken\n\n\n\u001b[31m⎯⎯⎯⎯⎯⎯⎯\u001b[39m\u001b[1m\u001b[41m Failed Tests 5 \u001b[49m\u001b[22m\u001b[31m⎯⎯⎯⎯⎯⎯⎯\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/auth.test.ts\u001b[2m > \u001b[22m认证API测试\u001b[2m > \u001b[22mPOST /auth/wechat-login\u001b[2m > \u001b[22m应该能够使用微信登录码登录\n\u001b[31m\u001b[1mAssertionError\u001b[22m: expected { …(2) } to have property \"token\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/auth.test.ts:\u001b[2m39:34\u001b[22m\u001b[39m\n    \u001b[90m 37| \u001b[39m\n    \u001b[90m 38| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m 39| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mdata)\u001b[33m.\u001b[39m\u001b[34mtoHaveProperty\u001b[39m(\u001b[32m'token'\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m                                 \u001b[31m^\u001b[39m\n    \u001b[90m 40| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mdata)\u001b[33m.\u001b[39m\u001b[34mtoHaveProperty\u001b[39m(\u001b[32m'refreshToken'\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m 41| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mdata)\u001b[33m.\u001b[39m\u001b[34mtoHaveProperty\u001b[39m(\u001b[32m'user'\u001b[39m)\u001b[33m;\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/5]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/auth.test.ts\u001b[2m > \u001b[22m认证API测试\u001b[2m > \u001b[22mPOST /auth/wechat-login\u001b[2m > \u001b[22m应该拒绝无效的登录码\n\u001b[31m\u001b[1mError\u001b[22m: expected 400 \"Bad Request\", got 200 \"OK\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/auth.test.ts:\u001b[2m58:10\u001b[22m\u001b[39m\n    \u001b[90m 56| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mpost\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/auth/wechat-login`\u001b[39m)\n    \u001b[90m 57| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(loginData)\n    \u001b[90m 58| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m400\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m 59| \u001b[39m\n    \u001b[90m 60| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/5]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/auth.test.ts\u001b[2m > \u001b[22m认证API测试\u001b[2m > \u001b[22mPOST /auth/wechat-login\u001b[2m > \u001b[22m应该拒绝缺少必要参数的登录请求\n\u001b[31m\u001b[1mError\u001b[22m: expected 400 \"Bad Request\", got 200 \"OK\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/auth.test.ts:\u001b[2m68:10\u001b[22m\u001b[39m\n    \u001b[90m 66| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mpost\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/auth/wechat-login`\u001b[39m)\n    \u001b[90m 67| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m({})\n    \u001b[90m 68| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m400\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m 69| \u001b[39m\n    \u001b[90m 70| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/5]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/auth.test.ts\u001b[2m > \u001b[22m认证API测试\u001b[2m > \u001b[22mPOST /auth/refresh\u001b[2m > \u001b[22m应该拒绝无效的refreshToken\n\u001b[31m\u001b[1mError\u001b[22m: expected 401 \"Unauthorized\", got 200 \"OK\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/auth.test.ts:\u001b[2m99:10\u001b[22m\u001b[39m\n    \u001b[90m 97| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mpost\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/auth/refresh`\u001b[39m)\n    \u001b[90m 98| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m({ refreshToken\u001b[33m:\u001b[39m \u001b[32m'invalid_refresh_token'\u001b[39m })\n    \u001b[90m 99| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m401\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m100| \u001b[39m\n    \u001b[90m101| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/5]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/auth.test.ts\u001b[2m > \u001b[22m认证API测试\u001b[2m > \u001b[22mPOST /auth/logout\u001b[2m > \u001b[22m应该拒绝未授权的登出请求\n\u001b[31m\u001b[1mError\u001b[22m: expected 401 \"Unauthorized\", got 415 \"Unsupported Media Type\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/auth.test.ts:\u001b[2m124:10\u001b[22m\u001b[39m\n    \u001b[90m122| \u001b[39m      \u001b[35mconst\u001b[39m response \u001b[33m=\u001b[39m \u001b[35mawait\u001b[39m \u001b[34mrequest\u001b[39m(app)\n    \u001b[90m123| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mpost\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/auth/logout`\u001b[39m)\n    \u001b[90m124| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m401\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m125| \u001b[39m\n    \u001b[90m126| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/5]⎯\u001b[22m\u001b[39m\n\n",
  "endTime": "2025-12-09T09:40:47.901Z",
  "duration": 4467
}