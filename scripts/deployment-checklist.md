# ğŸš€ ä¸­é“å•†åŸéƒ¨ç½²æ£€æŸ¥æ¸…å•

## ğŸ“‹ éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

### âœ… ç³»ç»Ÿç¯å¢ƒæ£€æŸ¥

- [ ] **æœåŠ¡å™¨é…ç½®æ£€æŸ¥**
  - [ ] CPU: è‡³å°‘4æ ¸å¿ƒï¼ˆå½“å‰2æ ¸å¿ƒï¼Œå»ºè®®å‡çº§ï¼‰
  - [ ] å†…å­˜: è‡³å°‘8GBå¯ç”¨å†…å­˜ï¼ˆå½“å‰424MBç©ºé—²ï¼Œä¸¥é‡ä¸è¶³ï¼‰
  - [ ] å­˜å‚¨: è‡³å°‘100GBå¯ç”¨ç©ºé—´ï¼ˆå½“å‰207GBå¯ç”¨ï¼‰
  - [ ] ç½‘ç»œ: ç¨³å®šçš„äº’è”ç½‘è¿æ¥ï¼Œå»ºè®®10Mbps+å¸¦å®½

- [ ] **æ“ä½œç³»ç»Ÿæ£€æŸ¥**
  - [ ] Ubuntu 22.04.5 LTS âœ…
  - [ ] ç³»ç»Ÿæ›´æ–°: `sudo apt update && sudo apt upgrade -y`
  - [ ] é˜²ç«å¢™é…ç½®: UFWæˆ–äº‘å¹³å°å®‰å…¨ç»„

- [ ] **å®å¡”é¢æ¿æ£€æŸ¥**
  - [ ] ç‰ˆæœ¬: v11.2.0 âœ…
  - [ ] å¿…è¦è½¯ä»¶: Nginx, MySQL 8.0, Node.js 18+
  - [ ] ç£ç›˜ç©ºé—´æ¸…ç†: æ¸…ç†ä¸å¿…è¦çš„æ–‡ä»¶å’Œæ—¥å¿—

### âœ… æ•°æ®åº“å‡†å¤‡

- [ ] **MySQLé…ç½®**
  - [ ] æ•°æ®åº“åˆ›å»º: `zhongdao_mall` (ç”Ÿäº§åº“ï¼Œä¸æ˜¯å¼€å‘åº“)
  - [ ] ç”¨æˆ·æƒé™: åˆ›å»ºä¸“ç”¨æ•°æ®åº“ç”¨æˆ·
  - [ ] å­—ç¬¦é›†: UTF8MB4
  - [ ] æ€§èƒ½ä¼˜åŒ–: è¿è¡Œ `mysql-optimization.sh`

- [ ] **æ•°æ®åº“è¿ç§»**
  - [ ] Prismaå®¢æˆ·ç«¯ç”Ÿæˆ: `npm run db:generate`
  - [ ] Schemaæ¨é€: `npm run db:push`
  - [ ] æ•°æ®å¤‡ä»½: ç”Ÿäº§æ•°æ®å¤‡ä»½ç­–ç•¥

- [ ] **æ•°æ®æµ‹è¯•**
  - [ ] è¿æ¥æµ‹è¯•: éªŒè¯åº”ç”¨èƒ½è¿æ¥æ•°æ®åº“
  - [ ] åŸºç¡€æ•°æ®: è¿è¡Œ `npm run db:seed:minimal`
  - [ ] æ€§èƒ½æµ‹è¯•: æŸ¥è¯¢å“åº”æ—¶é—´

### âœ… åº”ç”¨é…ç½®

- [ ] **ç¯å¢ƒå˜é‡é…ç½®**
  - [ ] `.env.production` é…ç½®å®Œæˆ
  - [ ] æ•°æ®åº“è¿æ¥: ä½¿ç”¨ç”Ÿäº§åº“ï¼Œä¸æ˜¯å¼€å‘åº“
  - [ ] JWTå¯†é’¥: é‡æ–°ç”Ÿæˆå¼ºå¯†é’¥
  - [ ] æ”¯ä»˜é…ç½®: æ›¿æ¢ä¸ºæ­£å¼ç¯å¢ƒå¯†é’¥
  - [ ] CORSé…ç½®: é™åˆ¶ä¸ºç”Ÿäº§åŸŸå

- [ ] **ä»£ç æ„å»º**
  - [ ] TypeScriptç¼–è¯‘: `npm run build`
  - [ ] ä¾èµ–å®‰è£…: `npm install --production`
  - [ ] ä»£ç æ£€æŸ¥: `npm run lint && npm run type-check`

- [ ] **PM2é…ç½®**
  - [ ] ä½¿ç”¨ä¼˜åŒ–ç‰ˆé…ç½®: `ecosystem.config.js.optimized`
  - [ ] å†…å­˜é™åˆ¶: æ ¹æ®æœåŠ¡å™¨å†…å­˜è°ƒæ•´
  - [ ] æ—¥å¿—é…ç½®: ç¡®ä¿æ—¥å¿—ç›®å½•å­˜åœ¨
  - [ ] è‡ªåŠ¨é‡å¯: é…ç½®åˆç†çš„é‡å¯ç­–ç•¥

### âœ… WebæœåŠ¡é…ç½®

- [ ] **Nginxé…ç½®**
  - [ ] åå‘ä»£ç†: API, Admin, H5æœåŠ¡
  - [ ] SSLè¯ä¹¦: é…ç½®HTTPS
  - [ ] Gzipå‹ç¼©: å¯ç”¨å‹ç¼©
  - [ ] é™æ€æ–‡ä»¶ç¼“å­˜: é…ç½®ç¼“å­˜ç­–ç•¥

- [ ] **åŸŸåè§£æ**
  - [ ] APIåŸŸå: zd-api.wenbita.cn
  - [ ] AdminåŸŸå: zd-admin.wenbita.cn
  - [ ] H5åŸŸå: zd-h5.wenbita.cn
  - [ ] DNSè®°å½•: Aè®°å½•æŒ‡å‘æœåŠ¡å™¨IP

- [ ] **å®‰å…¨é…ç½®**
  - [ ] é˜²ç«å¢™è§„åˆ™: åªå¼€æ”¾å¿…è¦ç«¯å£
  - [ ] SSL/TLS: å¼ºåˆ¶HTTPSè®¿é—®
  - [ ] å®‰å…¨å¤´: é…ç½®å®‰å…¨HTTPå¤´
  - [ ] è®¿é—®æ§åˆ¶: IPç™½åå•ï¼ˆå¯é€‰ï¼‰

## ğŸš€ éƒ¨ç½²æ­¥éª¤æ¸…å•

### é˜¶æ®µ1: ç¯å¢ƒå‡†å¤‡ (1-2å°æ—¶)

1. **ç³»ç»Ÿä¼˜åŒ–** â° 15åˆ†é’Ÿ
   ```bash
   # è¿è¡Œç³»ç»Ÿä¼˜åŒ–è„šæœ¬
   chmod +x scripts/server-optimization.sh
   ./scripts/server-optimization.sh
   ```

2. **MySQLä¼˜åŒ–** â° 30åˆ†é’Ÿ
   ```bash
   # è¿è¡ŒMySQLä¼˜åŒ–è„šæœ¬
   chmod +x scripts/mysql-optimization.sh
   ./scripts/mysql-optimization.sh
   ```

3. **åˆ›å»ºç”Ÿäº§æ•°æ®åº“** â° 15åˆ†é’Ÿ
   ```sql
   CREATE DATABASE zhongdao_mall CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   CREATE USER 'zhongdao_user'@'localhost' IDENTIFIED BY 'strong_password_here';
   GRANT ALL PRIVILEGES ON zhongdao_mall.* TO 'zhongdao_user'@'localhost';
   FLUSH PRIVILEGES;
   ```

### é˜¶æ®µ2: åº”ç”¨éƒ¨ç½² (2-3å°æ—¶)

4. **ä»£ç éƒ¨ç½²** â° 30åˆ†é’Ÿ
   ```bash
   # æ‹‰å–æœ€æ–°ä»£ç 
   git pull origin main

   # å®‰è£…ä¾èµ–
   npm install --production

   # æ„å»ºé¡¹ç›®
   npm run build

   # ç”ŸæˆPrismaå®¢æˆ·ç«¯
   npm run db:generate
   ```

5. **é…ç½®æ›´æ–°** â° 30åˆ†é’Ÿ
   ```bash
   # æ›´æ–°ç¯å¢ƒå˜é‡
   cp .env.production .env
   # ç¼–è¾‘.envæ–‡ä»¶ï¼Œç¡®ä¿æ‰€æœ‰é…ç½®æ­£ç¡®

   # ä½¿ç”¨ä¼˜åŒ–çš„PM2é…ç½®
   cp ecosystem.config.js.optimized ecosystem.config.js
   ```

6. **æ•°æ®åº“åˆå§‹åŒ–** â° 45åˆ†é’Ÿ
   ```bash
   # æ¨é€Schema
   DATABASE_URL="mysql://zhongdao_user:password@localhost:3306/zhongdao_mall" npm run db:push

   # è¿è¡Œç§å­æ•°æ®
   npm run db:seed:minimal
   ```

7. **å¯åŠ¨æœåŠ¡** â° 15åˆ†é’Ÿ
   ```bash
   # å¯åŠ¨PM2æœåŠ¡
   pm2 start ecosystem.config.js

   # ä¿å­˜PM2é…ç½®
   pm2 save

   # è®¾ç½®å¼€æœºè‡ªå¯
   pm2 startup
   ```

### é˜¶æ®µ3: WebæœåŠ¡é…ç½® (1-2å°æ—¶)

8. **Nginxé…ç½®** â° 30åˆ†é’Ÿ
   ```bash
   # å¯ç”¨ä¼˜åŒ–é…ç½®
   sudo ln -s /etc/nginx/sites-available/zhongdao-mall-optimized /etc/nginx/sites-enabled/
   sudo nginx -t && sudo systemctl reload nginx
   ```

9. **SSLè¯ä¹¦é…ç½®** â° 60åˆ†é’Ÿ
   ```bash
   # ä½¿ç”¨Let's Encryptï¼ˆæ¨èï¼‰
   sudo apt install certbot python3-certbot-nginx
   sudo certbot --nginx -d zd-api.wenbita.cn -d zd-admin.wenbita.cn -d zd-h5.wenbita.cn
   ```

10. **é˜²ç«å¢™é…ç½®** â° 15åˆ†é’Ÿ
    ```bash
    # é…ç½®UFW
    sudo ufw allow ssh
    sudo ufw allow 'Nginx Full'
    sudo ufw enable
    ```

### é˜¶æ®µ4: æµ‹è¯•éªŒè¯ (1-2å°æ—¶)

11. **åŸºç¡€åŠŸèƒ½æµ‹è¯•** â° 30åˆ†é’Ÿ
    - [ ] APIå¥åº·æ£€æŸ¥: `curl http://localhost:3000/health`
    - [ ] æ•°æ®åº“è¿æ¥: `curl http://localhost:3000/health/database`
    - [ ] å„æœåŠ¡ç«¯å£æ£€æŸ¥

12. **ä¸šåŠ¡åŠŸèƒ½æµ‹è¯•** â° 60åˆ†é’Ÿ
    - [ ] ç”¨æˆ·æ³¨å†Œ/ç™»å½•
    - [ ] å•†å“æµè§ˆ
    - [ ] è®¢å•åˆ›å»º
    - [ ] æ”¯ä»˜æµç¨‹ï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰

13. **æ€§èƒ½æµ‹è¯•** â° 30åˆ†é’Ÿ
    - [ ] è´Ÿè½½æµ‹è¯•: ä½¿ç”¨abæˆ–wrk
    - [ ] å†…å­˜ä½¿ç”¨ç›‘æ§
    - [ ] æ•°æ®åº“æ€§èƒ½ç›‘æ§

## ğŸ” éƒ¨ç½²åéªŒè¯æ¸…å•

### âœ… æœåŠ¡çŠ¶æ€æ£€æŸ¥

- [ ] **åº”ç”¨æœåŠ¡**
  - [ ] APIæœåŠ¡: `pm2 status zd-api`
  - [ ] H5å‰ç«¯: `pm2 status zd-h5`
  - [ ] Adminåå°: `pm2 status zd-admin`

- [ ] **ç³»ç»ŸæœåŠ¡**
  - [ ] Nginx: `systemctl status nginx`
  - [ ] MySQL: `systemctl status mysql`
  - [ ] ç›‘æ§æœåŠ¡: `systemctl status memory-monitor performance-dashboard`

- [ ] **ç½‘ç»œè®¿é—®**
  - [ ] APIæ¥å£: `https://zd-api.wenbita.cn/health`
  - [ ] ç®¡ç†åå°: `https://zd-admin.wenbita.cn`
  - [ ] H5å‰ç«¯: `https://zd-h5.wenbita.cn`
  - [ ] ç›‘æ§é¢æ¿: `http://æœåŠ¡å™¨IP:9090`

### âœ… æ€§èƒ½æŒ‡æ ‡éªŒè¯

- [ ] **å†…å­˜ä½¿ç”¨**
  - [ ] æ€»å†…å­˜ä½¿ç”¨ < 80%
  - [ ] å•ä¸ªæœåŠ¡å†…å­˜ < é™åˆ¶å€¼
  - [ ] æ— å†…å­˜æ³„æ¼

- [ ] **å“åº”æ€§èƒ½**
  - [ ] APIå“åº”æ—¶é—´ < 2ç§’
  - [ ] é¡µé¢åŠ è½½æ—¶é—´ < 5ç§’
  - [ ] æ•°æ®åº“æŸ¥è¯¢æ—¶é—´ < 500ms

- [ ] **é”™è¯¯ç›‘æ§**
  - [ ] åº”ç”¨é”™è¯¯æ—¥å¿—æ­£å¸¸
  - [ ] Nginxè®¿é—®æ—¥å¿—æ— å¼‚å¸¸
  - [ ] æ•°æ®åº“æ…¢æŸ¥è¯¢ç›‘æ§

## ğŸ“‹ ç›‘æ§å’Œç»´æŠ¤æ¸…å•

### âœ… æ—¥å¸¸ç›‘æ§ (æ¯å¤©)

- [ ] **ç³»ç»Ÿèµ„æºç›‘æ§**
  - [ ] å†…å­˜ä½¿ç”¨ç‡: è®¿é—®ç›‘æ§é¢æ¿
  - [ ] ç£ç›˜ç©ºé—´: `df -h`
  - [ ] CPUè´Ÿè½½: `uptime`
  - [ ] ç½‘ç»œçŠ¶æ€: `netstat -tulpn`

- [ ] **åº”ç”¨æœåŠ¡ç›‘æ§**
  - [ ] PM2è¿›ç¨‹çŠ¶æ€: `pm2 status`
  - [ ] APIå“åº”æ£€æŸ¥: `curl -f https://zd-api.wenbita.cn/health`
  - [ ] é”™è¯¯æ—¥å¿—æ£€æŸ¥: `tail -f /www/wwwlogs/zd-api-error.log`

- [ ] **æ•°æ®åº“ç›‘æ§**
  - [ ] MySQLçŠ¶æ€: `systemctl status mysql`
  - [ ] æ…¢æŸ¥è¯¢æ—¥å¿—: `tail -f /var/log/mysql/slow.log`
  - [ ] è¿æ¥æ•°: `mysql -e "SHOW PROCESSLIST;"`

### âœ… å®šæœŸç»´æŠ¤ (æ¯å‘¨)

- [ ] **æ—¥å¿—æ¸…ç†**
  - [ ] åº”ç”¨æ—¥å¿—: æ¸…ç†7å¤©å‰çš„æ—¥å¿—
  - [ ] Nginxæ—¥å¿—: é…ç½®logrotate
  - [ ] ç³»ç»Ÿæ—¥å¿—: æ£€æŸ¥æ˜¯å¦æœ‰å¼‚å¸¸

- [ ] **æ•°æ®åº“ç»´æŠ¤**
  - [ ] å¤‡ä»½éªŒè¯: æ£€æŸ¥å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§
  - [ ] æ€§èƒ½åˆ†æ: æ£€æŸ¥æ…¢æŸ¥è¯¢
  - [ ] ç´¢å¼•ä¼˜åŒ–: åˆ†ææŸ¥è¯¢æ€§èƒ½

- [ ] **å®‰å…¨æ£€æŸ¥**
  - [ ] ç³»ç»Ÿæ›´æ–°: `sudo apt update`
  - [ ] SSLè¯ä¹¦: æ£€æŸ¥åˆ°æœŸæ—¶é—´
  - [ ] è®¿é—®æ—¥å¿—: æ£€æŸ¥å¼‚å¸¸è®¿é—®

### âœ… æœˆåº¦æ£€æŸ¥ (æ¯æœˆ)

- [ ] **æ€§èƒ½è¯„ä¼°**
  - [ ] å“åº”æ—¶é—´è¶‹åŠ¿åˆ†æ
  - [ ] ç”¨æˆ·è®¿é—®é‡ç»Ÿè®¡
  - [ ] èµ„æºä½¿ç”¨è¶‹åŠ¿

- [ ] **å®¹é‡è§„åˆ’**
  - [ ] ç£ç›˜ç©ºé—´ä½¿ç”¨é¢„æµ‹
  - [ ] å†…å­˜ä½¿ç”¨è¶‹åŠ¿
  - [ ] CPUè´Ÿè½½åˆ†æ

- [ ] **å®‰å…¨å®¡è®¡**
  - [ ] ç”¨æˆ·æƒé™å®¡æ ¸
  - [ ] ç³»ç»Ÿæ¼æ´æ‰«æ
  - [ ] å®‰å…¨é…ç½®æ£€æŸ¥

## ğŸš¨ åº”æ€¥å¤„ç†æ¸…å•

### å†…å­˜ä¸è¶³å¤„ç†
```bash
# ç´§æ€¥é‡Šæ”¾å†…å­˜
sudo sh -c 'echo 3 > /proc/sys/vm/drop_caches'

# é‡å¯é«˜å†…å­˜æœåŠ¡
pm2 restart zd-api

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -h && ps aux --sort=-%mem | head -10
```

### æ•°æ®åº“æ•…éšœå¤„ç†
```bash
# æ£€æŸ¥MySQLçŠ¶æ€
sudo systemctl status mysql

# é‡å¯MySQL
sudo systemctl restart mysql

# æ£€æŸ¥é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/mysql/error.log
```

### æœåŠ¡æ•…éšœå¤„ç†
```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
pm2 restart all

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 status

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
pm2 logs zd-api --lines 100
```

## ğŸ“ è”ç³»ä¿¡æ¯

- **æŠ€æœ¯æ”¯æŒ**: [å¡«å†™æŠ€æœ¯è´Ÿè´£äººè”ç³»æ–¹å¼]
- **è¿ç»´æ”¯æŒ**: [å¡«å†™è¿ç»´è´Ÿè´£äººè”ç³»æ–¹å¼]
- **ç´§æ€¥è”ç³»**: [å¡«å†™24å°æ—¶ç´§æ€¥è”ç³»æ–¹å¼]

---

**æ³¨æ„äº‹é¡¹**:
1. æ‰€æœ‰æ“ä½œå»ºè®®åœ¨ä¸šåŠ¡ä½å³°æœŸè¿›è¡Œ
2. æ‰§è¡Œé‡è¦æ“ä½œå‰è¯·åŠ¡å¿…å¤‡ä»½æ•°æ®
3. ä¿æŒç›‘æ§å’Œæ—¥å¿—çš„æ­£å¸¸è¿è¡Œ
4. å®šæœŸæ£€æŸ¥å’Œæ›´æ–°å®‰å…¨é…ç½®

**æœ€åæ›´æ–°**: 2025-01-01