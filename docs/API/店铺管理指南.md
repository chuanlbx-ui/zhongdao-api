# 店铺管理指南

## 概述

中道商城系统采用双店铺制度设计，包括云店（业绩累积升级）和梧桐店（特殊权益）。每个用户可以根据自己的业务需求选择合适的店铺类型，享受不同的权益和服务。

## 店铺类型详解

### 1. 云店（Cloud Shop）

云店是主要的店铺类型，通过累积业绩自动升级，享受递增的佣金比例。

**特点**:
- 免费开通
- 业绩累积升级
- 等级越高佣金越高
- 团队共享云仓
- 自动结算佣金

**升级条件**:
| 等级 | 月销售额要求 | 佣金比例 | 特殊权益 |
|------|-------------|----------|----------|
| 1级 | 0元 | 5% | 基础销售 |
| 2级 | 5000元 | 8% | 团队查看 |
| 3级 | 20000元 | 12% | 专属客服 |
| 4级 | 50000元 | 16% | 活动优先 |
| 5级 | 100000元 | 20% | 区域代理 |

### 2. 梧桐店（Wutong Shop）

梧桐店是一次性购买的特殊店铺，享受平台最高级别的特殊权益。

**特点**:
- 一次性购买（需支付19800元）
- 永久享受2.2折进货折扣
- 直接获得董事级别权益
- 专属商品供货渠道
- 平台年度分红资格
- 独立店铺管理系统

## API接口详解

### 1. 获取店铺信息

**接口地址**: `GET /api/v1/shops/my-shop`

**请求头**:
```
Authorization: Bearer <token>
```

**响应数据**:
```json
{
  "success": true,
  "data": {
    "shop": {
      "id": "cms1234567890abcdef",
      "name": "张三的云店",
      "type": "CLOUD",
      "level": 3,
      "status": "ACTIVE",
      "logo": "https://example.com/shop-logo.jpg",
      "description": "专业销售中道产品",
      "establishedDate": "2025-10-01",
      "performance": {
        "totalSales": 85000.00,
        "monthlySales": 12000.00,
        "totalOrders": 156,
        "monthlyOrders": 23,
        "totalCommission": 13600.00,
        "monthlyCommission": 1920.00,
        "teamSize": 45,
        "activeCustomers": 120
      },
      "settings": {
        "autoConfirm": true,
        "inventoryAlert": true,
        "salesNotification": true,
        "teamViewPermission": true
      },
      "privileges": [
        "VIEW_INVENTORY",
        "MANAGE_ORDERS",
        "VIEW_COMMISSION",
        "TEAM_MANAGEMENT"
      ]
    },
    "levelInfo": {
      "currentLevel": 3,
      "nextLevel": {
        "level": 4,
        "requiredSales": 50000.00,
        "currentSales": 35000.00,
        "progress": 70,
        "commissionRate": 0.16
      }
    }
  },
  "message": "获取成功"
}
```

### 2. 开通云店

**接口地址**: `POST /api/v1/shops/open-cloud-shop`

**请求参数**:
```json
{
  "shopName": "张三的云店",
  "description": "专业销售中道健康产品",
  "logo": "https://example.com/logo.jpg",
  "contactPhone": "13800138000",
  "contactEmail": "zhangsan@example.com"
}
```

**响应数据**:
```json
{
  "success": true,
  "data": {
    "shopId": "cms1234567890abcdef",
    "shopName": "张三的云店",
    "initialLevel": 1,
    "welcomeKit": {
      "inventoryAccess": true,
      "productCatalog": true,
      "salesTools": true,
      "trainingMaterials": true
    },
    "nextSteps": [
      "完善店铺信息",
      "学习产品知识",
      "开始推广销售",
      "发展团队"
    ]
  },
  "message": "云店开通成功"
}
```

### 3. 申请梧桐店

**接口地址**: `POST /api/v1/shops/apply-wutong-shop`

**请求参数**:
```json
{
  "shopName": "张三的梧桐旗舰店",
  "businessPlan": "计划发展100人团队，月销50万",
  "region": "广东省深圳市",
  "experience": "有5年电商经验",
  "paymentMethod": "WECHAT"
}
```

**响应数据**:
```json
{
  "success": true,
  "data": {
    "applicationId": "app_wt_1234567890",
    "status": "pending_payment",
    "paymentInfo": {
      "amount": 19800.00,
      "discount": 0,
      "finalAmount": 19800.00,
      "paymentUrl": "https://pay.zhongdao-mall.com/pay/123456",
      "expiresAt": "2025-11-25T03:06:00.000Z"
    },
    "benefits": [
      "永久2.2折进货折扣",
      "董事级别权益",
      "专属商品渠道",
      "年度分红资格"
    ]
  },
  "message": "梧桐店申请成功，请完成支付"
}
```

### 4. 更新店铺信息

**接口地址**: `PUT /api/v1/shops/update`

**请求参数**:
```json
{
  "shopName": "张三的优选云店",
  "description": "只选最好，不选最贵",
  "logo": "https://example.com/new-logo.jpg",
  "banner": "https://example.com/banner.jpg",
  "businessHours": {
    "monday": "09:00-21:00",
    "tuesday": "09:00-21:00",
    "wednesday": "09:00-21:00",
    "thursday": "09:00-21:00",
    "friday": "09:00-21:00",
    "saturday": "10:00-22:00",
    "sunday": "10:00-22:00"
  },
  "contactInfo": {
    "phone": "13800138000",
    "email": "shop@example.com",
    "wechat": "zhangsan_shop",
    "address": "广东省深圳市南山区"
  },
  "settings": {
    "autoConfirm": false,
    "inventoryAlert": true,
    "lowStockThreshold": 10
  }
}
```

### 5. 获取店铺统计数据

**接口地址**: `GET /api/v1/shops/statistics`

**查询参数**:
- `period`: 统计周期（day/week/month/year）
- `startDate`: 开始日期
- `endDate`: 结束日期

**响应数据**:
```json
{
  "success": true,
  "data": {
    "overview": {
      "totalRevenue": 500000.00,
      "totalProfit": 80000.00,
      "totalOrders": 1234,
      "totalCustomers": 567,
      "averageOrderValue": 405.19,
      "conversionRate": 0.15
    },
    "sales": {
      "daily": [
        {
          "date": "2025-11-01",
          "sales": 5200.00,
          "orders": 12,
          "customers": 8,
          "profit": 832.00
        }
      ],
      "monthly": [
        {
          "month": "2025-10",
          "sales": 45000.00,
          "orders": 110,
          "customers": 89,
          "profit": 7200.00
        }
      ],
      "productCategories": [
        {
          "category": "保健品",
          "sales": 300000.00,
          "percentage": 60,
          "growth": 15.5
        },
        {
          "category": "日用品",
          "sales": 200000.00,
          "percentage": 40,
          "growth": 8.2
        }
      ]
    },
    "customers": {
      "newCustomers": 45,
      "activeCustomers": 234,
      "retentionRate": 0.75,
      "topCustomers": [
        {
          "id": "cmi1234567890abcddd",
          "nickname": "李四",
          "totalSpent": 15000.00,
          "orders": 35,
          "lastOrder": "2025-11-20"
        }
      ]
    },
    "commission": {
      "totalEarned": 80000.00,
      "pendingSettlement": 12000.00,
      "monthlyAverage": 6666.67,
      "commissionRate": 0.16,
      "teamCommission": 25000.00
    },
    "inventory": {
      "totalProducts": 156,
      "inStock": 148,
      "lowStock": 8,
      "outOfStock": 0,
      "totalValue": 120000.00,
      "turnoverRate": 4.2
    }
  },
  "message": "获取成功"
}
```

### 6. 店铺商品管理

**接口地址**: `GET /api/v1/shops/products`

**查询参数**:
- `status`: 商品状态（active/inactive/out_of_stock）
- `category`: 商品分类
- `page`: 页码
- `limit`: 每页数量

**响应数据**:
```json
{
  "success": true,
  "data": {
    "products": [
      {
        "id": "cmp1234567890abcdef",
        "name": "中道口服液",
        "category": "保健品",
        "specs": [
          {
            "id": "spec123",
            "name": "10支/盒",
            "stock": 100,
            "price": 599.00,
            "discountPrice": 299.50,
            "barcode": "1234567890123"
          }
        ],
        "images": [
          "https://example.com/product1.jpg",
          "https://example.com/product2.jpg"
        ],
        "status": "active",
        "sales": 523,
        "rating": 4.8,
        "reviews": 156,
        "createdAt": "2025-10-01"
      }
    ],
    "summary": {
      "totalProducts": 156,
      "activeProducts": 148,
      "lowStockProducts": 8,
      "totalValue": 120000.00
    },
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 156,
      "totalPages": 8
    }
  },
  "message": "获取成功"
}
```

### 7. 设置商品价格

**接口地址**: `POST /api/v1/shops/set-product-price`

**请求参数**:
```json
{
  "productId": "cmp1234567890abcdef",
  "specId": "spec123",
  "priceType": "CUSTOM",
  "price": 550.00,
  "discountPrice": 275.00,
  "memberDiscount": {
    "VIP": 0.9,
    "STAR_1": 0.85,
    "STAR_2": 0.8,
    "STAR_3": 0.75,
    "STAR_4": 0.7,
    "STAR_5": 0.65,
    "DIRECTOR": 0.6
  }
}
```

### 8. 订单管理

**接口地址**: `GET /api/v1/shops/orders`

**查询参数**:
- `status`: 订单状态
- `startDate`: 开始日期
- `endDate`: 结束日期
- `page`: 页码

**响应数据**:
```json
{
  "success": true,
  "data": {
    "orders": [
      {
        "id": "cmo1234567890abcdef",
        "orderNo": "ZD20251124001",
        "customer": {
          "id": "cmi1234567890abcddd",
          "nickname": "李四",
          "avatar": "https://wx.qlogo.cn/...",
          "level": "VIP"
        },
        "items": [
          {
            "productId": "cmp1234567890abcdef",
            "productName": "中道口服液",
            "specName": "10支/盒",
            "quantity": 2,
            "price": 550.00,
            "total": 1100.00
          }
        ],
        "totalAmount": 1100.00,
        "commission": 176.00,
        "status": "CONFIRMED",
        "paymentMethod": "POINTS",
        "paymentStatus": "PAID",
        "shippingAddress": "广东省深圳市南山区...",
        "createdAt": "2025-11-24T10:30:00.000Z",
        "confirmedAt": "2025-11-24T10:35:00.000Z",
        "shippedAt": null,
        "deliveredAt": null
      }
    ],
    "summary": {
      "totalOrders": 156,
      "pendingOrders": 5,
      "confirmedOrders": 23,
      "shippedOrders": 67,
      "deliveredOrders": 61,
      "totalAmount": 50000.00,
      "totalCommission": 8000.00
    },
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 156,
      "totalPages": 8
    }
  },
  "message": "获取成功"
}
```

### 9. 确认订单

**接口地址**: `POST /api/v1/shops/orders/{orderId}/confirm`

**请求参数**:
```json
{
  "confirmNote": "商品已准备好，将尽快发货",
  "estimatedShippingDate": "2025-11-25",
  "inventoryCheck": true
}
```

### 10. 发货处理

**接口地址**: `POST /api/v1/shops/orders/{orderId}/ship`

**请求参数**:
```json
{
  "logisticsCompany": "顺丰快递",
  "trackingNumber": "SF1234567890123",
  "shippingNote": "小心轻放，易碎品",
  "packages": [
    {
      "items": [
        {
          "productId": "cmp1234567890abcdef",
          "quantity": 2
        }
      ],
      "weight": 0.5,
      "description": "中道口服液2盒"
    }
  ]
}
```

## 店铺运营策略

### 1. 云店运营

#### 新手阶段（1-2级）
- 熟悉产品知识
- 发展初始客户（10-20人）
- 月销售额目标：5000-20000元

#### 成长阶段（3-4级）
- 扩大团队规模
- 提升客户复购率
- 月销售额目标：20000-100000元

#### 成熟阶段（5级）
- 建立区域影响力
- 培养核心团队
- 月销售额目标：100000元以上

### 2. 梧桐店运营

#### 优势发挥
- 利用2.2折进货优势
- 发展下级云店
- 获取年度分红

#### 团队建设
- 快速发展100+团队
- 培训店长团队
- 建立区域代理网络

## 店铺等级权益对照表

| 功能权益 | 云店1级 | 云店2级 | 云店3级 | 云店4级 | 云店5级 | 梧桐店 |
|---------|---------|---------|---------|---------|---------|--------|
| 进货折扣 | 5折 | 5折 | 5折 | 5折 | 5折 | 2.2折 |
| 销售佣金 | 5% | 8% | 12% | 16% | 20% | 20% |
| 团队查看 | ❌ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 数据导出 | ❌ | ❌ | ✅ | ✅ | ✅ | ✅ |
| 专属客服 | ❌ | ❌ | ✅ | ✅ | ✅ | ✅ |
| 活动优先 | ❌ | ❌ | ❌ | ✅ | ✅ | ✅ |
| 区域代理 | ❌ | ❌ | ❌ | ❌ | ✅ | ✅ |
| 年度分红 | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ |

## 数据库模型

### Shop表结构

```sql
CREATE TABLE Shop (
  id VARCHAR(36) PRIMARY KEY,
  userId VARCHAR(36) UNIQUE NOT NULL,
  name VARCHAR(100) NOT NULL,
  type ENUM('CLOUD', 'WUTONG') NOT NULL,
  level INT DEFAULT 1,
  status ENUM('ACTIVE', 'INACTIVE', 'SUSPENDED') DEFAULT 'ACTIVE',
  logo VARCHAR(500),
  banner VARCHAR(500),
  description TEXT,
  contactInfo JSON,
  businessHours JSON,
  settings JSON,
  performance JSON,
  privileges JSON,
  establishedDate DATE,
  lastActiveAt TIMESTAMP,
  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  INDEX idx_userId (userId),
  INDEX idx_type (type),
  INDEX idx_level (level),
  INDEX idx_status (status),
  FOREIGN KEY (userId) REFERENCES User(id)
);
```

### ShopLevelRequirement表

```sql
CREATE TABLE ShopLevelRequirement (
  id INT AUTO_INCREMENT PRIMARY KEY,
  shopType ENUM('CLOUD', 'WUTONG') NOT NULL,
  level INT NOT NULL,
  levelName VARCHAR(50) NOT NULL,
  requiredMonthlySales DECIMAL(10,2) NOT NULL,
  requiredTeamSize INT NOT NULL,
  commissionRate DECIMAL(3,2) NOT NULL,
  privileges JSON,
  benefits JSON,
  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  UNIQUE KEY uk_shop_type_level (shopType, level)
);
```

## 前端集成示例

### React组件

```tsx
// ShopDashboard.tsx
import React from 'react';
import { Card, Row, Col, Statistic, Progress, Button, Avatar } from 'antd';
import { useQuery } from '@tanstack/react-query';

export const ShopDashboard: React.FC = () => {
  const { data: shopInfo } = useQuery({
    queryKey: ['shopInfo'],
    queryFn: () => api.get('/shops/my-shop').then(res => res.data.data)
  });

  if (!shopInfo) return null;

  return (
    <div className="shop-dashboard">
      {/* 店铺基本信息 */}
      <Card className="mb-4">
        <Row gutter={16}>
          <Col span={6}>
            <Avatar size={80} src={shopInfo.shop.logo} />
          </Col>
          <Col span={18}>
            <h2>{shopInfo.shop.name}</h2>
            <p>类型：{shopInfo.shop.type === 'CLOUD' ? '云店' : '梧桐店'}</p>
            <p>等级：{shopInfo.shop.level}级</p>
            <p>状态：<Badge status="success" text="正常营业" /></p>
          </Col>
        </Row>
      </Card>

      {/* 业绩统计 */}
      <Row gutter={16} className="mb-4">
        <Col span={6}>
          <Card>
            <Statistic
              title="总销售额"
              value={shopInfo.shop.performance.totalSales}
              precision={2}
              prefix="¥"
            />
          </Card>
        </Col>
        <Col span={6}>
          <Card>
            <Statistic
              title="月销售额"
              value={shopInfo.shop.performance.monthlySales}
              precision={2}
              prefix="¥"
            />
          </Card>
        </Col>
        <Col span={6}>
          <Card>
            <Statistic
              title="总订单"
              value={shopInfo.shop.performance.totalOrders}
            />
          </Card>
        </Col>
        <Col span={6}>
          <Card>
            <Statistic
              title="总佣金"
              value={shopInfo.shop.performance.totalCommission}
              precision={2}
              prefix="¥"
            />
          </Card>
        </Col>
      </Row>

      {/* 升级进度（云店） */}
      {shopInfo.shop.type === 'CLOUD' && shopInfo.levelInfo && (
        <Card title="店铺升级进度" className="mb-4">
          <Progress
            percent={shopInfo.levelInfo.nextLevel.progress}
            status="active"
            format={() => `${shopInfo.levelInfo.nextLevel.currentSales}/${shopInfo.levelInfo.nextLevel.requiredSales}`}
          />
          <p className="mt-2">
            当前：{shopInfo.levelInfo.currentLevel}级 →
            下一级：{shopInfo.levelInfo.nextLevel.level}级（佣金{shopInfo.levelInfo.nextLevel.commissionRate * 100}%）
          </p>
        </Card>
      )}

      {/* 快捷操作 */}
      <Row gutter={16}>
        <Col span={8}>
          <Button type="primary" block size="large" icon={<PlusOutlined />}>
            发布商品
          </Button>
        </Col>
        <Col span={8}>
          <Button block size="large" icon={<ShoppingOutlined />}>
            订单管理
          </Button>
        </Col>
        <Col span={8}>
          <Button block size="large" icon={<TeamOutlined />}>
            团队管理
          </Button>
        </Col>
      </Row>
    </div>
  );
};

// OrderManagement.tsx
import React, { useState } from 'react';
import { Table, Button, Tag, Space, Modal, message } from 'antd';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';

export const OrderManagement: React.FC = () => {
  const [page, setPage] = useState(1);
  const queryClient = useQueryClient();

  const { data: orderData, isLoading } = useQuery({
    queryKey: ['shopOrders', page],
    queryFn: () => api.get('/shops/orders', { params: { page } }).then(res => res.data.data)
  });

  const confirmOrderMutation = useMutation({
    mutationFn: (orderId: string) =>
      api.post(`/shops/orders/${orderId}/confirm`),
    onSuccess: () => {
      message.success('订单确认成功');
      queryClient.invalidateQueries(['shopOrders']);
    }
  });

  const shipOrderMutation = useMutation({
    mutationFn: ({ orderId, data }: any) =>
      api.post(`/shops/orders/${orderId}/ship`, data),
    onSuccess: () => {
      message.success('发货成功');
      queryClient.invalidateQueries(['shopOrders']);
    }
  });

  const columns = [
    {
      title: '订单号',
      dataIndex: 'orderNo',
      key: 'orderNo'
    },
    {
      title: '客户',
      dataIndex: ['customer', 'nickname'],
      key: 'customer'
    },
    {
      title: '金额',
      dataIndex: 'totalAmount',
      key: 'totalAmount',
      render: (amount: number) => `¥${amount.toFixed(2)}`
    },
    {
      title: '佣金',
      dataIndex: 'commission',
      key: 'commission',
      render: (commission: number) => `¥${commission.toFixed(2)}`
    },
    {
      title: '状态',
      dataIndex: 'status',
      key: 'status',
      render: (status: string) => {
        const statusMap = {
          PENDING: { color: 'orange', text: '待确认' },
          CONFIRMED: { color: 'blue', text: '已确认' },
          SHIPPED: { color: 'purple', text: '已发货' },
          DELIVERED: { color: 'green', text: '已送达' }
        };
        const config = statusMap[status] || { color: 'default', text: status };
        return <Tag color={config.color}>{config.text}</Tag>;
      }
    },
    {
      title: '操作',
      key: 'action',
      render: (_, record: any) => (
        <Space>
          {record.status === 'PENDING' && (
            <Button
              type="primary"
              size="small"
              onClick={() => confirmOrderMutation.mutate(record.id)}
            >
              确认
            </Button>
          )}
          {record.status === 'CONFIRMED' && (
            <Button
              type="primary"
              size="small"
              onClick={() => {
                Modal.confirm({
                  title: '确认发货',
                  content: '请输入快递信息',
                  onOk: () => {
                    // 发货逻辑
                  }
                });
              }}
            >
              发货
            </Button>
          )}
        </Space>
      )
    }
  ];

  return (
    <Card title="订单管理">
      <Table
        columns={columns}
        dataSource={orderData?.orders}
        loading={isLoading}
        pagination={{
          current: page,
          total: orderData?.pagination.total,
          onChange: setPage
        }}
        rowKey="id"
      />
    </Card>
  );
};
```

## 最佳实践

1. **店铺设置**
   - 选择有吸引力的店铺名称
   - 上传专业的店铺logo
   - 设置准确的营业时间
   - 完善联系方式

2. **商品管理**
   - 合理定价策略
   - 定期更新库存
   - 优化商品描述
   - 上传高质量图片

3. **订单处理**
   - 及时确认订单
   - 快速发货处理
   - 主动沟通客户
   - 处理售后问题

4. **团队管理**
   - 定期培训下级
   - 分享销售经验
   - 激励团队士气
   - 维护团队关系

5. **数据分析**
   - 关注销售趋势
   - 分析客户行为
   - 优化产品结构
   - 提升转化率