# å‰ç«¯ç¯å¢ƒå˜é‡è¿è¡Œæ—¶è¯»å–å®æ–½å®Œæˆ

## ğŸ“‹ å®æ–½æ€»ç»“

å·²æˆåŠŸä¸º **H5 å‰ç«¯** å’Œ **Admin ç®¡ç†åå°** å®ç°äº†è¿è¡Œæ—¶ç¯å¢ƒå˜é‡è¯»å–æœºåˆ¶ï¼Œç¡®ä¿ä¸€æ¬¡æ„å»ºå¯åœ¨å¤šç¯å¢ƒéƒ¨ç½²ã€‚

---

## âœ… H5 é¡¹ç›® (zhongdao-mall-h5)

### ä¿®æ”¹çš„æ–‡ä»¶

1. **src/main.tsx** - æ·»åŠ é…ç½®åˆå§‹åŒ–
   - å¼•å…¥ `appConfig` å’Œ `validateConfig`
   - åœ¨åº”ç”¨å¯åŠ¨æ—¶éªŒè¯é…ç½®
   - å°†é…ç½®æŒ‚è½½åˆ°å…¨å±€ `window.__APP_CONFIG__`

2. **src/config/index.ts** - é…ç½®æ¨¡å—ï¼ˆå·²å­˜åœ¨ï¼‰
   - ä» DOM data å±æ€§è¯»å–é…ç½®ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
   - ä»ç¯å¢ƒå˜é‡è¯»å–é…ç½®ï¼ˆå¼€å‘æ—¶ä½¿ç”¨ï¼‰
   - åˆå¹¶é…ç½®å¹¶éªŒè¯

3. **index.html** - HTML å…¥å£ï¼ˆå·²æœ‰å ä½ç¬¦ï¼‰
   - æ·»åŠ  `data-api-base="${API_BASE}"`
   - æ·»åŠ  `data-api-timeout="${API_TIMEOUT}"`
   - æ·»åŠ  `data-debug="${DEBUG}"`

4. **scripts/inject-config.js** - âœ… æ–°å»º
   - éƒ¨ç½²æ—¶å°†ç¯å¢ƒå˜é‡æ³¨å…¥åˆ° dist/index.html
   - æ›¿æ¢å ä½ç¬¦ä¸ºå®é™…å€¼

5. **package.json** - æ·»åŠ éƒ¨ç½²è„šæœ¬
   ```json
   "build:prod": "vite build --mode production"
   "deploy": "npm run build:prod && node scripts/inject-config.js"
   "deploy:prod": "npm run build:prod && node scripts/inject-config.js"
   ```

### ç¯å¢ƒå˜é‡é…ç½®

**.env.development**
```
VITE_API_BASE_URL=http://localhost:3000
VITE_API_TIMEOUT=10000
VITE_DEBUG=true
```

**.env.production**
```
VITE_API_BASE_URL=https://zd-api.wenbita.cn
VITE_API_TIMEOUT=30000
VITE_DEBUG=false
```

---

## âœ… Admin é¡¹ç›® (zhongdao-mall-admin)

### æ–°å»º/ä¿®æ”¹çš„æ–‡ä»¶

1. **src/config/index.ts** - âœ… æ–°å»ºé…ç½®æ¨¡å—
   - AdminConfig æ¥å£å®šä¹‰
   - ä» DOM å’Œç¯å¢ƒå˜é‡è¯»å–é…ç½®
   - é…ç½®éªŒè¯å‡½æ•°

2. **src/main.tsx** - æ·»åŠ é…ç½®åˆå§‹åŒ–
   - å¼•å…¥é…ç½®æ¨¡å—
   - éªŒè¯é…ç½®
   - æŒ‚è½½åˆ°å…¨å±€å¯¹è±¡

3. **index.html** - ä¿®æ”¹ root å…ƒç´ 
   - æ·»åŠ  `data-api-base="${API_BASE}"`
   - æ·»åŠ  `data-admin-url="${ADMIN_URL}"`
   - æ·»åŠ  `data-api-timeout="${API_TIMEOUT}"`
   - æ·»åŠ  `data-debug="${DEBUG}"`

4. **scripts/inject-config.js** - âœ… æ–°å»ºæ³¨å…¥è„šæœ¬
   - æ”¯æŒ Admin ç‰¹å®šé…ç½®ï¼ˆå« ADMIN_URLï¼‰
   - éƒ¨ç½²æ—¶æ›¿æ¢å ä½ç¬¦

5. **package.json** - æ·»åŠ éƒ¨ç½²è„šæœ¬
   ```json
   "build:prod": "vite build --mode production"
   "deploy": "npm run build:prod && node scripts/inject-config.js"
   "deploy:prod": "npm run build:prod && node scripts/inject-config.js"
   ```

### ç¯å¢ƒå˜é‡é…ç½®

**.env.development** (å·²æ›´æ–°)
```
VITE_API_BASE_URL=http://localhost:3000
VITE_ADMIN_URL=http://localhost:5174
VITE_API_TIMEOUT=10000
VITE_DEBUG=true
```

**.env.production** (å·²æ›´æ–°)
```
VITE_API_BASE_URL=https://zd-api.wenbita.cn
VITE_ADMIN_URL=https://zd-admin.wenbita.cn
VITE_API_TIMEOUT=30000
VITE_DEBUG=false
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¼€å‘ç¯å¢ƒ

```bash
# H5 é¡¹ç›®
cd zhongdao-mall-h5
npm run dev
# è®¿é—® http://localhost:5173
# æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹é…ç½®: window.__APP_CONFIG__

# Admin é¡¹ç›®
cd zhongdao-mall-admin
npm run dev
# è®¿é—® http://localhost:5174
# æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹é…ç½®: window.__APP_CONFIG__
```

### ç”Ÿäº§æ„å»º

```bash
# H5 é¡¹ç›®
cd zhongdao-mall-h5
npm run deploy:prod

# Admin é¡¹ç›®
cd zhongdao-mall-admin
npm run deploy:prod
```

### è‡ªå®šä¹‰ç¯å¢ƒå˜é‡éƒ¨ç½²

```bash
# H5 é¡¹ç›® - è‡ªå®šä¹‰é…ç½®
cd zhongdao-mall-h5
API_BASE=https://custom-api.com npm run deploy

# Admin é¡¹ç›® - è‡ªå®šä¹‰é…ç½®
cd zhongdao-mall-admin
API_BASE=https://custom-api.com ADMIN_URL=https://custom-admin.com npm run deploy
```

---

## âœ… éªŒè¯æ–¹æ³•

### 1. å¼€å‘ç¯å¢ƒéªŒè¯

å¯åŠ¨å¼€å‘æœåŠ¡å™¨åï¼Œåœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­æ‰§è¡Œï¼š

```javascript
// æŸ¥çœ‹é…ç½®å¯¹è±¡
console.log(window.__APP_CONFIG__)

// è¾“å‡ºç¤ºä¾‹ï¼š
// {
//   apiBase: "http://localhost:3000",
//   apiTimeout: 10000,
//   debug: true,
//   environment: "development"
// }
```

### 2. ç”Ÿäº§æ„å»ºéªŒè¯

æ„å»ºå®Œæˆåæ£€æŸ¥äº§å‡ºç‰©ï¼š

```bash
# H5 é¡¹ç›®
cd zhongdao-mall-h5
npm run build:prod
cat dist/index.html | grep "data-api-base"
# åº”è¯¥çœ‹åˆ°: data-api-base="${API_BASE}"

# è¿è¡Œæ³¨å…¥è„šæœ¬å
node scripts/inject-config.js
cat dist/index.html | grep "data-api-base"
# åº”è¯¥çœ‹åˆ°: data-api-base="https://zd-api.wenbita.cn"
```

### 3. ç¡®è®¤æ— ç¡¬ç¼–ç 

åœ¨æ„å»ºäº§å‡ºä¸­æœç´¢ç¡¬ç¼–ç çš„APIåœ°å€ï¼š

```bash
cd dist
grep -r "localhost:3000" .  # åº”è¯¥æ— ç»“æœ
grep -r "http://localhost" .  # åº”è¯¥æ— ç»“æœ
```

---

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### âœ… ä¸€æ¬¡æ„å»ºï¼Œå¤šç¯å¢ƒéƒ¨ç½²
- åŒä¸€ä¸ª dist äº§ç‰©å¯ä»¥åœ¨ä¸åŒç¯å¢ƒè¿è¡Œ
- æ— éœ€é’ˆå¯¹æ¯ä¸ªç¯å¢ƒé‡æ–°æ„å»º

### âœ… è¿è¡Œæ—¶é…ç½®æ³¨å…¥
- é…ç½®åœ¨åº”ç”¨å¯åŠ¨æ—¶ä» DOM è¯»å–
- å¼€å‘æ—¶ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œç”Ÿäº§æ—¶ä½¿ç”¨æ³¨å…¥å€¼

### âœ… é…ç½®ä¼˜å…ˆçº§
1. **æœ€é«˜**ï¼šDOM data å±æ€§ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
2. **æ¬¡ä¹‹**ï¼šç¯å¢ƒå˜é‡ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
3. **é»˜è®¤**ï¼šä»£ç ä¸­çš„é»˜è®¤å€¼

### âœ… å¼€å‘å‹å¥½
- å¼€å‘æ—¶ç›´æ¥ä½¿ç”¨ .env æ–‡ä»¶
- çƒ­é‡è½½æ”¯æŒ
- æ§åˆ¶å°è¾“å‡ºé…ç½®ä¿¡æ¯ä¾¿äºè°ƒè¯•

### âœ… éƒ¨ç½²çµæ´»
- æ”¯æŒç¯å¢ƒå˜é‡è¦†ç›–
- ä¸€é”®éƒ¨ç½²å‘½ä»¤
- è‡ªåŠ¨éªŒè¯é…ç½®å®Œæ•´æ€§

---

## ğŸ“ æ³¨æ„äº‹é¡¹

### 1. æ„å»ºé¡ºåº
å¿…é¡»å…ˆæ„å»ºï¼Œå†æ³¨å…¥é…ç½®ï¼š
```bash
npm run build:prod  # ç¬¬ä¸€æ­¥ï¼šæ„å»º
node scripts/inject-config.js  # ç¬¬äºŒæ­¥ï¼šæ³¨å…¥é…ç½®
```

æˆ–ç›´æ¥ä½¿ç”¨ï¼š
```bash
npm run deploy:prod  # è‡ªåŠ¨æ‰§è¡Œä¸Šè¿°ä¸¤æ­¥
```

### 2. ç¯å¢ƒå˜é‡å‘½å
- Vite é¡¹ç›®ç¯å¢ƒå˜é‡å¿…é¡»ä»¥ `VITE_` å¼€å¤´
- æ³¨å…¥è„šæœ¬æ”¯æŒä¸¤ç§å‘½åï¼š
  - `API_BASE` (ç®€çŸ­)
  - `VITE_API_BASE_URL` (å®Œæ•´)

### 3. å ä½ç¬¦æ ¼å¼
HTML ä¸­çš„å ä½ç¬¦å¿…é¡»ä½¿ç”¨ `${VARIABLE_NAME}` æ ¼å¼

### 4. è°ƒè¯•æ¨¡å¼
å¼€å‘ç¯å¢ƒä¼šåœ¨æ§åˆ¶å°è¾“å‡ºé…ç½®ä¿¡æ¯ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®å…³é—­ï¼š
```
VITE_DEBUG=false
```

---

## ğŸ”„ ä¸åç«¯ API çš„ä¸€è‡´æ€§

ä¸‰ä¸ªé¡¹ç›®ç°åœ¨éƒ½æ”¯æŒè¿è¡Œæ—¶ç¯å¢ƒå˜é‡è¯»å–ï¼š

| é¡¹ç›® | ç±»å‹ | æ¡†æ¶ | é…ç½®æ¨¡å— | çŠ¶æ€ |
|------|------|------|---------|------|
| zhongdao-mall | åç«¯ API | Node.js + Express | src/config/index.ts | âœ… å·²å®ç° |
| zhongdao-mall-h5 | H5 å‰ç«¯ | React 18 + Vite | src/config/index.ts | âœ… å·²å®ç° |
| zhongdao-mall-admin | Admin åå° | React 18 + Vite | src/config/index.ts | âœ… å·²å®ç° |

**æ ¸å¿ƒåŸåˆ™**ï¼šæ‰€æœ‰é¡¹ç›®ç¦æ­¢åœ¨æ„å»ºæ—¶ç¡¬ç¼–ç ç¯å¢ƒå˜é‡ï¼Œå®ç°çœŸæ­£çš„"ä¸€æ¬¡æ„å»ºï¼Œå¤šç¯å¢ƒéƒ¨ç½²"ã€‚

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- åç«¯ API ç¯å¢ƒå˜é‡æ–¹æ¡ˆï¼š`zhongdao-mall/docs/ç¯å¢ƒå˜é‡è¿è¡Œæ—¶è¯»å–ä¿®å¤è¯´æ˜.md`
- åç«¯å¿«é€Ÿéƒ¨ç½²æŒ‡å—ï¼š`zhongdao-mall/docs/å¿«é€Ÿéƒ¨ç½²æŒ‡å—.md`

---

**å®æ–½æ—¥æœŸ**: 2025-11-27
**å®æ–½äººå‘˜**: AI Assistant
**ç‰ˆæœ¬**: 1.0.0
