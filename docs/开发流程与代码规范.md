# ä¸­é“å•†åŸç³»ç»Ÿ - å¼€å‘æµç¨‹ä¸ä»£ç è§„èŒƒ

**æ–‡æ¡£ç›®çš„**ï¼šå®šä¹‰å®Œæ•´çš„å¼€å‘æµç¨‹ã€ä»£ç è§„èŒƒå’Œåä½œæœºåˆ¶
**é€‚ç”¨èŒƒå›´**ï¼šæ‰€æœ‰å‚ä¸é¡¹ç›®å¼€å‘çš„AIåä½œè€…å’Œäººç±»å¼€å‘è€…
**æœ€åæ›´æ–°**ï¼š2025å¹´11æœˆ18æ—¥
**ç‰ˆæœ¬**ï¼š1.0

---

## ğŸ”„ å¼€å‘æµç¨‹è§„èŒƒ

### ğŸ¯ å¼€å‘å‘¨æœŸç®¡ç†

#### åŠŸèƒ½å¼€å‘æµç¨‹

```mermaid
graph TD
    A[éœ€æ±‚åˆ†æ] --> B[æŠ€æœ¯è®¾è®¡]
    B --> C[ä»»åŠ¡æ‹†åˆ†]
    C --> D[ç¼–ç å®ç°]
    D --> E[å•å…ƒæµ‹è¯•]
    E --> F[ä»£ç å®¡æŸ¥]
    F --> G[é›†æˆæµ‹è¯•]
    G --> H[åŠŸèƒ½éªŒæ”¶]
    H --> I[éƒ¨ç½²å‘å¸ƒ]
    I --> J[ç›‘æ§è§‚å¯Ÿ]
    J --> K[æ–‡æ¡£æ›´æ–°]
```

#### è¯¦ç»†çš„å¼€å‘é˜¶æ®µ

**1. éœ€æ±‚åˆ†æé˜¶æ®µï¼ˆå¿…é¡»å®Œæˆï¼‰**
```bash
# éœ€æ±‚åˆ†ææ£€æŸ¥æ¸…å•
â–¡ ç†è§£ä¸šåŠ¡éœ€æ±‚çš„èƒŒæ™¯å’Œä»·å€¼
â–¡ æ˜ç¡®åŠŸèƒ½è¾¹ç•Œå’Œçº¦æŸæ¡ä»¶
â–¡ è¯†åˆ«æŠ€æœ¯é£é™©å’Œä¾èµ–å…³ç³»
â–¡ è¯„ä¼°å¼€å‘å·¥ä½œé‡å’Œæ—¶é—´
â–¡ è¾“å‡ºæŠ€æœ¯è®¾è®¡æ–¹æ¡ˆ
```

**2. æŠ€æœ¯è®¾è®¡é˜¶æ®µï¼ˆå¿…é¡»å®Œæˆï¼‰**
```bash
# æŠ€æœ¯è®¾è®¡è¦ç‚¹
â–¡ APIæ¥å£è®¾è®¡ï¼ˆéµå¾ªRESTfulè§„èŒƒï¼‰
â–¡ æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡ï¼ˆéµå¾ªæ•°æ®åº“è§„èŒƒï¼‰
â–¡ æ ¸å¿ƒç®—æ³•å’Œä¸šåŠ¡é€»è¾‘è®¾è®¡
â–¡ é”™è¯¯å¤„ç†å’Œå¼‚å¸¸åœºæ™¯è®¾è®¡
â–¡ æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ
â–¡ å®‰å…¨æ€§è€ƒè™‘
```

**3. ç¼–ç å®ç°é˜¶æ®µï¼ˆä¸¥æ ¼éµå¾ªè§„èŒƒï¼‰**
```bash
# ç¼–ç è¦æ±‚
â–¡ TypeScriptä¸¥æ ¼æ¨¡å¼ï¼Œé¿å…anyç±»å‹
â–¡ éµå¾ªä»£ç é£æ ¼è§„èŒƒ
â–¡ ç¼–å†™æ¸…æ™°çš„æ³¨é‡Šå’Œæ–‡æ¡£
â–¡ å®ç°å®Œæ•´çš„é”™è¯¯å¤„ç†
â–¡ éµå¾ªä¸šåŠ¡é€»è¾‘çº¦æŸ
```

### ğŸ“ ä»£ç æäº¤è§„èŒƒ

#### æäº¤ä¿¡æ¯æ ¼å¼

```bash
# æäº¤æ ¼å¼
<type>(<scope>): <subject>

<body>

<footer>
```

#### æäº¤ç±»å‹è¯´æ˜

```typescript
// æäº¤ç±»å‹å®šä¹‰
type CommitType =
  | 'feat'     // æ–°åŠŸèƒ½
  | 'fix'      // ä¿®å¤bug
  | 'docs'     // æ–‡æ¡£æ›´æ–°
  | 'style'    // ä»£ç æ ¼å¼è°ƒæ•´
  | 'refactor' // é‡æ„ä»£ç 
  | 'perf'     // æ€§èƒ½ä¼˜åŒ–
  | 'test'     // æµ‹è¯•ç›¸å…³
  | 'chore'    // æ„å»ºè¿‡ç¨‹æˆ–å·¥å…·å˜åŠ¨
  | 'revert'   // å›æ»šæäº¤
  | 'build'    // æ„å»ºç³»ç»Ÿ
  | 'ci'       // CIé…ç½®
  | 'hotfix'   // ç´§æ€¥ä¿®å¤;

// ç¤ºä¾‹æäº¤
feat(user): add user level upgrade logic

- Implement upgrade algorithm based on sales volume
- Add team structure validation
- Include automatic downgrade mechanism

Closes #123
```

#### æäº¤æ£€æŸ¥æ¸…å•

```bash
# æäº¤å‰æ£€æŸ¥
â–¡ ä»£ç ç¼–è¯‘é€šè¿‡ï¼ˆnpm run type-checkï¼‰
â–¡ å•å…ƒæµ‹è¯•é€šè¿‡ï¼ˆnpm testï¼‰
â–¡ ä»£ç é£æ ¼æ£€æŸ¥é€šè¿‡ï¼ˆnpm run lintï¼‰
â–¡ åŠŸèƒ½æµ‹è¯•éªŒè¯å®Œæˆ
â–¡ æ–‡æ¡£æ›´æ–°å®Œæˆ
â–¡ æäº¤ä¿¡æ¯æ ¼å¼æ­£ç¡®
```

---

## ğŸ“‹ ä»£ç å®¡æŸ¥è§„èŒƒ

### ğŸ‘¥ å®¡æŸ¥è§’è‰²å’ŒèŒè´£

#### å®¡æŸ¥è€…ç±»å‹

| å®¡æŸ¥è€… | è§’è‰² | å®¡æŸ¥é‡ç‚¹ | å®¡æŸ¥æƒé™ |
|--------|------|----------|----------|
| **æ¶æ„å¸ˆAI** | æŠ€æœ¯æ¶æ„å®¡æŸ¥ | æ¶æ„è®¾è®¡ã€æŠ€æœ¯é€‰å‹ã€æ€§èƒ½æ–¹æ¡ˆ | æ¶æ„å¦å†³æƒ |
| **é¢†åŸŸAI** | ä¸šåŠ¡é€»è¾‘å®¡æŸ¥ | ä¸šåŠ¡è§„åˆ™æ­£ç¡®æ€§ã€æ•°æ®ä¸€è‡´æ€§ | ä¸šåŠ¡å¦å†³æƒ |
| **æµ‹è¯•AI** | è´¨é‡å®¡æŸ¥ | æµ‹è¯•è¦†ç›–ã€é”™è¯¯å¤„ç†ã€è¾¹ç•Œæƒ…å†µ | è´¨é‡å¦å†³æƒ |
| **å®‰å…¨AI** | å®‰å…¨å®¡æŸ¥ | å®‰å…¨æ¼æ´ã€æƒé™æ§åˆ¶ã€æ•°æ®ä¿æŠ¤ | å®‰å…¨å¦å†³æƒ |

#### å®¡æŸ¥æµç¨‹

```typescript
// ä»£ç å®¡æŸ¥æµç¨‹
interface CodeReview {
  // 1. åˆ›å»ºå®¡æŸ¥è¯·æ±‚
  createReview(pullRequest: PullRequest): ReviewRequest;

  // 2. è‡ªåŠ¨æ£€æŸ¥
  runAutomatedChecks(review: ReviewRequest): CheckResults;

  // 3. äººå·¥å®¡æŸ¥
  humanReview(review: ReviewRequest): ReviewFeedback[];

  // 4. å®¡æŸ¥å†³ç­–
  makeDecision(feedback: ReviewFeedback[]): ReviewDecision;
}

// å®¡æŸ¥å†³ç­–ç±»å‹
type ReviewDecision =
  | 'approve'     // ç›´æ¥é€šè¿‡
  | 'approve_with_suggestions' // é€šè¿‡ä½†å»ºè®®ä¿®æ”¹
  | 'request_changes' // éœ€è¦ä¿®æ”¹
  | 'reject'      // æ‹’ç»åˆå¹¶
  | 'hold'        // æš‚ç¼“å®¡æŸ¥;
```

### ğŸ” å®¡æŸ¥æ£€æŸ¥æ¸…å•

#### æ¶æ„è®¾è®¡å®¡æŸ¥

```bash
# æ¶æ„å®¡æŸ¥è¦ç‚¹
â–¡ æ¨¡å—èŒè´£æ˜¯å¦æ¸…æ™°å•ä¸€
â–¡ ä¾èµ–å…³ç³»æ˜¯å¦åˆç†
â–¡ æ¥å£è®¾è®¡æ˜¯å¦æ¸…æ™°
â–¡ æ‰©å±•æ€§æ˜¯å¦è‰¯å¥½
â–¡ æ€§èƒ½æ˜¯å¦æ»¡è¶³è¦æ±‚
â–¡ æ•°æ®åº“è®¾è®¡æ˜¯å¦åˆç†
```

#### ä¸šåŠ¡é€»è¾‘å®¡æŸ¥

```bash
# ä¸šåŠ¡é€»è¾‘å®¡æŸ¥è¦ç‚¹
â–¡ æ˜¯å¦ç¬¦åˆä¸šåŠ¡è§„åˆ™çº¦æŸ
â–¡ ç”¨æˆ·ç­‰çº§é€»è¾‘æ˜¯å¦æ­£ç¡®
â–¡ é‡‡è´­æƒé™éªŒè¯æ˜¯å¦å®Œæ•´
â–¡ é€šåˆ¸æµè½¬æ˜¯å¦å®‰å…¨
â–¡ åº“å­˜ç®¡ç†é€»è¾‘æ˜¯å¦æ­£ç¡®
â–¡ ä½£é‡‘è®¡ç®—æ˜¯å¦å‡†ç¡®
```

#### ä»£ç è´¨é‡å®¡æŸ¥

```bash
# ä»£ç è´¨é‡å®¡æŸ¥è¦ç‚¹
â–¡ ä»£ç æ˜¯å¦æ˜“äºç†è§£å’Œç»´æŠ¤
â–¡ å˜é‡å’Œå‡½æ•°å‘½åæ˜¯å¦æ¸…æ™°
â–¡ æ˜¯å¦æœ‰é‡å¤ä»£ç 
â–¡ é”™è¯¯å¤„ç†æ˜¯å¦å®Œæ•´
â–¡ æµ‹è¯•è¦†ç›–æ˜¯å¦å……åˆ†
â–¡ æ–‡æ¡£æ˜¯å¦å®Œæ•´
```

#### å®‰å…¨æ€§å®¡æŸ¥

```bash
# å®‰å…¨æ€§å®¡æŸ¥è¦ç‚¹
â–¡ æ˜¯å¦æœ‰SQLæ³¨å…¥é£é™©
â–¡ æ˜¯å¦æœ‰XSSé£é™©
â–¡ æƒé™æ§åˆ¶æ˜¯å¦å®Œå–„
â–¡ æ•æ„Ÿæ•°æ®æ˜¯å¦åŠ å¯†
â–¡ APIæ¥å£æ˜¯å¦å®‰å…¨
â–¡ ä¸šåŠ¡é€»è¾‘æ¼æ´æ£€æŸ¥
```

---

## ğŸ“ ç¼–ç è§„èŒƒ

### ğŸ¨ TypeScriptç¼–ç è§„èŒƒ

#### ç±»å‹å®šä¹‰è§„èŒƒ

```typescript
// 1. ä¸¥æ ¼çš„ç±»å‹å®šä¹‰
interface User {
  readonly id: string;
  nickname: string;
  level: UserLevel;
  status: UserStatus;
  createdAt: Date;
  updatedAt: Date;
}

// ä½¿ç”¨è”åˆç±»å‹è€Œä¸æ˜¯æšä¸¾
type UserLevel = 'normal' | 'vip' | 'star_1' | 'star_2' | 'star_3' | 'star_4' | 'star_5' | 'director';
type UserStatus = 'active' | 'inactive' | 'suspended';

// 2. å‡½æ•°ç±»å‹å®šä¹‰
type UserService = {
  getUserById(id: string): Promise<User | null>;
  createUser(userData: CreateUserDto): Promise<User>;
  updateUser(id: string, updates: UpdateUserDto): Promise<User>;
};

// 3. ä¸¥æ ¼çš„æ³›å‹ä½¿ç”¨
interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: ErrorInfo;
  timestamp: string;
}

// 4. é¿å…anyç±»å‹ï¼Œä½¿ç”¨unknown
function processUnknownData(data: unknown): void {
  if (typeof data === 'string') {
    console.log(data);
  }
}
```

#### å‡½æ•°ç¼–å†™è§„èŒƒ

```typescript
// 1. å‡½æ•°å‘½åè¦æ¸…æ™°æ˜ç¡®
class UserService {
  // âœ… å¥½çš„å‘½å
  async calculateUserLevel(userId: string): Promise<UserLevel> {
    // å®ç°ç”¨æˆ·ç­‰çº§è®¡ç®—
  }

  async validatePurchasePermission(buyerId: string, sellerId: string): Promise<boolean> {
    // éªŒè¯é‡‡è´­æƒé™
  }

  // âŒ ä¸å¥½çš„å‘½å
  async calc(userId: string): Promise<UserLevel> {
    // å‘½åä¸æ¸…æ™°
  }
}

// 2. å‡½æ•°è¦å•ä¸€èŒè´£
class PointsService {
  // âœ… å•ä¸€èŒè´£
  async transferPoints(fromUserId: string, toUserId: string, amount: number): Promise<void> {
    await this.validateBalance(fromUserId, amount);
    await this.processTransfer(fromUserId, toUserId, amount);
    await this.recordTransaction(fromUserId, toUserId, amount);
  }

  private async validateBalance(userId: string, amount: number): Promise<void> {
    // éªŒè¯ä½™é¢é€»è¾‘
  }

  private async processTransfer(fromId: string, toId: string, amount: number): Promise<void> {
    // å¤„ç†è½¬è´¦é€»è¾‘
  }

  private async recordTransaction(fromId: string, toId: string, amount: number): Promise<void> {
    // è®°å½•æµæ°´é€»è¾‘
  }
}

// 3. å®Œæ•´çš„é”™è¯¯å¤„ç†
class InventoryService {
  async transferToWarehouse(userId: string, productId: string, quantity: number): Promise<void> {
    try {
      // å‚æ•°éªŒè¯
      if (quantity <= 0) {
        throw new ValidationError('Quantity must be positive');
      }

      // ä¸šåŠ¡é€»è¾‘éªŒè¯
      const availableStock = await this.getCloudWarehouseStock(userId, productId);
      if (availableStock < quantity) {
        throw new BusinessError('Insufficient stock in cloud warehouse');
      }

      // æ‰§è¡Œè½¬ç§»
      await this.executeTransfer(userId, productId, quantity);

    } catch (error) {
      // é”™è¯¯æ—¥å¿—è®°å½•
      logger.error('Failed to transfer to local warehouse', {
        userId,
        productId,
        quantity,
        error: error.message
      });

      // é‡æ–°æŠ›å‡ºä¸šåŠ¡é”™è¯¯
      if (error instanceof BusinessError) {
        throw error;
      }

      // åŒ…è£…æœªçŸ¥é”™è¯¯
      throw new SystemError('Failed to transfer inventory', error);
    }
  }
}
```

#### æ•°æ®åº“æ“ä½œè§„èŒƒ

```typescript
// ä½¿ç”¨Prisma ORMçš„è§„èŒƒ
class PurchaseRepository {
  // 1. ä½¿ç”¨äº‹åŠ¡å¤„ç†å¤æ‚ä¸šåŠ¡é€»è¾‘
  async createPurchaseOrder(data: CreatePurchaseDto): Promise<PurchaseOrder> {
    return await prisma.$transaction(async (tx) => {
      // 1. éªŒè¯é‡‡è´­æƒé™
      const hasPermission = await this.validatePurchasePermission(
        tx,
        data.buyerId,
        data.sellerId
      );

      if (!hasPermission) {
        throw new BusinessError('No purchase permission');
      }

      // 2. æ£€æŸ¥åº“å­˜
      const inventory = await tx.inventory.findFirst({
        where: {
          userId: data.sellerId,
          productId: data.productId,
          warehouseType: 'cloud',
          quantity: { gte: data.quantity }
        }
      });

      if (!inventory) {
        throw new BusinessError('Insufficient inventory');
      }

      // 3. åˆ›å»ºé‡‡è´­è®¢å•
      const purchase = await tx.purchaseOrder.create({
        data: {
          buyerId: data.buyerId,
          sellerId: data.sellerId,
          productId: data.productId,
          quantity: data.quantity,
          unitPrice: data.unitPrice,
          totalAmount: data.quantity * data.unitPrice,
          status: 'pending'
        }
      });

      // 4. å¤„ç†é€šåˆ¸æµè½¬
      await this.processPointsTransfer(
        tx,
        data.buyerId,
        data.sellerId,
        data.quantity * data.unitPrice,
        'PURCHASE'
      );

      // 5. æ›´æ–°åº“å­˜
      await tx.inventory.update({
        where: { id: inventory.id },
        data: {
          quantity: { decrement: data.quantity }
        }
      });

      return purchase;
    });
  }

  // 2. ä½¿ç”¨ç±»å‹å®‰å…¨çš„æŸ¥è¯¢
  async findPurchaseOrders(userId: string, options: QueryOptions): Promise<PaginatedResult<PurchaseOrder>> {
    const { page = 1, perPage = 20, status, startDate, endDate } = options;

    const where: Prisma.PurchaseOrderWhereInput = {
      OR: [
        { buyerId: userId },
        { sellerId: userId }
      ]
    };

    if (status) {
      where.status = status;
    }

    if (startDate || endDate) {
      where.createdAt = {};
      if (startDate) where.createdAt.gte = startDate;
      if (endDate) where.createdAt.lte = endDate;
    }

    const [orders, total] = await Promise.all([
      prisma.purchaseOrder.findMany({
        where,
        include: {
          buyer: { select: { id: true, nickname: true, level: true } },
          seller: { select: { id: true, nickname: true, level: true } },
          product: { select: { id: true, name: true, category: true } }
        },
        orderBy: { createdAt: 'desc' },
        skip: (page - 1) * perPage,
        take: perPage
      }),

      prisma.purchaseOrder.count({ where })
    ]);

    return {
      items: orders,
      pagination: {
        page,
        perPage,
        total,
        totalPages: Math.ceil(total / perPage),
        hasNext: page * perPage < total,
        hasPrev: page > 1
      }
    };
  }
}
```

### ğŸ¯ APIè®¾è®¡è§„èŒƒ

#### Controllerå±‚è§„èŒƒ

```typescript
// 1. ç»Ÿä¸€çš„å“åº”æ ¼å¼
class UserController {
  // âœ… æ ‡å‡†çš„APIè®¾è®¡
  @Get('/profile')
  async getUserProfile(@Request() req: AuthenticatedRequest): Promise<ApiResponse<UserProfile>> {
    try {
      const userId = req.user.id;
      const userProfile = await this.userService.getUserProfile(userId);

      return {
        success: true,
        data: userProfile,
        message: 'è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ',
        timestamp: new Date().toISOString(),
        requestId: req.id
      };

    } catch (error) {
      logger.error('Failed to get user profile', { userId, error: error.message });

      return {
        success: false,
        error: {
          code: 'USER_PROFILE_ERROR',
          message: 'è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥',
          details: error.message,
          timestamp: new Date().toISOString()
        },
        timestamp: new Date().toISOString(),
        requestId: req.id
      };
    }
  }

  // âœ… å‚æ•°éªŒè¯ç¤ºä¾‹
  @Post('/upgrade')
  async upgradeLevel(
    @Request() req: AuthenticatedRequest,
    @Body() upgradeDto: UpgradeLevelDto
  ): Promise<ApiResponse<UpgradeResult>> {
    // DTOéªŒè¯
    const validation = validateUpgradeLevelDto(upgradeDto);
    if (!validation.isValid) {
      throw new ValidationError(validation.errors);
    }

    try {
      const userId = req.user.id;
      const result = await this.userService.requestLevelUpgrade(userId, upgradeDto);

      return {
        success: true,
        data: result,
        message: 'ç­‰çº§å‡çº§ç”³è¯·å·²æäº¤',
        timestamp: new Date().toISOString(),
        requestId: req.id
      };

    } catch (error) {
      return this.handleError(error, req.id);
    }
  }

  private handleError(error: Error, requestId: string): ApiResponse<never> {
    if (error instanceof ValidationError) {
      return {
        success: false,
        error: {
          code: 'VALIDATION_ERROR',
          message: 'è¯·æ±‚å‚æ•°éªŒè¯å¤±è´¥',
          details: error.details,
          timestamp: new Date().toISOString()
        },
        timestamp: new Date().toISOString(),
        requestId
      };
    }

    if (error instanceof BusinessError) {
      return {
        success: false,
        error: {
          code: error.code,
          message: error.message,
          timestamp: new Date().toISOString()
        },
        timestamp: new Date().toISOString(),
        requestId
      };
    }

    // æœªçŸ¥é”™è¯¯
    return {
      success: false,
      error: {
        code: 'INTERNAL_ERROR',
        message: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯',
        timestamp: new Date().toISOString()
      },
      timestamp: new Date().toISOString(),
      requestId
    };
  }
}
```

#### DTOå®šä¹‰è§„èŒƒ

```typescript
// ä½¿ç”¨class-validatorè¿›è¡Œå‚æ•°éªŒè¯
import { IsString, IsEnum, IsOptional, IsInt, Min, Max } from 'class-validator';
import { Transform } from 'class-transformer';

export class CreateUserDto {
  @IsString()
  @Transform(({ value }) => value?.trim())
  nickname: string;

  @IsString()
  @Matches(/^1[3-9]\d{9}$/, { message: 'æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®' })
  phone: string;

  @IsOptional()
  @IsString()
  avatarUrl?: string;

  @IsOptional()
  @IsEnum(['normal', 'vip'])
  level?: 'normal' | 'vip';
}

export class QueryUsersDto {
  @IsOptional()
  @Transform(({ value }) => parseInt(value))
  @IsInt({ message: 'é¡µç å¿…é¡»æ˜¯æ•´æ•°' })
  @Min(1, { message: 'é¡µç æœ€å°ä¸º1' })
  page?: number = 1;

  @IsOptional()
  @Transform(({ value }) => parseInt(value))
  @IsInt({ message: 'æ¯é¡µæ•°é‡å¿…é¡»æ˜¯æ•´æ•°' })
  @Min(1, { message: 'æ¯é¡µæ•°é‡æœ€å°ä¸º1' })
  @Max(100, { message: 'æ¯é¡µæ•°é‡æœ€å¤§ä¸º100' })
  perPage?: number = 20;

  @IsOptional()
  @IsEnum(['normal', 'vip', 'star_1', 'star_2', 'star_3', 'star_4', 'star_5', 'director'])
  level?: UserLevel;

  @IsOptional()
  @IsEnum(['active', 'inactive', 'suspended'])
  status?: UserStatus;

  @IsOptional()
  @IsString()
  search?: string;
}
```

---

## ğŸ”§ å¼€å‘å·¥å…·é…ç½®

### ğŸ“¦ ESLinté…ç½®

```json
// .eslintrc.json
{
  "extends": [
    "@typescript-eslint/recommended",
    "@typescript-eslint/recommended-requiring-type-checking"
  ],
  "parser": "@typescript-eslint/parser",
  "parserOptions": {
    "project": "./tsconfig.json",
    "tsconfigRootDir": "./"
  },
  "plugins": ["@typescript-eslint"],
  "rules": {
    // ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥
    "@typescript-eslint/no-explicit-any": "error",
    "@typescript-eslint/no-unused-vars": "error",
    "@typescript-eslint/explicit-function-return-type": "warn",
    "@typescript-eslint/no-floating-promises": "error",
    "@typescript-eslint/await-thenable": "error",

    // ä»£ç è´¨é‡
    "no-console": "warn",
    "prefer-const": "error",
    "no-var": "error",
    "object-shorthand": "error",
    "prefer-template": "error",

    // ä¸šåŠ¡é€»è¾‘ç›¸å…³
    "max-lines-per-function": ["warn", { "max": 50 }],
    "complexity": ["warn", { "max": 10 }]
  },
  "overrides": [
    {
      "files": ["**/*.test.ts", "**/*.spec.ts"],
      "rules": {
        "@typescript-eslint/no-explicit-any": "off",
        "max-lines-per-function": "off"
      }
    }
  ]
}
```

### ğŸ¨ Prettieré…ç½®

```json
// .prettierrc
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 100,
  "tabWidth": 2,
  "useTabs": false,
  "bracketSpacing": true,
  "arrowParens": "avoid"
}
```

### ğŸ§ª æµ‹è¯•é…ç½®

```json
// jest.config.json
{
  "preset": "ts-jest",
  "testEnvironment": "node",
  "roots": ["<rootDir>/src", "<rootDir>/tests"],
  "testMatch": [
    "**/__tests__/**/*.ts",
    "**/?(*.)+(spec|test).ts"
  ],
  "transform": {
    "^.+\\.ts$": "ts-jest"
  },
  "collectCoverageFrom": [
    "src/**/*.ts",
    "!src/**/*.d.ts",
    "!src/types/**"
  ],
  "coverageThreshold": {
    "global": {
      "branches": 80,
      "functions": 80,
      "lines": 80,
      "statements": 80
    },
    "./src/modules/user/": {
      "branches": 90,
      "functions": 90,
      "lines": 90,
      "statements": 90
    }
  },
  "setupFilesAfterEnv": ["<rootDir>/tests/setup.ts"]
}
```

---

## ğŸ“š æ–‡æ¡£è§„èŒƒ

### ğŸ“– ä»£ç æ–‡æ¡£è§„èŒƒ

```typescript
/**
 * ç”¨æˆ·ç­‰çº§æœåŠ¡
 *
 * è´Ÿè´£å¤„ç†ç”¨æˆ·ç­‰çº§çš„å‡çº§ã€é™çº§ã€éªŒè¯ç­‰ä¸šåŠ¡é€»è¾‘
 *
 * @example
 * ```typescript
 * const userLevelService = new UserLevelService();
 * const result = await userLevelService.checkUpgrade(userId);
 * if (result.canUpgrade) {
 *   await userLevelService.processUpgrade(userId);
 * }
 * ```
 */
export class UserLevelService {
  /**
   * æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å¯ä»¥å‡çº§
   *
   * @param userId - ç”¨æˆ·ID
   * @returns å‡çº§æ£€æŸ¥ç»“æœ
   *
   * @throws {UserNotFoundError} ç”¨æˆ·ä¸å­˜åœ¨æ—¶æŠ›å‡º
   * @throws {ValidationError} å‚æ•°éªŒè¯å¤±è´¥æ—¶æŠ›å‡º
   *
   * @example
   * ```typescript
   * const result = await userLevelService.checkUpgrade('user123');
   * console.log(result.canUpgrade); // true/false
   * console.log(result.currentProgress); // å½“å‰è¿›åº¦ä¿¡æ¯
   * ```
   */
  async checkUpgrade(userId: string): Promise<UpgradeCheckResult> {
    // å®ç°
  }

  /**
   * å¤„ç†ç”¨æˆ·ç­‰çº§å‡çº§
   *
   * @param userId - ç”¨æˆ·ID
   * @param upgradeData - å‡çº§æ•°æ®
   * @returns å‡çº§ç»“æœ
   *
   * @businessRule
   * - å¿…é¡»æ»¡è¶³é”€é‡è¦æ±‚ï¼šæ€»é”€å”®é¢ Ã· 599å…ƒ >= ç­‰çº§å¯¹åº”ç“¶æ•°
   * - å¿…é¡»æ»¡è¶³å›¢é˜Ÿè¦æ±‚ï¼šæ‹¥æœ‰å¯¹åº”æ•°é‡çš„ç›´æ¨ä¸‹çº§
   * - ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
   *
   * @throws {BusinessError} ä¸æ»¡è¶³å‡çº§æ¡ä»¶æ—¶æŠ›å‡º
   * @throws {SystemError} ç³»ç»Ÿé”™è¯¯æ—¶æŠ›å‡º
   */
  async processUpgrade(
    userId: string,
    upgradeData: ProcessUpgradeDto
  ): Promise<UpgradeResult> {
    // å®ç°
  }
}
```

### ğŸ“‹ APIæ–‡æ¡£è§„èŒƒ

```typescript
/**
 * è·å–ç”¨æˆ·ä¿¡æ¯
 *
 * @api {get} /api/v1/users/profile è·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯
 * @apiName GetUserProfile
 * @apiGroup User
 * @apiVersion 1.0.0
 *
 * @apiHeader {String} Authorization Bearer token
 * @apiHeader {String} X-Request-ID è¯·æ±‚å”¯ä¸€æ ‡è¯†
 *
 * @apiSuccess {Boolean} success è¯·æ±‚æ˜¯å¦æˆåŠŸ
 * @apiSuccess {Object} data ç”¨æˆ·æ•°æ®
 * @apiSuccess {String} data.id ç”¨æˆ·ID
 * @apiSuccess {String} data.nickname ç”¨æˆ·æ˜µç§°
 * @apiSuccess {String} data.level ç”¨æˆ·ç­‰çº§
 * @apiSuccess {String} data.status ç”¨æˆ·çŠ¶æ€
 * @apiSuccess {Number} data.totalSales æ€»é”€å”®é¢
 * @apiSuccess {Number} data.teamCount å›¢é˜Ÿäººæ•°
 * @apiSuccess {String} data.createdAt åˆ›å»ºæ—¶é—´
 *
 * @apiError {Boolean} success è¯·æ±‚æ˜¯å¦å¤±è´¥
 * @apiError {Object} error é”™è¯¯ä¿¡æ¯
 * @apiError {String} error.code é”™è¯¯ç 
 * @apiError {String} error.message é”™è¯¯ä¿¡æ¯
 *
 * @apiExample {curl} è¯·æ±‚ç¤ºä¾‹:
 * curl -X GET "http://localhost:3000/api/v1/users/profile" \
 *   -H "Authorization: Bearer your_token_here" \
 *   -H "X-Request-ID: req-123456"
 *
 * @apiSuccessExample {json} æˆåŠŸå“åº”:
 * {
 *   "success": true,
 *   "data": {
 *     "id": "user123",
 *     "nickname": "å¼ ä¸‰",
 *     "level": "star_1",
 *     "status": "active",
 *     "totalSales": 15000.00,
 *     "teamCount": 5,
 *     "createdAt": "2023-11-18T10:30:00Z"
 *   },
 *   "message": "è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ",
 *   "timestamp": "2023-11-18T16:00:00Z",
 *   "requestId": "req-123456"
 * }
 */
```

---

## ğŸ­ åä½œæ–‡åŒ–

### ğŸ¤ åä½œåŸåˆ™

#### 1. å°Šé‡ä¸“ä¸š
- å°Šé‡å…¶ä»–AIçš„ä¸“ä¸šé¢†åŸŸå’Œå»ºè®®
- è™šå¿ƒæ¥å—ä»£ç å®¡æŸ¥å’Œåé¦ˆ
- ç§¯æåˆ†äº«çŸ¥è¯†å’Œç»éªŒ

#### 2. ä¸»åŠ¨æ²Ÿé€š
- é‡åˆ°é—®é¢˜åŠæ—¶æ²Ÿé€šï¼Œä¸éšç’ä¸æ‹–å»¶
- é‡å¤§æŠ€æœ¯å†³ç­–éœ€è¦å›¢é˜Ÿè®¨è®º
- å®šæœŸåˆ†äº«å¼€å‘è¿›å±•å’Œç»éªŒ

#### 3. è´¨é‡ç¬¬ä¸€
- ä»£ç è´¨é‡æ¯”å¼€å‘é€Ÿåº¦æ›´é‡è¦
- ä¸ç¬¦åˆè§„èŒƒçš„ä»£ç åšå†³ä¸åˆå¹¶
- æµ‹è¯•è¦†ç›–ç‡ä¸è¾¾æ ‡ç»ä¸å‘å¸ƒ

#### 4. æŒç»­å­¦ä¹ 
- å®šæœŸæ€»ç»“å¼€å‘ç»éªŒ
- å…³æ³¨æŠ€æœ¯å‘å±•è¶‹åŠ¿
- ä¼˜åŒ–å¼€å‘æµç¨‹å’Œå·¥å…·

### ğŸ“ˆ æŒç»­æ”¹è¿›

#### å®šæœŸå›é¡¾
- æ¯å‘¨è¿›è¡Œå¼€å‘å›é¡¾ä¼šè®®
- åˆ†æé—®é¢˜å’Œæ”¹è¿›æœºä¼š
- æ›´æ–°å¼€å‘è§„èŒƒå’Œæµç¨‹

#### çŸ¥è¯†åˆ†äº«
- å®šæœŸç»„ç»‡æŠ€æœ¯åˆ†äº«ä¼š
- ç»´æŠ¤å›¢é˜ŸçŸ¥è¯†åº“
- ç¼–å†™æœ€ä½³å®è·µæ–‡æ¡£

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•

### å¼€å‘å‰æ£€æŸ¥
- [ ] éœ€æ±‚åˆ†æå’Œç†è§£å®Œæˆ
- [ ] æŠ€æœ¯è®¾è®¡æ–¹æ¡ˆé€šè¿‡å®¡æŸ¥
- [ ] å¼€å‘ç¯å¢ƒé…ç½®å®Œæˆ
- [ ] ç›¸å…³æ–‡æ¡£é˜…è¯»å®Œæ¯•

### ç¼–ç ä¸­æ£€æŸ¥
- [ ] éµå¾ªä»£ç é£æ ¼è§„èŒƒ
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•
- [ ] å®Œæ•´é”™è¯¯å¤„ç†
- [ ] æ·»åŠ å¿…è¦æ³¨é‡Š

### æäº¤å‰æ£€æŸ¥
- [ ] ä»£ç ç¼–è¯‘é€šè¿‡
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] ä»£ç é£æ ¼æ£€æŸ¥é€šè¿‡
- [ ] åŠŸèƒ½æµ‹è¯•éªŒè¯å®Œæˆ

### åˆå¹¶å‰æ£€æŸ¥
- [ ] ä»£ç å®¡æŸ¥å®Œæˆ
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] æ–‡æ¡£æ›´æ–°å®Œæˆ
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡ï¼ˆå¦‚éœ€è¦ï¼‰

---

**é‡è¦æé†’**ï¼š
1. ä»£ç è´¨é‡æ˜¯é¡¹ç›®çš„ç”Ÿå‘½çº¿ï¼Œç»ä¸å¦¥å
2. ä¸šåŠ¡é€»è¾‘æ­£ç¡®æ€§æ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œå¿…é¡»ä¸¥æ ¼éªŒè¯
3. æµ‹è¯•æ˜¯è´¨é‡çš„ä¿éšœï¼Œå¿…é¡»å……åˆ†è¦†ç›–
4. æ–‡æ¡£æ˜¯åä½œçš„æ¡¥æ¢ï¼Œå¿…é¡»åŠæ—¶æ›´æ–°
5. å®‰å…¨æ˜¯å‘å±•çš„åŸºç¡€ï¼Œå¿…é¡»æ—¶åˆ»å…³æ³¨

**éµå¾ªè¿™äº›è§„èŒƒï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªé«˜è´¨é‡ã€å¯ç»´æŠ¤ã€å®‰å…¨å¯é çš„ä¸­é“å•†åŸç³»ç»Ÿï¼** ğŸš€