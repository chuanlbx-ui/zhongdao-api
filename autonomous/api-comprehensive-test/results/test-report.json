{
  "testRun": {
    "startTime": "2025-12-09T12:19:56.309Z",
    "endTime": "2025-12-09T12:32:58.753Z",
    "duration": 782444
  },
  "summary": {
    "total": 13,
    "passed": 1,
    "failed": 12,
    "skipped": 0
  },
  "modules": [
    {
      "name": "00-环境检查",
      "status": "failed",
      "duration": 2095
    },
    {
      "name": "用户认证系统 - auth.test.ts",
      "status": "failed",
      "duration": 5188
    },
    {
      "name": "用户管理系统 - users.test.ts",
      "status": "failed",
      "duration": 276557
    },
    {
      "name": "商城管理系统 - shops.test.ts",
      "status": "failed",
      "duration": 7874
    },
    {
      "name": "商品管理系统 - products.test.ts",
      "status": "failed",
      "duration": 4586
    },
    {
      "name": "订单管理系统 - orders.test.ts",
      "status": "failed",
      "duration": 4687
    },
    {
      "name": "积分系统 - points.test.ts",
      "status": "failed",
      "duration": 454959
    },
    {
      "name": "支付系统 - payments.test.ts",
      "status": "passed",
      "duration": 6542
    },
    {
      "name": "佣金系统 - commission.test.ts",
      "status": "failed",
      "duration": 8127
    },
    {
      "name": "管理系统",
      "status": "failed",
      "duration": 6892
    },
    {
      "name": "安全测试",
      "status": "failed",
      "duration": 1708
    },
    {
      "name": "性能测试",
      "status": "failed",
      "duration": 1702
    },
    {
      "name": "集成测试",
      "status": "failed",
      "duration": 1494
    }
  ],
  "issues": [
    {
      "module": "00-环境检查",
      "severity": "high",
      "error": "Command failed: npm run db:validate\nD:\\wwwroot\\zhongdao-mall\\src\\scripts\\test-data-manager.ts:173\r\n    const userHierarchy = await prisma.users.groupBy({\r\n                                               ^\r\n\r\nTypeError: Cannot read properties of undefined (reading 'groupBy')\r\n    at TestDataManager.validateData (D:\\wwwroot\\zhongdao-mall\\src\\scripts\\test-data-manager.ts:173:48)\r\n    at async Command.<anonymous> (D:\\wwwroot\\zhongdao-mall\\src\\scripts\\test-data-manager.ts:552:21)\r\n\r\nNode.js v22.21.1\r\n",
      "suggestedFix": "查看详细错误日志，联系相关开发人员"
    },
    {
      "module": "用户认证系统 - auth.test.ts",
      "severity": "high",
      "error": "Command failed: npm test tests/api/auth.test.ts\n\u001b[90mstderr\u001b[2m | api/auth.test.ts\u001b[2m > \u001b[22m\u001b[2m认证API测试\u001b[2m > \u001b[22m\u001b[2mPOST /auth/refresh\u001b[2m > \u001b[22m\u001b[2m应该能够刷新访问令牌\n\u001b[22m\u001b[39m跳过token刷新测试 - 缺少refreshToken\n\n\u001b[90mstderr\u001b[2m | api/auth.test.ts\u001b[2m > \u001b[22m\u001b[2m认证API测试\u001b[2m > \u001b[22m\u001b[2mPOST /auth/logout\u001b[2m > \u001b[22m\u001b[2m应该能够成功登出\n\u001b[22m\u001b[39m跳过登出测试 - 缺少authToken\n\n\u001b[90mstderr\u001b[2m | api/auth.test.ts\u001b[2m > \u001b[22m\u001b[2m认证API测试\u001b[2m > \u001b[22m\u001b[2mGET /auth/me\u001b[2m > \u001b[22m\u001b[2m应该能够获取当前用户信息\n\u001b[22m\u001b[39m跳过用户信息测试 - 缺少authToken\n\n\n\u001b[31m⎯⎯⎯⎯⎯⎯⎯\u001b[39m\u001b[1m\u001b[41m Failed Tests 5 \u001b[49m\u001b[22m\u001b[31m⎯⎯⎯⎯⎯⎯⎯\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/auth.test.ts\u001b[2m > \u001b[22m认证API测试\u001b[2m > \u001b[22mPOST /auth/wechat-login\u001b[2m > \u001b[22m应该能够使用微信登录码登录\n\u001b[31m\u001b[1mAssertionError\u001b[22m: expected { …(2) } to have property \"token\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/auth.test.ts:\u001b[2m39:34\u001b[22m\u001b[39m\n    \u001b[90m 37| \u001b[39m\n    \u001b[90m 38| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m 39| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mdata)\u001b[33m.\u001b[39m\u001b[34mtoHaveProperty\u001b[39m(\u001b[32m'token'\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m                                 \u001b[31m^\u001b[39m\n    \u001b[90m 40| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mdata)\u001b[33m.\u001b[39m\u001b[34mtoHaveProperty\u001b[39m(\u001b[32m'refreshToken'\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m 41| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mdata)\u001b[33m.\u001b[39m\u001b[34mtoHaveProperty\u001b[39m(\u001b[32m'user'\u001b[39m)\u001b[33m;\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/5]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/auth.test.ts\u001b[2m > \u001b[22m认证API测试\u001b[2m > \u001b[22mPOST /auth/wechat-login\u001b[2m > \u001b[22m应该拒绝无效的登录码\n\u001b[31m\u001b[1mError\u001b[22m: expected 400 \"Bad Request\", got 200 \"OK\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/auth.test.ts:\u001b[2m58:10\u001b[22m\u001b[39m\n    \u001b[90m 56| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mpost\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/auth/wechat-login`\u001b[39m)\n    \u001b[90m 57| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(loginData)\n    \u001b[90m 58| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m400\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m 59| \u001b[39m\n    \u001b[90m 60| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/5]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/auth.test.ts\u001b[2m > \u001b[22m认证API测试\u001b[2m > \u001b[22mPOST /auth/wechat-login\u001b[2m > \u001b[22m应该拒绝缺少必要参数的登录请求\n\u001b[31m\u001b[1mError\u001b[22m: expected 400 \"Bad Request\", got 200 \"OK\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/auth.test.ts:\u001b[2m68:10\u001b[22m\u001b[39m\n    \u001b[90m 66| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mpost\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/auth/wechat-login`\u001b[39m)\n    \u001b[90m 67| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m({})\n    \u001b[90m 68| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m400\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m 69| \u001b[39m\n    \u001b[90m 70| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/5]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/auth.test.ts\u001b[2m > \u001b[22m认证API测试\u001b[2m > \u001b[22mPOST /auth/refresh\u001b[2m > \u001b[22m应该拒绝无效的refreshToken\n\u001b[31m\u001b[1mError\u001b[22m: expected 401 \"Unauthorized\", got 200 \"OK\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/auth.test.ts:\u001b[2m99:10\u001b[22m\u001b[39m\n    \u001b[90m 97| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mpost\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/auth/refresh`\u001b[39m)\n    \u001b[90m 98| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m({ refreshToken\u001b[33m:\u001b[39m \u001b[32m'invalid_refresh_token'\u001b[39m })\n    \u001b[90m 99| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m401\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m100| \u001b[39m\n    \u001b[90m101| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/5]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/auth.test.ts\u001b[2m > \u001b[22m认证API测试\u001b[2m > \u001b[22mPOST /auth/logout\u001b[2m > \u001b[22m应该拒绝未授权的登出请求\n\u001b[31m\u001b[1mError\u001b[22m: expected 401 \"Unauthorized\", got 415 \"Unsupported Media Type\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/auth.test.ts:\u001b[2m124:10\u001b[22m\u001b[39m\n    \u001b[90m122| \u001b[39m      \u001b[35mconst\u001b[39m response \u001b[33m=\u001b[39m \u001b[35mawait\u001b[39m \u001b[34mrequest\u001b[39m(app)\n    \u001b[90m123| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mpost\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/auth/logout`\u001b[39m)\n    \u001b[90m124| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m401\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m125| \u001b[39m\n    \u001b[90m126| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/5]⎯\u001b[22m\u001b[39m\n\n",
      "suggestedFix": "查看详细错误日志，联系相关开发人员"
    },
    {
      "module": "用户管理系统 - users.test.ts",
      "severity": "high",
      "error": "Command failed: npm test tests/api/users.test.ts\n\n\u001b[31m⎯⎯⎯⎯⎯⎯\u001b[39m\u001b[1m\u001b[41m Failed Tests 30 \u001b[49m\u001b[22m\u001b[31m⎯⎯⎯⎯⎯⎯⎯\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mGET /users/profile\u001b[2m > \u001b[22m普通用户应该能够获取个人信息\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m105:10\u001b[22m\u001b[39m\n    \u001b[90m103| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/users/profile`\u001b[39m)\n    \u001b[90m104| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mnormalUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m105| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m106| \u001b[39m\n    \u001b[90m107| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mGET /users/profile\u001b[2m > \u001b[22mVIP用户应该显示VIP等级标识\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m118:10\u001b[22m\u001b[39m\n    \u001b[90m116| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/users/profile`\u001b[39m)\n    \u001b[90m117| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mvipUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m118| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m119| \u001b[39m\n    \u001b[90m120| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mGET /users/profile\u001b[2m > \u001b[22m星店长应该显示店铺管理权限\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m128:10\u001b[22m\u001b[39m\n    \u001b[90m126| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/users/profile`\u001b[39m)\n    \u001b[90m127| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mstarUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m128| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m129| \u001b[39m\n    \u001b[90m130| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mGET /users/profile\u001b[2m > \u001b[22m管理员应该显示管理员标识\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m138:10\u001b[22m\u001b[39m\n    \u001b[90m136| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/users/profile`\u001b[39m)\n    \u001b[90m137| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39madminToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m138| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m139| \u001b[39m\n    \u001b[90m140| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mPUT /users/profile\u001b[2m > \u001b[22m应该能够更新用户基本信息\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m167:10\u001b[22m\u001b[39m\n    \u001b[90m165| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mnormalUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m166| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(updateData)\n    \u001b[90m167| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m168| \u001b[39m\n    \u001b[90m169| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mGET /users/:id\u001b[2m > \u001b[22m管理员应该能够查看任意用户信息\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m224:10\u001b[22m\u001b[39m\n    \u001b[90m222| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/users/\u001b[39m\u001b[36m${\u001b[39mtestUserId\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m223| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39madminToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m224| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m225| \u001b[39m\n    \u001b[90m226| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mGET /users/:id\u001b[2m > \u001b[22m用户应该能够查看自己的信息\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m238:10\u001b[22m\u001b[39m\n    \u001b[90m236| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/users/\u001b[39m\u001b[36m${\u001b[39mcurrentUserId\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m237| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mnormalUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m238| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m239| \u001b[39m\n    \u001b[90m240| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mGET /users/:id\u001b[2m > \u001b[22m不存在的用户ID应返回404\n\u001b[31m\u001b[1mError\u001b[22m: expected 404 \"Not Found\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m264:10\u001b[22m\u001b[39m\n    \u001b[90m262| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/users/\u001b[39m\u001b[36m${\u001b[39mfakeId\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m263| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39madminToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m264| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m404\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m265| \u001b[39m\n    \u001b[90m266| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[8/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mGET /users/team\u001b[2m > \u001b[22m星店长应该能够查看自己的团队\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m275:10\u001b[22m\u001b[39m\n    \u001b[90m273| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/users/team`\u001b[39m)\n    \u001b[90m274| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mstarUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m275| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m276| \u001b[39m\n    \u001b[90m277| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[9/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mGET /users/team\u001b[2m > \u001b[22m管理员应该能够查看所有团队\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m287:10\u001b[22m\u001b[39m\n    \u001b[90m285| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/users/team`\u001b[39m)\n    \u001b[90m286| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39madminToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m287| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m288| \u001b[39m\n    \u001b[90m289| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[10/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mGET /users/team\u001b[2m > \u001b[22m团队数据应包含层级关系\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m306:10\u001b[22m\u001b[39m\n    \u001b[90m304| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/users/team`\u001b[39m)\n    \u001b[90m305| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mstarUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m306| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m307| \u001b[39m\n    \u001b[90m308| \u001b[39m      if (response.body.data.members && response.body.data.members.len…\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[11/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mGET /users/statistics\u001b[2m > \u001b[22m用户应该能够查看个人统计\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m321:10\u001b[22m\u001b[39m\n    \u001b[90m319| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/users/statistics`\u001b[39m)\n    \u001b[90m320| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mnormalUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m321| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m322| \u001b[39m\n    \u001b[90m323| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[12/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mGET /users/statistics\u001b[2m > \u001b[22m星店长应该有团队业绩统计\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m333:10\u001b[22m\u001b[39m\n    \u001b[90m331| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/users/statistics`\u001b[39m)\n    \u001b[90m332| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mstarUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m333| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m334| \u001b[39m\n    \u001b[90m335| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[13/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mGET /users/statistics\u001b[2m > \u001b[22m管理员应该有全局统计\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m344:10\u001b[22m\u001b[39m\n    \u001b[90m342| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/users/statistics`\u001b[39m)\n    \u001b[90m343| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39madminToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m344| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m345| \u001b[39m\n    \u001b[90m346| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[14/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mPOST /users/upload-avatar\u001b[2m > \u001b[22m应该能够上传头像\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mPOST /users/upload-avatar\u001b[2m > \u001b[22m应该验证文件类型\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mPOST /users/upload-avatar\u001b[2m > \u001b[22m未认证用户不能上传头像\n\u001b[31m\u001b[1mError\u001b[22m: Aborted\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.<anonymous> ../node_modules/superagent/lib/request-base.js:\u001b[2m258:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.RequestBase.abort ../node_modules/superagent/lib/request-base.js:\u001b[2m447:8\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m FormData.<anonymous> ../node_modules/superagent/lib/node/index.js:\u001b[2m286:12\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m FormData.CombinedStream._emitError ../node_modules/combined-stream/lib/combined_stream.js:\u001b[2m207:8\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m DelayedStream.<anonymous> ../node_modules/combined-stream/lib/combined_stream.js:\u001b[2m133:10\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m DelayedStream._handleEmit ../node_modules/delayed-stream/lib/delayed_stream.js:\u001b[2m82:15\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ReadStream.source.emit ../node_modules/delayed-stream/lib/delayed_stream.js:\u001b[2m29:19\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[15/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mPOST /users/bind-phone\u001b[2m > \u001b[22m应该能够绑定手机号\n\u001b[31m\u001b[1mError\u001b[22m: Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m397:5\u001b[22m\u001b[39m\n    \u001b[90m395| \u001b[39m\n    \u001b[90m396| \u001b[39m  \u001b[34mdescribe\u001b[39m(\u001b[32m'POST /users/bind-phone'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m397| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该能够绑定手机号'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m   | \u001b[39m    \u001b[31m^\u001b[39m\n    \u001b[90m398| \u001b[39m      \u001b[35mconst\u001b[39m phoneData \u001b[33m=\u001b[39m {\n    \u001b[90m399| \u001b[39m        phone\u001b[33m:\u001b[39m \u001b[32m'13800138002'\u001b[39m\u001b[33m,\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[16/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mPOST /users/bind-phone\u001b[2m > \u001b[22m应该验证验证码\n\u001b[31m\u001b[1mError\u001b[22m: Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m412:5\u001b[22m\u001b[39m\n    \u001b[90m410| \u001b[39m    })\u001b[33m;\u001b[39m\n    \u001b[90m411| \u001b[39m\n    \u001b[90m412| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该验证验证码'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m   | \u001b[39m    \u001b[31m^\u001b[39m\n    \u001b[90m413| \u001b[39m      \u001b[35mconst\u001b[39m phoneData \u001b[33m=\u001b[39m {\n    \u001b[90m414| \u001b[39m        phone\u001b[33m:\u001b[39m \u001b[32m'13800138003'\u001b[39m\u001b[33m,\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[17/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mPOST /users/bind-phone\u001b[2m > \u001b[22m重复绑定应该返回错误\n\u001b[31m\u001b[1mError\u001b[22m: Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m428:5\u001b[22m\u001b[39m\n    \u001b[90m426| \u001b[39m    })\u001b[33m;\u001b[39m\n    \u001b[90m427| \u001b[39m\n    \u001b[90m428| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'重复绑定应该返回错误'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m   | \u001b[39m    \u001b[31m^\u001b[39m\n    \u001b[90m429| \u001b[39m      \u001b[90m// 先绑定一次\u001b[39m\n    \u001b[90m430| \u001b[39m      \u001b[35mconst\u001b[39m phoneData \u001b[33m=\u001b[39m {\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[18/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mGET /users/referrals\u001b[2m > \u001b[22m用户应该查看自己的推荐记录\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m457:10\u001b[22m\u001b[39m\n    \u001b[90m455| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/users/referrals`\u001b[39m)\n    \u001b[90m456| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mnormalUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m457| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m458| \u001b[39m\n    \u001b[90m459| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[19/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mGET /users/referrals\u001b[2m > \u001b[22m管理员应该查看所有推荐记录\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m468:10\u001b[22m\u001b[39m\n    \u001b[90m466| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/users/referrals`\u001b[39m)\n    \u001b[90m467| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39madminToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m468| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m469| \u001b[39m\n    \u001b[90m470| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[20/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mGET /users/notifications\u001b[2m > \u001b[22m用户应该能够获取通知列表\n\u001b[31m\u001b[1mError\u001b[22m: Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m476:5\u001b[22m\u001b[39m\n    \u001b[90m474| \u001b[39m\n    \u001b[90m475| \u001b[39m  \u001b[34mdescribe\u001b[39m(\u001b[32m'GET /users/notifications'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m476| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'用户应该能够获取通知列表'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m   | \u001b[39m    \u001b[31m^\u001b[39m\n    \u001b[90m477| \u001b[39m      \u001b[35mconst\u001b[39m response \u001b[33m=\u001b[39m \u001b[35mawait\u001b[39m \u001b[34mrequest\u001b[39m(app)\n    \u001b[90m478| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/users/notifications`\u001b[39m)\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[21/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mGET /users/notifications\u001b[2m > \u001b[22m应该支持按已读状态筛选\n\u001b[31m\u001b[1mError\u001b[22m: Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m489:5\u001b[22m\u001b[39m\n    \u001b[90m487| \u001b[39m    })\u001b[33m;\u001b[39m\n    \u001b[90m488| \u001b[39m\n    \u001b[90m489| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该支持按已读状态筛选'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m   | \u001b[39m    \u001b[31m^\u001b[39m\n    \u001b[90m490| \u001b[39m      \u001b[35mconst\u001b[39m response \u001b[33m=\u001b[39m \u001b[35mawait\u001b[39m \u001b[34mrequest\u001b[39m(app)\n    \u001b[90m491| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/users/notifications`\u001b[39m)\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[22/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mGET /users/notifications\u001b[2m > \u001b[22m应该支持按通知类型筛选\n\u001b[31m\u001b[1mError\u001b[22m: Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m499:5\u001b[22m\u001b[39m\n    \u001b[90m497| \u001b[39m    })\u001b[33m;\u001b[39m\n    \u001b[90m498| \u001b[39m\n    \u001b[90m499| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该支持按通知类型筛选'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m   | \u001b[39m    \u001b[31m^\u001b[39m\n    \u001b[90m500| \u001b[39m      \u001b[35mconst\u001b[39m response \u001b[33m=\u001b[39m \u001b[35mawait\u001b[39m \u001b[34mrequest\u001b[39m(app)\n    \u001b[90m501| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/users/notifications`\u001b[39m)\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[23/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mPUT /users/notifications/:id/read\u001b[2m > \u001b[22m应该能够标记通知为已读\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m547:10\u001b[22m\u001b[39m\n    \u001b[90m545| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Content-Type'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'application/json'\u001b[39m)\n    \u001b[90m546| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m({})\n    \u001b[90m547| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m548| \u001b[39m\n    \u001b[90m549| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[24/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mPUT /users/notifications/:id/read\u001b[2m > \u001b[22m不存在的通知ID应返回404\n\u001b[31m\u001b[1mError\u001b[22m: expected 404 \"Not Found\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m560:10\u001b[22m\u001b[39m\n    \u001b[90m558| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Content-Type'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'application/json'\u001b[39m)\n    \u001b[90m559| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m({})\n    \u001b[90m560| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m404\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m561| \u001b[39m\n    \u001b[90m562| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[25/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mPOST /users/verify-kyc\u001b[2m > \u001b[22m应该能够提交KYC申请\n\u001b[31m\u001b[1mError\u001b[22m: Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m567:5\u001b[22m\u001b[39m\n    \u001b[90m565| \u001b[39m\n    \u001b[90m566| \u001b[39m  \u001b[34mdescribe\u001b[39m(\u001b[32m'POST /users/verify-kyc'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m567| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该能够提交KYC申请'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m   | \u001b[39m    \u001b[31m^\u001b[39m\n    \u001b[90m568| \u001b[39m      \u001b[35mconst\u001b[39m kycData \u001b[33m=\u001b[39m {\n    \u001b[90m569| \u001b[39m        realName\u001b[33m:\u001b[39m \u001b[32m'测试用户'\u001b[39m\u001b[33m,\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[26/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mPOST /users/verify-kyc\u001b[2m > \u001b[22m应该验证必填字段\n\u001b[31m\u001b[1mError\u001b[22m: Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m586:5\u001b[22m\u001b[39m\n    \u001b[90m584| \u001b[39m    })\u001b[33m;\u001b[39m\n    \u001b[90m585| \u001b[39m\n    \u001b[90m586| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该验证必填字段'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m   | \u001b[39m    \u001b[31m^\u001b[39m\n    \u001b[90m587| \u001b[39m      \u001b[35mconst\u001b[39m kycData \u001b[33m=\u001b[39m {\n    \u001b[90m588| \u001b[39m        realName\u001b[33m:\u001b[39m \u001b[32m''\u001b[39m\u001b[33m,\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[27/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/users.test.ts\u001b[2m > \u001b[22m用户管理API测试\u001b[2m > \u001b[22mPOST /users/verify-kyc\u001b[2m > \u001b[22m已通过KYC的用户不能重复申请\n\u001b[31m\u001b[1mError\u001b[22m: Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/users.test.ts:\u001b[2m604:5\u001b[22m\u001b[39m\n    \u001b[90m602| \u001b[39m    })\u001b[33m;\u001b[39m\n    \u001b[90m603| \u001b[39m\n    \u001b[90m604| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'已通过KYC的用户不能重复申请'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m   | \u001b[39m    \u001b[31m^\u001b[39m\n    \u001b[90m605| \u001b[39m      \u001b[90m// 先通过KYC\u001b[39m\n    \u001b[90m606| \u001b[39m      \u001b[35mconst\u001b[39m kycData \u001b[33m=\u001b[39m {\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[28/30]⎯\u001b[22m\u001b[39m\n\n",
      "suggestedFix": "查看详细错误日志，联系相关开发人员"
    },
    {
      "module": "商城管理系统 - shops.test.ts",
      "severity": "high",
      "error": "Command failed: npm test tests/api/shops.test.ts\n\n\u001b[31m⎯⎯⎯⎯⎯⎯\u001b[39m\u001b[1m\u001b[41m Failed Tests 14 \u001b[49m\u001b[22m\u001b[31m⎯⎯⎯⎯⎯⎯⎯\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mPOST /shops\u001b[2m > \u001b[22mVIP用户应该能够创建云店\n\u001b[31m\u001b[1mError\u001b[22m: expected 201 \"Created\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m81:10\u001b[22m\u001b[39m\n    \u001b[90m 79| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mvipUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m 80| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(shopData)\n    \u001b[90m 81| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m201\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m 82| \u001b[39m\n    \u001b[90m 83| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mPOST /shops\u001b[2m > \u001b[22m普通用户不能创建云店\n\u001b[31m\u001b[1mError\u001b[22m: expected 403 \"Forbidden\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m101:10\u001b[22m\u001b[39m\n    \u001b[90m 99| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mnormalUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m100| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(shopData)\n    \u001b[90m101| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m403\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m102| \u001b[39m\n    \u001b[90m103| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mPOST /shops\u001b[2m > \u001b[22m二星店长应该能够创建五通店\n\u001b[31m\u001b[1mError\u001b[22m: expected 201 \"Created\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m122:10\u001b[22m\u001b[39m\n    \u001b[90m120| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mstar2User\u001b[33m.\u001b[39mtokens\u001b[33m.\u001b[39maccessToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m121| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(shopData)\n    \u001b[90m122| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m201\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m123| \u001b[39m\n    \u001b[90m124| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mGET /shops\u001b[2m > \u001b[22m应该能够获取店铺列表\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m146:10\u001b[22m\u001b[39m\n    \u001b[90m144| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mvipUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m145| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mquery\u001b[39m({ page\u001b[33m:\u001b[39m \u001b[34m1\u001b[39m\u001b[33m,\u001b[39m perPage\u001b[33m:\u001b[39m \u001b[34m10\u001b[39m })\n    \u001b[90m146| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m147| \u001b[39m\n    \u001b[90m148| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mGET /shops\u001b[2m > \u001b[22m应该支持按店铺类型筛选\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m163:10\u001b[22m\u001b[39m\n    \u001b[90m161| \u001b[39m          shopType\u001b[33m:\u001b[39m \u001b[32m'CLOUD'\u001b[39m\n    \u001b[90m162| \u001b[39m        })\n    \u001b[90m163| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m164| \u001b[39m\n    \u001b[90m165| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mGET /shops\u001b[2m > \u001b[22m应该支持按状态筛选\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m182:10\u001b[22m\u001b[39m\n    \u001b[90m180| \u001b[39m          status\u001b[33m:\u001b[39m \u001b[32m'ACTIVE'\u001b[39m\n    \u001b[90m181| \u001b[39m        })\n    \u001b[90m182| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m183| \u001b[39m\n    \u001b[90m184| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mGET /shops\u001b[2m > \u001b[22m应该支持搜索店铺名称\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m196:10\u001b[22m\u001b[39m\n    \u001b[90m194| \u001b[39m          search\u001b[33m:\u001b[39m \u001b[32m'测试'\u001b[39m\n    \u001b[90m195| \u001b[39m        })\n    \u001b[90m196| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m197| \u001b[39m\n    \u001b[90m198| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mGET /shops/:id\u001b[2m > \u001b[22m不存在的店铺ID应返回404\n\u001b[31m\u001b[1mError\u001b[22m: expected 404 \"Not Found\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m224:10\u001b[22m\u001b[39m\n    \u001b[90m222| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/shops/\u001b[39m\u001b[36m${\u001b[39mfakeId\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m223| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mvipUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m224| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m404\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m225| \u001b[39m\n    \u001b[90m226| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[8/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mPOST /shops/:id/upgrade\u001b[2m > \u001b[22m应该能够申请店铺升级\n\u001b[31m\u001b[1mTypeError\u001b[22m: Cannot read properties of undefined (reading 'id')\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m297:45\u001b[22m\u001b[39m\n    \u001b[90m295| \u001b[39m        })\u001b[33m;\u001b[39m\n    \u001b[90m296| \u001b[39m\n    \u001b[90m297| \u001b[39m      \u001b[35mconst\u001b[39m shopId \u001b[33m=\u001b[39m shopResponse\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mdata\u001b[33m.\u001b[39mid\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m                                            \u001b[31m^\u001b[39m\n    \u001b[90m298| \u001b[39m\n    \u001b[90m299| \u001b[39m      \u001b[35mconst\u001b[39m upgradeData \u001b[33m=\u001b[39m {\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[9/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mPOST /shops/:id/upgrade\u001b[2m > \u001b[22m应该验证升级条件\n\u001b[31m\u001b[1mError\u001b[22m: expected 400 \"Bad Request\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m325:10\u001b[22m\u001b[39m\n    \u001b[90m323| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mvipUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m324| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(upgradeData)\n    \u001b[90m325| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m400\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m326| \u001b[39m\n    \u001b[90m327| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[10/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mPOST /shops/wutong/claim-gift\u001b[2m > \u001b[22m五通店用户应该能够申请赠品\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m418:10\u001b[22m\u001b[39m\n    \u001b[90m416| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mstar2User\u001b[33m.\u001b[39mtokens\u001b[33m.\u001b[39maccessToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m417| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(orderData)\n    \u001b[90m418| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m419| \u001b[39m\n    \u001b[90m420| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[11/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mPOST /shops/wutong/claim-gift\u001b[2m > \u001b[22m应该验证赠品申请条件\n\u001b[31m\u001b[1mError\u001b[22m: expected 403 \"Forbidden\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m434:10\u001b[22m\u001b[39m\n    \u001b[90m432| \u001b[39m          ]\n    \u001b[90m433| \u001b[39m        })\n    \u001b[90m434| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m403\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m435| \u001b[39m\n    \u001b[90m436| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[12/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mGET /shops/my\u001b[2m > \u001b[22m用户应该能够查看自己的店铺\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m504:10\u001b[22m\u001b[39m\n    \u001b[90m502| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/shops/my`\u001b[39m)\n    \u001b[90m503| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mvipUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m504| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m505| \u001b[39m\n    \u001b[90m506| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[13/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mGET /shops/my\u001b[2m > \u001b[22m没有店铺的用户应该返回空列表\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m517:10\u001b[22m\u001b[39m\n    \u001b[90m515| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/shops/my`\u001b[39m)\n    \u001b[90m516| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mnewUser\u001b[33m.\u001b[39mtokens\u001b[33m.\u001b[39maccessToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m517| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m518| \u001b[39m\n    \u001b[90m519| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[14/14]⎯\u001b[22m\u001b[39m\n\n",
      "suggestedFix": "查看详细错误日志，联系相关开发人员"
    },
    {
      "module": "商品管理系统 - products.test.ts",
      "severity": "high",
      "error": "Command failed: npm test tests/api/products.test.ts\n\n\u001b[31m⎯⎯⎯⎯⎯⎯⎯\u001b[39m\u001b[1m\u001b[41m Failed Tests 9 \u001b[49m\u001b[22m\u001b[31m⎯⎯⎯⎯⎯⎯⎯\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/products.test.ts\u001b[2m > \u001b[22m商品管理API测试 - 简化版\u001b[2m > \u001b[22m商品分类API\u001b[2m > \u001b[22m应该能够获取商品分类树\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/products.test.ts:\u001b[2m35:10\u001b[22m\u001b[39m\n    \u001b[90m 33| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/products/categories/tree`\u001b[39m)\n    \u001b[90m 34| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mnormalUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m 35| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m 36| \u001b[39m\n    \u001b[90m 37| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/9]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/products.test.ts\u001b[2m > \u001b[22m商品管理API测试 - 简化版\u001b[2m > \u001b[22m商品分类API\u001b[2m > \u001b[22m应该能够获取商品分类列表\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/products.test.ts:\u001b[2m47:10\u001b[22m\u001b[39m\n    \u001b[90m 45| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mnormalUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m 46| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mquery\u001b[39m({ page\u001b[33m:\u001b[39m \u001b[34m1\u001b[39m\u001b[33m,\u001b[39m perPage\u001b[33m:\u001b[39m \u001b[34m10\u001b[39m })\n    \u001b[90m 47| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m 48| \u001b[39m\n    \u001b[90m 49| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/9]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/products.test.ts\u001b[2m > \u001b[22m商品管理API测试 - 简化版\u001b[2m > \u001b[22m商品分类API\u001b[2m > \u001b[22m应该能够按级别筛选商品分类\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/products.test.ts:\u001b[2m56:10\u001b[22m\u001b[39m\n    \u001b[90m 54| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该能够按级别筛选商品分类'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m 55| \u001b[39m      const response = await makeAuthenticatedRequest('GET', `${API_BA…\n    \u001b[90m 56| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m 57| \u001b[39m\n    \u001b[90m 58| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/9]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/products.test.ts\u001b[2m > \u001b[22m商品管理API测试 - 简化版\u001b[2m > \u001b[22m商品标签API\u001b[2m > \u001b[22m应该能够获取商品标签列表\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/products.test.ts:\u001b[2m66:10\u001b[22m\u001b[39m\n    \u001b[90m 64| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该能够获取商品标签列表'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m 65| \u001b[39m      const response = await makeAuthenticatedRequest('GET', `${API_BA…\n    \u001b[90m 66| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m 67| \u001b[39m\n    \u001b[90m 68| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/9]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/products.test.ts\u001b[2m > \u001b[22m商品管理API测试 - 简化版\u001b[2m > \u001b[22m商品标签API\u001b[2m > \u001b[22m应该能够获取所有商品标签\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/products.test.ts:\u001b[2m75:10\u001b[22m\u001b[39m\n    \u001b[90m 73| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该能够获取所有商品标签'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m 74| \u001b[39m      const response = await makeAuthenticatedRequest('GET', `${API_BA…\n    \u001b[90m 75| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m 76| \u001b[39m\n    \u001b[90m 77| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/9]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/products.test.ts\u001b[2m > \u001b[22m商品管理API测试 - 简化版\u001b[2m > \u001b[22m商品标签API\u001b[2m > \u001b[22m应该能够创建新的商品标签\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/products.test.ts:\u001b[2m90:10\u001b[22m\u001b[39m\n    \u001b[90m 88| \u001b[39m      const response = await makeAdminRequest('POST', `${API_BASE}/pro…\n    \u001b[90m 89| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(tagData)\n    \u001b[90m 90| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m 91| \u001b[39m\n    \u001b[90m 92| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/9]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/products.test.ts\u001b[2m > \u001b[22m商品管理API测试 - 简化版\u001b[2m > \u001b[22m商品列表API\u001b[2m > \u001b[22m应该能够获取商品列表\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/products.test.ts:\u001b[2m100:10\u001b[22m\u001b[39m\n    \u001b[90m 98| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该能够获取商品列表'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m 99| \u001b[39m      const response = await makeAuthenticatedRequest('GET', `${API_BA…\n    \u001b[90m100| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m101| \u001b[39m\n    \u001b[90m102| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/9]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/products.test.ts\u001b[2m > \u001b[22m商品管理API测试 - 简化版\u001b[2m > \u001b[22m商品列表API\u001b[2m > \u001b[22m应该能够按状态筛选商品\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/products.test.ts:\u001b[2m109:10\u001b[22m\u001b[39m\n    \u001b[90m107| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该能够按状态筛选商品'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m108| \u001b[39m      const response = await makeAuthenticatedRequest('GET', `${API_BA…\n    \u001b[90m109| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m110| \u001b[39m\n    \u001b[90m111| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[8/9]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/products.test.ts\u001b[2m > \u001b[22m商品管理API测试 - 简化版\u001b[2m > \u001b[22m商品规格API\u001b[2m > \u001b[22m应该能够获取商品规格列表\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/products.test.ts:\u001b[2m118:10\u001b[22m\u001b[39m\n    \u001b[90m116| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该能够获取商品规格列表'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m117| \u001b[39m      const response = await makeAuthenticatedRequest('GET', `${API_BA…\n    \u001b[90m118| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m119| \u001b[39m\n    \u001b[90m120| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[9/9]⎯\u001b[22m\u001b[39m\n\n",
      "suggestedFix": "查看详细错误日志，联系相关开发人员"
    },
    {
      "module": "订单管理系统 - orders.test.ts",
      "severity": "high",
      "error": "Command failed: npm test tests/api/orders.test.ts\n\n\u001b[31m⎯⎯⎯⎯⎯⎯\u001b[39m\u001b[1m\u001b[41m Failed Tests 20 \u001b[49m\u001b[22m\u001b[31m⎯⎯⎯⎯⎯⎯⎯\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/orders.test.ts\u001b[2m > \u001b[22m订单管理API测试\u001b[2m > \u001b[22mGET /orders\u001b[2m > \u001b[22m应该能够获取订单模块信息\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/orders.test.ts:\u001b[2m31:10\u001b[22m\u001b[39m\n    \u001b[90m 29| \u001b[39m      \u001b[35mconst\u001b[39m response \u001b[33m=\u001b[39m \u001b[35mawait\u001b[39m \u001b[34mrequest\u001b[39m(app)\n    \u001b[90m 30| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/orders`\u001b[39m)\n    \u001b[90m 31| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m 32| \u001b[39m\n    \u001b[90m 33| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/20]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/orders.test.ts\u001b[2m > \u001b[22m订单管理API测试\u001b[2m > \u001b[22mGET /orders\u001b[2m > \u001b[22m应该能够获取订单列表\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/orders.test.ts:\u001b[2m46:10\u001b[22m\u001b[39m\n    \u001b[90m 44| \u001b[39m          perPage\u001b[33m:\u001b[39m \u001b[34m10\u001b[39m\n    \u001b[90m 45| \u001b[39m        })\n    \u001b[90m 46| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m 47| \u001b[39m\n    \u001b[90m 48| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/20]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/orders.test.ts\u001b[2m > \u001b[22m订单管理API测试\u001b[2m > \u001b[22mGET /orders\u001b[2m > \u001b[22m应该能够按状态筛选订单\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/orders.test.ts:\u001b[2m65:10\u001b[22m\u001b[39m\n    \u001b[90m 63| \u001b[39m          status\u001b[33m:\u001b[39m \u001b[32m'PENDING'\u001b[39m\n    \u001b[90m 64| \u001b[39m        })\n    \u001b[90m 65| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m 66| \u001b[39m\n    \u001b[90m 67| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/20]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/orders.test.ts\u001b[2m > \u001b[22m订单管理API测试\u001b[2m > \u001b[22mGET /orders\u001b[2m > \u001b[22m应该能够按支付状态筛选订单\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/orders.test.ts:\u001b[2m84:10\u001b[22m\u001b[39m\n    \u001b[90m 82| \u001b[39m          paymentStatus\u001b[33m:\u001b[39m \u001b[32m'UNPAID'\u001b[39m\n    \u001b[90m 83| \u001b[39m        })\n    \u001b[90m 84| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m 85| \u001b[39m\n    \u001b[90m 86| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/20]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/orders.test.ts\u001b[2m > \u001b[22m订单管理API测试\u001b[2m > \u001b[22mGET /orders\u001b[2m > \u001b[22m应该能够按时间范围筛选订单\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/orders.test.ts:\u001b[2m103:10\u001b[22m\u001b[39m\n    \u001b[90m101| \u001b[39m          endDate\u001b[33m:\u001b[39m endDate\u001b[33m.\u001b[39m\u001b[34mtoISOString\u001b[39m()\n    \u001b[90m102| \u001b[39m        })\n    \u001b[90m103| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m104| \u001b[39m\n    \u001b[90m105| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/20]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/orders.test.ts\u001b[2m > \u001b[22m订单管理API测试\u001b[2m > \u001b[22mPOST /orders\u001b[2m > \u001b[22m应该能够创建新订单\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/orders.test.ts:\u001b[2m128:10\u001b[22m\u001b[39m\n    \u001b[90m126| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39muserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m127| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(orderData)\n    \u001b[90m128| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m129| \u001b[39m\n    \u001b[90m130| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/20]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/orders.test.ts\u001b[2m > \u001b[22m订单管理API测试\u001b[2m > \u001b[22mPOST /orders\u001b[2m > \u001b[22m应该拒绝空的订单项\n\u001b[31m\u001b[1mError\u001b[22m: expected 400 \"Bad Request\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/orders.test.ts:\u001b[2m152:10\u001b[22m\u001b[39m\n    \u001b[90m150| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39muserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m151| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(orderData)\n    \u001b[90m152| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m400\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m153| \u001b[39m\n    \u001b[90m154| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/20]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/orders.test.ts\u001b[2m > \u001b[22m订单管理API测试\u001b[2m > \u001b[22mPOST /orders\u001b[2m > \u001b[22m应该拒绝无效的支付方式\n\u001b[31m\u001b[1mError\u001b[22m: expected 400 \"Bad Request\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/orders.test.ts:\u001b[2m175:10\u001b[22m\u001b[39m\n    \u001b[90m173| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39muserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m174| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(orderData)\n    \u001b[90m175| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m400\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m176| \u001b[39m\n    \u001b[90m177| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[8/20]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/orders.test.ts\u001b[2m > \u001b[22m订单管理API测试\u001b[2m > \u001b[22mPOST /orders\u001b[2m > \u001b[22m应该拒绝数量为0的商品\n\u001b[31m\u001b[1mError\u001b[22m: expected 400 \"Bad Request\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/orders.test.ts:\u001b[2m197:10\u001b[22m\u001b[39m\n    \u001b[90m195| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39muserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m196| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(orderData)\n    \u001b[90m197| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m400\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m198| \u001b[39m\n    \u001b[90m199| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[9/20]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/orders.test.ts\u001b[2m > \u001b[22m订单管理API测试\u001b[2m > \u001b[22mGET /orders/:orderId\u001b[2m > \u001b[22m应该返回404当订单不存在\n\u001b[31m\u001b[1mError\u001b[22m: expected 404 \"Not Found\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/orders.test.ts:\u001b[2m230:10\u001b[22m\u001b[39m\n    \u001b[90m228| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/orders/\u001b[39m\u001b[36m${\u001b[39mfakeOrderId\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m229| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39muserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m230| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m404\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m231| \u001b[39m\n    \u001b[90m232| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[10/20]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/orders.test.ts\u001b[2m > \u001b[22m订单管理API测试\u001b[2m > \u001b[22mPUT /orders/:orderId/confirm\u001b[2m > \u001b[22m应该拒绝确认已取消的订单\n\u001b[31m\u001b[1mError\u001b[22m: expected 400 \"Bad Request\", got 415 \"Unsupported Media Type\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/orders.test.ts:\u001b[2m273:10\u001b[22m\u001b[39m\n    \u001b[90m271| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mput\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/orders/\u001b[39m\u001b[36m${\u001b[39mcancelledOrderId\u001b[36m}\u001b[39m\u001b[32m/confirm`\u001b[39m)\n    \u001b[90m272| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39muserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m273| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m400\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m274| \u001b[39m\n    \u001b[90m275| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[11/20]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/orders.test.ts\u001b[2m > \u001b[22m订单管理API测试\u001b[2m > \u001b[22mPUT /orders/:orderId/cancel\u001b[2m > \u001b[22m应该能够取消订单\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/orders.test.ts:\u001b[2m299:10\u001b[22m\u001b[39m\n    \u001b[90m297| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39muserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m298| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(orderData)\n    \u001b[90m299| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m300| \u001b[39m\n    \u001b[90m301| \u001b[39m      \u001b[35mconst\u001b[39m cancelResponse \u001b[33m=\u001b[39m \u001b[35mawait\u001b[39m \u001b[34mrequest\u001b[39m(app)\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[12/20]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/orders.test.ts\u001b[2m > \u001b[22m订单管理API测试\u001b[2m > \u001b[22mPUT /orders/:orderId/cancel\u001b[2m > \u001b[22m应该拒绝取消已完成的订单\n\u001b[31m\u001b[1mError\u001b[22m: expected 400 \"Bad Request\", got 415 \"Unsupported Media Type\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/orders.test.ts:\u001b[2m316:10\u001b[22m\u001b[39m\n    \u001b[90m314| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mput\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/orders/\u001b[39m\u001b[36m${\u001b[39mcompletedOrderId\u001b[36m}\u001b[39m\u001b[32m/cancel`\u001b[39m)\n    \u001b[90m315| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39muserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m316| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m400\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m317| \u001b[39m\n    \u001b[90m318| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[13/20]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/orders.test.ts\u001b[2m > \u001b[22m订单管理API测试\u001b[2m > \u001b[22mPUT /orders/:orderId/cancel\u001b[2m > \u001b[22m应该提供取消原因\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/orders.test.ts:\u001b[2m339:10\u001b[22m\u001b[39m\n    \u001b[90m337| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39muserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m338| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(orderData)\n    \u001b[90m339| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m340| \u001b[39m\n    \u001b[90m341| \u001b[39m      \u001b[35mconst\u001b[39m cancelResponse \u001b[33m=\u001b[39m \u001b[35mawait\u001b[39m \u001b[34mrequest\u001b[39m(app)\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[14/20]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/orders.test.ts\u001b[2m > \u001b[22m订单管理API测试\u001b[2m > \u001b[22m订单统计API\u001b[2m > \u001b[22m应该能够获取订单统计信息\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/orders.test.ts:\u001b[2m358:10\u001b[22m\u001b[39m\n    \u001b[90m356| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/orders/statistics`\u001b[39m)\n    \u001b[90m357| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39muserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m358| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m359| \u001b[39m\n    \u001b[90m360| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[15/20]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/orders.test.ts\u001b[2m > \u001b[22m订单管理API测试\u001b[2m > \u001b[22m订单统计API\u001b[2m > \u001b[22m应该能够获取订单统计概览\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/orders.test.ts:\u001b[2m374:10\u001b[22m\u001b[39m\n    \u001b[90m372| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/orders/statistics/overview`\u001b[39m)\n    \u001b[90m373| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39muserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m374| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m375| \u001b[39m\n    \u001b[90m376| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[16/20]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/orders.test.ts\u001b[2m > \u001b[22m订单管理API测试\u001b[2m > \u001b[22m订单统计API\u001b[2m > \u001b[22m应该能够按时间范围获取统计\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/orders.test.ts:\u001b[2m391:10\u001b[22m\u001b[39m\n    \u001b[90m389| \u001b[39m          endDate\u001b[33m:\u001b[39m \u001b[35mnew\u001b[39m \u001b[33mDate\u001b[39m()\u001b[33m.\u001b[39m\u001b[34mtoISOString\u001b[39m()\n    \u001b[90m390| \u001b[39m        })\n    \u001b[90m391| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m392| \u001b[39m\n    \u001b[90m393| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[17/20]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/orders.test.ts\u001b[2m > \u001b[22m订单管理API测试\u001b[2m > \u001b[22m换货申请 API\u001b[2m > \u001b[22m应该拒绝无效的换货申请\n\u001b[31m\u001b[1mError\u001b[22m: expected 400 \"Bad Request\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/orders.test.ts:\u001b[2m439:10\u001b[22m\u001b[39m\n    \u001b[90m437| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39muserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m438| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(exchangeData)\n    \u001b[90m439| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m400\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m440| \u001b[39m\n    \u001b[90m441| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[18/20]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/orders.test.ts\u001b[2m > \u001b[22m订单管理API测试\u001b[2m > \u001b[22m订单权限和安全测试\u001b[2m > \u001b[22m应该阻止用户访问其他用户的订单\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/orders.test.ts:\u001b[2m464:10\u001b[22m\u001b[39m\n    \u001b[90m462| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39muserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m463| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(orderData)\n    \u001b[90m464| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m465| \u001b[39m\n    \u001b[90m466| \u001b[39m      \u001b[90m// 使用不同的token尝试访问\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[19/20]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/orders.test.ts\u001b[2m > \u001b[22m订单管理API测试\u001b[2m > \u001b[22m订单权限和安全测试\u001b[2m > \u001b[22m应该验证订单金额的正确性\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 401 \"Unauthorized\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/orders.test.ts:\u001b[2m500:10\u001b[22m\u001b[39m\n    \u001b[90m498| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39muserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m499| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(orderData)\n    \u001b[90m500| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m501| \u001b[39m\n    \u001b[90m502| \u001b[39m      \u001b[35mconst\u001b[39m expectedTotal \u001b[33m=\u001b[39m (\u001b[34m2\u001b[39m \u001b[33m*\u001b[39m \u001b[34m100.00\u001b[39m) \u001b[33m+\u001b[39m (\u001b[34m3\u001b[39m \u001b[33m*\u001b[39m \u001b[34m50.00\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[20/20]⎯\u001b[22m\u001b[39m\n\n",
      "suggestedFix": "查看详细错误日志，联系相关开发人员"
    },
    {
      "module": "积分系统 - points.test.ts",
      "severity": "high",
      "error": "Command failed: npm test tests/api/points.test.ts\n\n\u001b[31m⎯⎯⎯⎯⎯⎯\u001b[39m\u001b[1m\u001b[41m Failed Tests 18 \u001b[49m\u001b[22m\u001b[31m⎯⎯⎯⎯⎯⎯⎯\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/points.test.ts\u001b[2m > \u001b[22m积分系统API测试\u001b[2m > \u001b[22mGET /points/balance\u001b[2m > \u001b[22m应该能够获取积分余额\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 400 \"Bad Request\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/points.test.ts:\u001b[2m46:10\u001b[22m\u001b[39m\n    \u001b[90m 44| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/points/balance`\u001b[39m)\n    \u001b[90m 45| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39muserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m 46| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m 47| \u001b[39m\n    \u001b[90m 48| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/18]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/points.test.ts\u001b[2m > \u001b[22m积分系统API测试\u001b[2m > \u001b[22mPOST /points/transfer\u001b[2m > \u001b[22m应该能够进行积分转账\n\u001b[31m\u001b[1mError\u001b[22m: Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/points.test.ts:\u001b[2m66:5\u001b[22m\u001b[39m\n    \u001b[90m 64| \u001b[39m\n    \u001b[90m 65| \u001b[39m  \u001b[34mdescribe\u001b[39m(\u001b[32m'POST /points/transfer'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m 66| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该能够进行积分转账'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m   | \u001b[39m    \u001b[31m^\u001b[39m\n    \u001b[90m 67| \u001b[39m      \u001b[35mconst\u001b[39m transferData \u001b[33m=\u001b[39m {\n    \u001b[90m 68| \u001b[39m        toUserId\u001b[33m:\u001b[39m adminUser\u001b[33m.\u001b[39mid\u001b[33m,\u001b[39m \u001b[90m// 使用真实的管理员用户ID\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/18]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/points.test.ts\u001b[2m > \u001b[22m积分系统API测试\u001b[2m > \u001b[22mPOST /points/transfer\u001b[2m > \u001b[22m应该拒绝负金额转账\n\u001b[31m\u001b[1mError\u001b[22m: Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/points.test.ts:\u001b[2m86:5\u001b[22m\u001b[39m\n    \u001b[90m 84| \u001b[39m    })\u001b[33m;\u001b[39m\n    \u001b[90m 85| \u001b[39m\n    \u001b[90m 86| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该拒绝负金额转账'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m   | \u001b[39m    \u001b[31m^\u001b[39m\n    \u001b[90m 87| \u001b[39m      \u001b[35mconst\u001b[39m transferData \u001b[33m=\u001b[39m {\n    \u001b[90m 88| \u001b[39m        toUserId\u001b[33m:\u001b[39m \u001b[32m'test_recipient_user_12345'\u001b[39m\u001b[33m,\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/18]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/points.test.ts\u001b[2m > \u001b[22m积分系统API测试\u001b[2m > \u001b[22mPOST /points/transfer\u001b[2m > \u001b[22m应该拒绝转账给自己\n\u001b[31m\u001b[1mError\u001b[22m: Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/points.test.ts:\u001b[2m103:5\u001b[22m\u001b[39m\n    \u001b[90m101| \u001b[39m    })\u001b[33m;\u001b[39m\n    \u001b[90m102| \u001b[39m\n    \u001b[90m103| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该拒绝转账给自己'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m   | \u001b[39m    \u001b[31m^\u001b[39m\n    \u001b[90m104| \u001b[39m      \u001b[35mconst\u001b[39m transferData \u001b[33m=\u001b[39m {\n    \u001b[90m105| \u001b[39m        toUserId\u001b[33m:\u001b[39m testUserId\u001b[33m,\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/18]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/points.test.ts\u001b[2m > \u001b[22m积分系统API测试\u001b[2m > \u001b[22mPOST /points/transfer\u001b[2m > \u001b[22m应该拒绝余额不足的转账\n\u001b[31m\u001b[1mError\u001b[22m: Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/points.test.ts:\u001b[2m119:5\u001b[22m\u001b[39m\n    \u001b[90m117| \u001b[39m    })\u001b[33m;\u001b[39m\n    \u001b[90m118| \u001b[39m\n    \u001b[90m119| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该拒绝余额不足的转账'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m   | \u001b[39m    \u001b[31m^\u001b[39m\n    \u001b[90m120| \u001b[39m      \u001b[35mconst\u001b[39m transferData \u001b[33m=\u001b[39m {\n    \u001b[90m121| \u001b[39m        toUserId\u001b[33m:\u001b[39m \u001b[32m'test_recipient_user_12345'\u001b[39m\u001b[33m,\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/18]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/points.test.ts\u001b[2m > \u001b[22m积分系统API测试\u001b[2m > \u001b[22mGET /points/transactions\u001b[2m > \u001b[22m应该能够获取积分流水记录\n\u001b[31m\u001b[1mError\u001b[22m: Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/points.test.ts:\u001b[2m138:5\u001b[22m\u001b[39m\n    \u001b[90m136| \u001b[39m\n    \u001b[90m137| \u001b[39m  \u001b[34mdescribe\u001b[39m(\u001b[32m'GET /points/transactions'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m138| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该能够获取积分流水记录'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m   | \u001b[39m    \u001b[31m^\u001b[39m\n    \u001b[90m139| \u001b[39m      \u001b[35mconst\u001b[39m response \u001b[33m=\u001b[39m \u001b[35mawait\u001b[39m \u001b[34mrequest\u001b[39m(app)\n    \u001b[90m140| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/points/transactions`\u001b[39m)\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/18]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/points.test.ts\u001b[2m > \u001b[22m积分系统API测试\u001b[2m > \u001b[22mGET /points/transactions\u001b[2m > \u001b[22m应该能够按交易类型筛选流水记录\n\u001b[31m\u001b[1mError\u001b[22m: Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/points.test.ts:\u001b[2m166:5\u001b[22m\u001b[39m\n    \u001b[90m164| \u001b[39m    })\u001b[33m;\u001b[39m\n    \u001b[90m165| \u001b[39m\n    \u001b[90m166| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该能够按交易类型筛选流水记录'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m   | \u001b[39m    \u001b[31m^\u001b[39m\n    \u001b[90m167| \u001b[39m      \u001b[35mconst\u001b[39m response \u001b[33m=\u001b[39m \u001b[35mawait\u001b[39m \u001b[34mrequest\u001b[39m(app)\n    \u001b[90m168| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/points/transactions`\u001b[39m)\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/18]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/points.test.ts\u001b[2m > \u001b[22m积分系统API测试\u001b[2m > \u001b[22mGET /points/transactions\u001b[2m > \u001b[22m应该能够按时间范围筛选流水记录\n\u001b[31m\u001b[1mError\u001b[22m: Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/points.test.ts:\u001b[2m185:5\u001b[22m\u001b[39m\n    \u001b[90m183| \u001b[39m    })\u001b[33m;\u001b[39m\n    \u001b[90m184| \u001b[39m\n    \u001b[90m185| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该能够按时间范围筛选流水记录'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m   | \u001b[39m    \u001b[31m^\u001b[39m\n    \u001b[90m186| \u001b[39m      \u001b[35mconst\u001b[39m endDate \u001b[33m=\u001b[39m \u001b[35mnew\u001b[39m \u001b[33mDate\u001b[39m()\u001b[33m;\u001b[39m\n    \u001b[90m187| \u001b[39m      \u001b[35mconst\u001b[39m startDate \u001b[33m=\u001b[39m \u001b[35mnew\u001b[39m \u001b[33mDate\u001b[39m()\u001b[33m;\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[8/18]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/points.test.ts\u001b[2m > \u001b[22m积分系统API测试\u001b[2m > \u001b[22mGET /points/statistics\u001b[2m > \u001b[22m应该能够获取积分统计信息\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/points.test.ts:\u001b[2m210:10\u001b[22m\u001b[39m\n    \u001b[90m208| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/points/statistics`\u001b[39m)\n    \u001b[90m209| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39muserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m210| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m211| \u001b[39m\n    \u001b[90m212| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[9/18]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/points.test.ts\u001b[2m > \u001b[22m积分系统API测试\u001b[2m > \u001b[22mGET /points/statistics\u001b[2m > \u001b[22m应该能够获取指定时间范围的统计\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/points.test.ts:\u001b[2m229:10\u001b[22m\u001b[39m\n    \u001b[90m227| \u001b[39m          period\u001b[33m:\u001b[39m \u001b[32m'month'\u001b[39m \u001b[90m// 最近一个月\u001b[39m\n    \u001b[90m228| \u001b[39m        })\n    \u001b[90m229| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m230| \u001b[39m\n    \u001b[90m231| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[10/18]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/points.test.ts\u001b[2m > \u001b[22m积分系统API测试\u001b[2m > \u001b[22mPOST /points/recharge (管理员)\u001b[2m > \u001b[22m应该能够为用户充值积分（管理员权限）\n\u001b[31m\u001b[1mError\u001b[22m: Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/points.test.ts:\u001b[2m236:5\u001b[22m\u001b[39m\n    \u001b[90m234| \u001b[39m\n    \u001b[90m235| \u001b[39m  \u001b[34mdescribe\u001b[39m(\u001b[32m'POST /points/recharge (管理员)'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m236| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该能够为用户充值积分（管理员权限）'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m   | \u001b[39m    \u001b[31m^\u001b[39m\n    \u001b[90m237| \u001b[39m      \u001b[35mconst\u001b[39m rechargeData \u001b[33m=\u001b[39m {\n    \u001b[90m238| \u001b[39m        userId\u001b[33m:\u001b[39m testUserId\u001b[33m,\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[11/18]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/points.test.ts\u001b[2m > \u001b[22m积分系统API测试\u001b[2m > \u001b[22mPOST /points/recharge (管理员)\u001b[2m > \u001b[22m应该拒绝负数充值\n\u001b[31m\u001b[1mError\u001b[22m: Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/points.test.ts:\u001b[2m273:5\u001b[22m\u001b[39m\n    \u001b[90m271| \u001b[39m    })\u001b[33m;\u001b[39m\n    \u001b[90m272| \u001b[39m\n    \u001b[90m273| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该拒绝负数充值'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m   | \u001b[39m    \u001b[31m^\u001b[39m\n    \u001b[90m274| \u001b[39m      \u001b[35mconst\u001b[39m rechargeData \u001b[33m=\u001b[39m {\n    \u001b[90m275| \u001b[39m        userId\u001b[33m:\u001b[39m testUserId\u001b[33m,\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[12/18]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/points.test.ts\u001b[2m > \u001b[22m积分系统API测试\u001b[2m > \u001b[22mPOST /points/freeze (管理员)\u001b[2m > \u001b[22m应该能够冻结用户积分（管理员权限）\n\u001b[31m\u001b[1mError\u001b[22m: Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/points.test.ts:\u001b[2m291:5\u001b[22m\u001b[39m\n    \u001b[90m289| \u001b[39m\n    \u001b[90m290| \u001b[39m  \u001b[34mdescribe\u001b[39m(\u001b[32m'POST /points/freeze (管理员)'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m291| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该能够冻结用户积分（管理员权限）'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m   | \u001b[39m    \u001b[31m^\u001b[39m\n    \u001b[90m292| \u001b[39m      \u001b[35mconst\u001b[39m freezeData \u001b[33m=\u001b[39m {\n    \u001b[90m293| \u001b[39m        userId\u001b[33m:\u001b[39m testUserId\u001b[33m,\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[13/18]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/points.test.ts\u001b[2m > \u001b[22m积分系统API测试\u001b[2m > \u001b[22mPOST /points/freeze (管理员)\u001b[2m > \u001b[22m应该能够解冻用户积分（管理员权限）\n\u001b[31m\u001b[1mError\u001b[22m: Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/points.test.ts:\u001b[2m309:5\u001b[22m\u001b[39m\n    \u001b[90m307| \u001b[39m    })\u001b[33m;\u001b[39m\n    \u001b[90m308| \u001b[39m\n    \u001b[90m309| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该能够解冻用户积分（管理员权限）'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m   | \u001b[39m    \u001b[31m^\u001b[39m\n    \u001b[90m310| \u001b[39m      \u001b[35mconst\u001b[39m freezeData \u001b[33m=\u001b[39m {\n    \u001b[90m311| \u001b[39m        userId\u001b[33m:\u001b[39m testUserId\u001b[33m,\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[14/18]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/points.test.ts\u001b[2m > \u001b[22m积分系统API测试\u001b[2m > \u001b[22mPOST /points/batch-recharge (管理员)\u001b[2m > \u001b[22m应该能够批量充值积分（管理员权限）\n\u001b[31m\u001b[1mError\u001b[22m: Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/points.test.ts:\u001b[2m328:5\u001b[22m\u001b[39m\n    \u001b[90m326| \u001b[39m\n    \u001b[90m327| \u001b[39m  \u001b[34mdescribe\u001b[39m(\u001b[32m'POST /points/batch-recharge (管理员)'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m328| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该能够批量充值积分（管理员权限）'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m   | \u001b[39m    \u001b[31m^\u001b[39m\n    \u001b[90m329| \u001b[39m      \u001b[35mconst\u001b[39m batchRechargeData \u001b[33m=\u001b[39m {\n    \u001b[90m330| \u001b[39m        operations\u001b[33m:\u001b[39m [\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[15/18]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/points.test.ts\u001b[2m > \u001b[22m积分系统API测试\u001b[2m > \u001b[22mPOST /points/batch-recharge (管理员)\u001b[2m > \u001b[22m应该处理批量充值中的部分失败\n\u001b[31m\u001b[1mError\u001b[22m: Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/points.test.ts:\u001b[2m357:5\u001b[22m\u001b[39m\n    \u001b[90m355| \u001b[39m    })\u001b[33m;\u001b[39m\n    \u001b[90m356| \u001b[39m\n    \u001b[90m357| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该处理批量充值中的部分失败'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m   | \u001b[39m    \u001b[31m^\u001b[39m\n    \u001b[90m358| \u001b[39m      \u001b[35mconst\u001b[39m batchRechargeData \u001b[33m=\u001b[39m {\n    \u001b[90m359| \u001b[39m        operations\u001b[33m:\u001b[39m [\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[16/18]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/points.test.ts\u001b[2m > \u001b[22m积分系统API测试\u001b[2m > \u001b[22m积分转账限制和安全测试\u001b[2m > \u001b[22m应该有单日转账金额限制\n\u001b[31m\u001b[1mError\u001b[22m: Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/points.test.ts:\u001b[2m386:5\u001b[22m\u001b[39m\n    \u001b[90m384| \u001b[39m\n    \u001b[90m385| \u001b[39m  \u001b[34mdescribe\u001b[39m(\u001b[32m'积分转账限制和安全测试'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m386| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该有单日转账金额限制'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m   | \u001b[39m    \u001b[31m^\u001b[39m\n    \u001b[90m387| \u001b[39m      \u001b[90m// 测试大额转账是否被限制\u001b[39m\n    \u001b[90m388| \u001b[39m      \u001b[35mconst\u001b[39m largeAmount \u001b[33m=\u001b[39m \u001b[34m50000\u001b[39m\u001b[33m;\u001b[39m \u001b[90m// 假设日限额是10000\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[17/18]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/points.test.ts\u001b[2m > \u001b[22m积分系统API测试\u001b[2m > \u001b[22m积分转账限制和安全测试\u001b[2m > \u001b[22m应该有转账频率限制\n\u001b[31m\u001b[1mError\u001b[22m: Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/points.test.ts:\u001b[2m407:5\u001b[22m\u001b[39m\n    \u001b[90m405| \u001b[39m    })\u001b[33m;\u001b[39m\n    \u001b[90m406| \u001b[39m\n    \u001b[90m407| \u001b[39m    \u001b[34mit\u001b[39m(\u001b[32m'应该有转账频率限制'\u001b[39m\u001b[33m,\u001b[39m \u001b[35masync\u001b[39m () \u001b[33m=>\u001b[39m {\n    \u001b[90m   | \u001b[39m    \u001b[31m^\u001b[39m\n    \u001b[90m408| \u001b[39m      \u001b[35mconst\u001b[39m transferData \u001b[33m=\u001b[39m {\n    \u001b[90m409| \u001b[39m        toUserId\u001b[33m:\u001b[39m \u001b[32m'test_recipient_user_12345'\u001b[39m\u001b[33m,\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[18/18]⎯\u001b[22m\u001b[39m\n\n",
      "suggestedFix": "查看详细错误日志，联系相关开发人员"
    },
    {
      "module": "佣金系统 - commission.test.ts",
      "severity": "high",
      "error": "Command failed: npm test tests/api/commission.test.ts\n\n\u001b[31m⎯⎯⎯⎯⎯⎯\u001b[39m\u001b[1m\u001b[41m Failed Tests 30 \u001b[49m\u001b[22m\u001b[31m⎯⎯⎯⎯⎯⎯⎯\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission\u001b[2m > \u001b[22m用户应该能够查看自己的佣金记录\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m90:10\u001b[22m\u001b[39m\n    \u001b[90m 88| \u001b[39m          perPage\u001b[33m:\u001b[39m \u001b[34m10\u001b[39m\n    \u001b[90m 89| \u001b[39m        })\n    \u001b[90m 90| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m 91| \u001b[39m\n    \u001b[90m 92| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission\u001b[2m > \u001b[22m应该支持按状态筛选\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m108:10\u001b[22m\u001b[39m\n    \u001b[90m106| \u001b[39m          status\u001b[33m:\u001b[39m \u001b[32m'PENDING'\u001b[39m\n    \u001b[90m107| \u001b[39m        })\n    \u001b[90m108| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m109| \u001b[39m\n    \u001b[90m110| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission\u001b[2m > \u001b[22m应该支持按日期范围筛选\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m126:10\u001b[22m\u001b[39m\n    \u001b[90m124| \u001b[39m          endDate\u001b[33m:\u001b[39m today\u001b[33m.\u001b[39m\u001b[34mtoISOString\u001b[39m()\n    \u001b[90m125| \u001b[39m        })\n    \u001b[90m126| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m127| \u001b[39m\n    \u001b[90m128| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission\u001b[2m > \u001b[22m管理员应该能查看所有佣金记录\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m140:10\u001b[22m\u001b[39m\n    \u001b[90m138| \u001b[39m          allUsers\u001b[33m:\u001b[39m \u001b[35mtrue\u001b[39m\n    \u001b[90m139| \u001b[39m        })\n    \u001b[90m140| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m141| \u001b[39m\n    \u001b[90m142| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/summary\u001b[2m > \u001b[22m应该能够获取佣金汇总\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m151:10\u001b[22m\u001b[39m\n    \u001b[90m149| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/commission/summary`\u001b[39m)\n    \u001b[90m150| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mstarUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m151| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m152| \u001b[39m\n    \u001b[90m153| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/summary\u001b[2m > \u001b[22m应该包含佣金统计图表数据\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m169:10\u001b[22m\u001b[39m\n    \u001b[90m167| \u001b[39m          chart\u001b[33m:\u001b[39m \u001b[35mtrue\u001b[39m\n    \u001b[90m168| \u001b[39m        })\n    \u001b[90m169| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m170| \u001b[39m\n    \u001b[90m171| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/:id\u001b[2m > \u001b[22m应该能够获取指定佣金详情\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m183:10\u001b[22m\u001b[39m\n    \u001b[90m181| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/commission/\u001b[39m\u001b[36m${\u001b[39mtestCommissionId\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m182| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mstarUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m183| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m184| \u001b[39m\n    \u001b[90m185| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/:id\u001b[2m > \u001b[22m不存在的佣金ID应返回404\n\u001b[31m\u001b[1mError\u001b[22m: expected 404 \"Not Found\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m197:10\u001b[22m\u001b[39m\n    \u001b[90m195| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/commission/\u001b[39m\u001b[36m${\u001b[39mfakeId\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m196| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mstarUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m197| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m404\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m198| \u001b[39m\n    \u001b[90m199| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[8/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/:id\u001b[2m > \u001b[22m不能查看他人的佣金详情\n\u001b[31m\u001b[1mError\u001b[22m: expected 403 \"Forbidden\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m206:10\u001b[22m\u001b[39m\n    \u001b[90m204| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/commission/\u001b[39m\u001b[36m${\u001b[39mtestCommissionId\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m205| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mnormalUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m206| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m403\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m207| \u001b[39m\n    \u001b[90m208| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[9/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mPOST /commission/calculate\u001b[2m > \u001b[22m应该能够计算订单佣金\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m236:10\u001b[22m\u001b[39m\n    \u001b[90m234| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mdirectorToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m235| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(calculateData)\n    \u001b[90m236| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m237| \u001b[39m\n    \u001b[90m238| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[10/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mPOST /commission/calculate\u001b[2m > \u001b[22m应该验证订单数据\n\u001b[31m\u001b[1mError\u001b[22m: expected 400 \"Bad Request\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m254:10\u001b[22m\u001b[39m\n    \u001b[90m252| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mdirectorToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m253| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(calculateData)\n    \u001b[90m254| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m400\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m255| \u001b[39m\n    \u001b[90m256| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[11/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mPOST /commission/calculate\u001b[2m > \u001b[22m普通用户不能计算佣金\n\u001b[31m\u001b[1mError\u001b[22m: expected 403 \"Forbidden\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m269:10\u001b[22m\u001b[39m\n    \u001b[90m267| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mnormalUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m268| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(calculateData)\n    \u001b[90m269| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m403\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m270| \u001b[39m\n    \u001b[90m271| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[12/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mPOST /commission/settle\u001b[2m > \u001b[22m应该能够结算佣金\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m303:10\u001b[22m\u001b[39m\n    \u001b[90m301| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mdirectorToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m302| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(settleData)\n    \u001b[90m303| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m304| \u001b[39m\n    \u001b[90m305| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[13/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mPOST /commission/settle\u001b[2m > \u001b[22m应该验证结算条件\n\u001b[31m\u001b[1mError\u001b[22m: expected 400 \"Bad Request\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m320:10\u001b[22m\u001b[39m\n    \u001b[90m318| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mdirectorToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m319| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(settleData)\n    \u001b[90m320| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m400\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m321| \u001b[39m\n    \u001b[90m322| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[14/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mPOST /commission/settle\u001b[2m > \u001b[22m普通用户不能结算佣金\n\u001b[31m\u001b[1mError\u001b[22m: expected 403 \"Forbidden\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m332:10\u001b[22m\u001b[39m\n    \u001b[90m330| \u001b[39m          commissionIds\u001b[33m:\u001b[39m [testCommissionId]\n    \u001b[90m331| \u001b[39m        })\n    \u001b[90m332| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m403\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m333| \u001b[39m\n    \u001b[90m334| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[15/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mPOST /commission/withdraw\u001b[2m > \u001b[22m应该能够申请佣金提现\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m372:10\u001b[22m\u001b[39m\n    \u001b[90m370| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mstarUser\u001b[33m.\u001b[39mtokens\u001b[33m.\u001b[39maccessToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m371| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(withdrawData)\n    \u001b[90m372| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m373| \u001b[39m\n    \u001b[90m374| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[16/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mPOST /commission/withdraw\u001b[2m > \u001b[22m应该验证提现金额\n\u001b[31m\u001b[1mError\u001b[22m: expected 400 \"Bad Request\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m390:10\u001b[22m\u001b[39m\n    \u001b[90m388| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mstarUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m389| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(withdrawData)\n    \u001b[90m390| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m400\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m391| \u001b[39m\n    \u001b[90m392| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[17/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mPOST /commission/withdraw\u001b[2m > \u001b[22m应该验证提现方式\n\u001b[31m\u001b[1mError\u001b[22m: expected 400 \"Bad Request\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m406:10\u001b[22m\u001b[39m\n    \u001b[90m404| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mstarUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m405| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(withdrawData)\n    \u001b[90m406| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m400\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m407| \u001b[39m\n    \u001b[90m408| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[18/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/withdrawals\u001b[2m > \u001b[22m应该能够获取提现记录\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m421:10\u001b[22m\u001b[39m\n    \u001b[90m419| \u001b[39m          perPage\u001b[33m:\u001b[39m \u001b[34m10\u001b[39m\n    \u001b[90m420| \u001b[39m        })\n    \u001b[90m421| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m422| \u001b[39m\n    \u001b[90m423| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[19/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/withdrawals\u001b[2m > \u001b[22m管理员应该能查看所有提现记录\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m443:10\u001b[22m\u001b[39m\n    \u001b[90m441| \u001b[39m          allUsers\u001b[33m:\u001b[39m \u001b[35mtrue\u001b[39m\n    \u001b[90m442| \u001b[39m        })\n    \u001b[90m443| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m444| \u001b[39m\n    \u001b[90m445| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[20/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/withdrawals\u001b[2m > \u001b[22m应该支持按状态筛选\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m457:10\u001b[22m\u001b[39m\n    \u001b[90m455| \u001b[39m          status\u001b[33m:\u001b[39m \u001b[32m'PENDING'\u001b[39m\n    \u001b[90m456| \u001b[39m        })\n    \u001b[90m457| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m458| \u001b[39m\n    \u001b[90m459| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[21/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mPOST /commission/withdrawals/:id/approve\u001b[2m > \u001b[22m管理员应该能够批准提现\n\u001b[31m\u001b[1mTypeError\u001b[22m: Cannot read properties of undefined (reading 'withdrawId')\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m492:53\u001b[22m\u001b[39m\n    \u001b[90m490| \u001b[39m        })\u001b[33m;\u001b[39m\n    \u001b[90m491| \u001b[39m\n    \u001b[90m492| \u001b[39m      \u001b[35mconst\u001b[39m withdrawId \u001b[33m=\u001b[39m withdrawResponse\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mdata\u001b[33m.\u001b[39mwithdrawId\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m                                                    \u001b[31m^\u001b[39m\n    \u001b[90m493| \u001b[39m\n    \u001b[90m494| \u001b[39m      \u001b[90m// 批准提现\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[22/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mPOST /commission/withdrawals/:id/approve\u001b[2m > \u001b[22m普通用户不能批准提现\n\u001b[31m\u001b[1mError\u001b[22m: expected 403 \"Forbidden\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m515:10\u001b[22m\u001b[39m\n    \u001b[90m513| \u001b[39m          remark\u001b[33m:\u001b[39m \u001b[32m'我批准'\u001b[39m\n    \u001b[90m514| \u001b[39m        })\n    \u001b[90m515| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m403\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m516| \u001b[39m\n    \u001b[90m517| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[23/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mPOST /commission/withdrawals/:id/reject\u001b[2m > \u001b[22m管理员应该能够拒绝提现\n\u001b[31m\u001b[1mTypeError\u001b[22m: Cannot read properties of undefined (reading 'withdrawId')\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m550:53\u001b[22m\u001b[39m\n    \u001b[90m548| \u001b[39m        })\u001b[33m;\u001b[39m\n    \u001b[90m549| \u001b[39m\n    \u001b[90m550| \u001b[39m      \u001b[35mconst\u001b[39m withdrawId \u001b[33m=\u001b[39m withdrawResponse\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mdata\u001b[33m.\u001b[39mwithdrawId\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m                                                    \u001b[31m^\u001b[39m\n    \u001b[90m551| \u001b[39m\n    \u001b[90m552| \u001b[39m      \u001b[90m// 拒绝提现\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[24/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/rules\u001b[2m > \u001b[22m应该能够获取佣金规则\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m571:10\u001b[22m\u001b[39m\n    \u001b[90m569| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/commission/rules`\u001b[39m)\n    \u001b[90m570| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mstarUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m571| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m572| \u001b[39m\n    \u001b[90m573| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[25/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/rules\u001b[2m > \u001b[22m应该包含不同层级的佣金规则\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m590:10\u001b[22m\u001b[39m\n    \u001b[90m588| \u001b[39m          includeInactive\u001b[33m:\u001b[39m \u001b[35mtrue\u001b[39m\n    \u001b[90m589| \u001b[39m        })\n    \u001b[90m590| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m591| \u001b[39m\n    \u001b[90m592| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[26/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/rates\u001b[2m > \u001b[22m应该能够获取当前佣金费率\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m601:10\u001b[22m\u001b[39m\n    \u001b[90m599| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/commission/rates`\u001b[39m)\n    \u001b[90m600| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mnormalUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m601| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m602| \u001b[39m\n    \u001b[90m603| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[27/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/rates\u001b[2m > \u001b[22m不同用户级别应该有不同的费率\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m612:10\u001b[22m\u001b[39m\n    \u001b[90m610| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/commission/rates`\u001b[39m)\n    \u001b[90m611| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mnormalUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m612| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m613| \u001b[39m\n    \u001b[90m614| \u001b[39m      \u001b[35mconst\u001b[39m starResponse \u001b[33m=\u001b[39m \u001b[35mawait\u001b[39m \u001b[34mrequest\u001b[39m(app)\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[28/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/statistics\u001b[2m > \u001b[22m应该能够获取佣金统计\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m632:10\u001b[22m\u001b[39m\n    \u001b[90m630| \u001b[39m          period\u001b[33m:\u001b[39m \u001b[32m'month'\u001b[39m\n    \u001b[90m631| \u001b[39m        })\n    \u001b[90m632| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m633| \u001b[39m\n    \u001b[90m634| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[29/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/statistics\u001b[2m > \u001b[22m应该支持不同时间周期\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m650:12\u001b[22m\u001b[39m\n    \u001b[90m648| \u001b[39m            period\u001b[33m:\u001b[39m period\n    \u001b[90m649| \u001b[39m          })\n    \u001b[90m650| \u001b[39m          \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m           \u001b[31m^\u001b[39m\n    \u001b[90m651| \u001b[39m\n    \u001b[90m652| \u001b[39m        \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[30/30]⎯\u001b[22m\u001b[39m\n\n",
      "suggestedFix": "查看详细错误日志，联系相关开发人员"
    },
    {
      "module": "管理系统",
      "severity": "high",
      "error": "Command failed: npm run test:admin\n\n\u001b[31m⎯⎯⎯⎯⎯⎯\u001b[39m\u001b[1m\u001b[41m Failed Suites 1 \u001b[49m\u001b[22m\u001b[31m⎯⎯⎯⎯⎯⎯⎯\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/admin.test.ts\u001b[2m > \u001b[22mAdmin基础功能测试\n\u001b[31m\u001b[1mTypeError\u001b[22m: Cannot read properties of undefined (reading 'ADMIN')\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/admin.test.ts:\u001b[2m15:57\u001b[22m\u001b[39m\n    \u001b[90m 13| \u001b[39m\n    \u001b[90m 14| \u001b[39m    \u001b[90m// 创建Admin用户\u001b[39m\n    \u001b[90m 15| \u001b[39m    \u001b[35mconst\u001b[39m adminUser \u001b[33m=\u001b[39m \u001b[35mawait\u001b[39m \u001b[34mcreateTestUser\u001b[39m(\u001b[33mTestUserType\u001b[39m\u001b[33m.\u001b[39m\u001b[33mADMIN\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m                                                        \u001b[31m^\u001b[39m\n    \u001b[90m 16| \u001b[39m    adminHeaders \u001b[33m=\u001b[39m \u001b[34mgetAuthHeaders\u001b[39m(adminUser\u001b[33m.\u001b[39mtoken)\u001b[33m;\u001b[39m\n    \u001b[90m 17| \u001b[39m  })\u001b[33m;\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/1]⎯\u001b[22m\u001b[39m\n\n",
      "suggestedFix": "查看详细错误日志，联系相关开发人员"
    },
    {
      "module": "安全测试",
      "severity": "high",
      "error": "Command failed: npm run test:security\n\u001b[31mNo test files found, exiting with code 1\n\u001b[39m\n\u001b[2mfilter: \u001b[22m\u001b[33mtests/security/*.test.ts\u001b[39m\n\u001b[2minclude: \u001b[22m\u001b[33m**/*.test.ts\u001b[39m\n\u001b[2mexclude:  \u001b[22m\u001b[33mnode_modules\u001b[2m, \u001b[22mdist\u001b[39m\n\n",
      "suggestedFix": "查看详细错误日志，联系相关开发人员"
    },
    {
      "module": "性能测试",
      "severity": "high",
      "error": "Command failed: npm run test:performance\n\u001b[31mNo test files found, exiting with code 1\n\u001b[39m\n\u001b[2mfilter: \u001b[22m\u001b[33mtests/performance/*.test.ts\u001b[39m\n\u001b[2minclude: \u001b[22m\u001b[33m**/*.test.ts\u001b[39m\n\u001b[2mexclude:  \u001b[22m\u001b[33mnode_modules\u001b[2m, \u001b[22mdist\u001b[39m\n\n",
      "suggestedFix": "查看详细错误日志，联系相关开发人员"
    },
    {
      "module": "集成测试",
      "severity": "high",
      "error": "Command failed: npm run test:integration\n\u001b[31mNo test files found, exiting with code 1\n\u001b[39m\n\u001b[2mfilter: \u001b[22m\u001b[33mtests/integration/*.test.ts\u001b[39m\n\u001b[2minclude: \u001b[22m\u001b[33m**/*.test.ts\u001b[39m\n\u001b[2mexclude:  \u001b[22m\u001b[33mnode_modules\u001b[2m, \u001b[22mdist\u001b[39m\n\n",
      "suggestedFix": "查看详细错误日志，联系相关开发人员"
    }
  ]
}