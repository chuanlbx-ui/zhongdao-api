{
  "name": "佣金系统 - commission.test.ts",
  "command": "npm test tests/api/commission.test.ts",
  "startTime": "2025-12-09T12:32:38.814Z",
  "status": "failed",
  "output": "",
  "error": "Command failed: npm test tests/api/commission.test.ts\n\n\u001b[31m⎯⎯⎯⎯⎯⎯\u001b[39m\u001b[1m\u001b[41m Failed Tests 30 \u001b[49m\u001b[22m\u001b[31m⎯⎯⎯⎯⎯⎯⎯\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission\u001b[2m > \u001b[22m用户应该能够查看自己的佣金记录\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m90:10\u001b[22m\u001b[39m\n    \u001b[90m 88| \u001b[39m          perPage\u001b[33m:\u001b[39m \u001b[34m10\u001b[39m\n    \u001b[90m 89| \u001b[39m        })\n    \u001b[90m 90| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m 91| \u001b[39m\n    \u001b[90m 92| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission\u001b[2m > \u001b[22m应该支持按状态筛选\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m108:10\u001b[22m\u001b[39m\n    \u001b[90m106| \u001b[39m          status\u001b[33m:\u001b[39m \u001b[32m'PENDING'\u001b[39m\n    \u001b[90m107| \u001b[39m        })\n    \u001b[90m108| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m109| \u001b[39m\n    \u001b[90m110| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission\u001b[2m > \u001b[22m应该支持按日期范围筛选\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m126:10\u001b[22m\u001b[39m\n    \u001b[90m124| \u001b[39m          endDate\u001b[33m:\u001b[39m today\u001b[33m.\u001b[39m\u001b[34mtoISOString\u001b[39m()\n    \u001b[90m125| \u001b[39m        })\n    \u001b[90m126| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m127| \u001b[39m\n    \u001b[90m128| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission\u001b[2m > \u001b[22m管理员应该能查看所有佣金记录\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m140:10\u001b[22m\u001b[39m\n    \u001b[90m138| \u001b[39m          allUsers\u001b[33m:\u001b[39m \u001b[35mtrue\u001b[39m\n    \u001b[90m139| \u001b[39m        })\n    \u001b[90m140| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m141| \u001b[39m\n    \u001b[90m142| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/summary\u001b[2m > \u001b[22m应该能够获取佣金汇总\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m151:10\u001b[22m\u001b[39m\n    \u001b[90m149| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/commission/summary`\u001b[39m)\n    \u001b[90m150| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mstarUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m151| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m152| \u001b[39m\n    \u001b[90m153| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/summary\u001b[2m > \u001b[22m应该包含佣金统计图表数据\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m169:10\u001b[22m\u001b[39m\n    \u001b[90m167| \u001b[39m          chart\u001b[33m:\u001b[39m \u001b[35mtrue\u001b[39m\n    \u001b[90m168| \u001b[39m        })\n    \u001b[90m169| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m170| \u001b[39m\n    \u001b[90m171| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/:id\u001b[2m > \u001b[22m应该能够获取指定佣金详情\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m183:10\u001b[22m\u001b[39m\n    \u001b[90m181| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/commission/\u001b[39m\u001b[36m${\u001b[39mtestCommissionId\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m182| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mstarUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m183| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m184| \u001b[39m\n    \u001b[90m185| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/:id\u001b[2m > \u001b[22m不存在的佣金ID应返回404\n\u001b[31m\u001b[1mError\u001b[22m: expected 404 \"Not Found\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m197:10\u001b[22m\u001b[39m\n    \u001b[90m195| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/commission/\u001b[39m\u001b[36m${\u001b[39mfakeId\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m196| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mstarUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m197| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m404\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m198| \u001b[39m\n    \u001b[90m199| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[8/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/:id\u001b[2m > \u001b[22m不能查看他人的佣金详情\n\u001b[31m\u001b[1mError\u001b[22m: expected 403 \"Forbidden\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m206:10\u001b[22m\u001b[39m\n    \u001b[90m204| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/commission/\u001b[39m\u001b[36m${\u001b[39mtestCommissionId\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m205| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mnormalUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m206| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m403\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m207| \u001b[39m\n    \u001b[90m208| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[9/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mPOST /commission/calculate\u001b[2m > \u001b[22m应该能够计算订单佣金\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m236:10\u001b[22m\u001b[39m\n    \u001b[90m234| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mdirectorToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m235| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(calculateData)\n    \u001b[90m236| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m237| \u001b[39m\n    \u001b[90m238| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[10/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mPOST /commission/calculate\u001b[2m > \u001b[22m应该验证订单数据\n\u001b[31m\u001b[1mError\u001b[22m: expected 400 \"Bad Request\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m254:10\u001b[22m\u001b[39m\n    \u001b[90m252| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mdirectorToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m253| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(calculateData)\n    \u001b[90m254| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m400\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m255| \u001b[39m\n    \u001b[90m256| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[11/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mPOST /commission/calculate\u001b[2m > \u001b[22m普通用户不能计算佣金\n\u001b[31m\u001b[1mError\u001b[22m: expected 403 \"Forbidden\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m269:10\u001b[22m\u001b[39m\n    \u001b[90m267| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mnormalUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m268| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(calculateData)\n    \u001b[90m269| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m403\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m270| \u001b[39m\n    \u001b[90m271| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[12/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mPOST /commission/settle\u001b[2m > \u001b[22m应该能够结算佣金\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m303:10\u001b[22m\u001b[39m\n    \u001b[90m301| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mdirectorToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m302| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(settleData)\n    \u001b[90m303| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m304| \u001b[39m\n    \u001b[90m305| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[13/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mPOST /commission/settle\u001b[2m > \u001b[22m应该验证结算条件\n\u001b[31m\u001b[1mError\u001b[22m: expected 400 \"Bad Request\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m320:10\u001b[22m\u001b[39m\n    \u001b[90m318| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mdirectorToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m319| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(settleData)\n    \u001b[90m320| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m400\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m321| \u001b[39m\n    \u001b[90m322| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[14/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mPOST /commission/settle\u001b[2m > \u001b[22m普通用户不能结算佣金\n\u001b[31m\u001b[1mError\u001b[22m: expected 403 \"Forbidden\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m332:10\u001b[22m\u001b[39m\n    \u001b[90m330| \u001b[39m          commissionIds\u001b[33m:\u001b[39m [testCommissionId]\n    \u001b[90m331| \u001b[39m        })\n    \u001b[90m332| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m403\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m333| \u001b[39m\n    \u001b[90m334| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[15/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mPOST /commission/withdraw\u001b[2m > \u001b[22m应该能够申请佣金提现\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m372:10\u001b[22m\u001b[39m\n    \u001b[90m370| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mstarUser\u001b[33m.\u001b[39mtokens\u001b[33m.\u001b[39maccessToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m371| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(withdrawData)\n    \u001b[90m372| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m373| \u001b[39m\n    \u001b[90m374| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[16/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mPOST /commission/withdraw\u001b[2m > \u001b[22m应该验证提现金额\n\u001b[31m\u001b[1mError\u001b[22m: expected 400 \"Bad Request\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m390:10\u001b[22m\u001b[39m\n    \u001b[90m388| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mstarUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m389| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(withdrawData)\n    \u001b[90m390| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m400\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m391| \u001b[39m\n    \u001b[90m392| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[17/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mPOST /commission/withdraw\u001b[2m > \u001b[22m应该验证提现方式\n\u001b[31m\u001b[1mError\u001b[22m: expected 400 \"Bad Request\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m406:10\u001b[22m\u001b[39m\n    \u001b[90m404| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mstarUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m405| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(withdrawData)\n    \u001b[90m406| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m400\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m407| \u001b[39m\n    \u001b[90m408| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[18/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/withdrawals\u001b[2m > \u001b[22m应该能够获取提现记录\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m421:10\u001b[22m\u001b[39m\n    \u001b[90m419| \u001b[39m          perPage\u001b[33m:\u001b[39m \u001b[34m10\u001b[39m\n    \u001b[90m420| \u001b[39m        })\n    \u001b[90m421| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m422| \u001b[39m\n    \u001b[90m423| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[19/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/withdrawals\u001b[2m > \u001b[22m管理员应该能查看所有提现记录\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m443:10\u001b[22m\u001b[39m\n    \u001b[90m441| \u001b[39m          allUsers\u001b[33m:\u001b[39m \u001b[35mtrue\u001b[39m\n    \u001b[90m442| \u001b[39m        })\n    \u001b[90m443| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m444| \u001b[39m\n    \u001b[90m445| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[20/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/withdrawals\u001b[2m > \u001b[22m应该支持按状态筛选\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m457:10\u001b[22m\u001b[39m\n    \u001b[90m455| \u001b[39m          status\u001b[33m:\u001b[39m \u001b[32m'PENDING'\u001b[39m\n    \u001b[90m456| \u001b[39m        })\n    \u001b[90m457| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m458| \u001b[39m\n    \u001b[90m459| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[21/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mPOST /commission/withdrawals/:id/approve\u001b[2m > \u001b[22m管理员应该能够批准提现\n\u001b[31m\u001b[1mTypeError\u001b[22m: Cannot read properties of undefined (reading 'withdrawId')\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m492:53\u001b[22m\u001b[39m\n    \u001b[90m490| \u001b[39m        })\u001b[33m;\u001b[39m\n    \u001b[90m491| \u001b[39m\n    \u001b[90m492| \u001b[39m      \u001b[35mconst\u001b[39m withdrawId \u001b[33m=\u001b[39m withdrawResponse\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mdata\u001b[33m.\u001b[39mwithdrawId\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m                                                    \u001b[31m^\u001b[39m\n    \u001b[90m493| \u001b[39m\n    \u001b[90m494| \u001b[39m      \u001b[90m// 批准提现\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[22/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mPOST /commission/withdrawals/:id/approve\u001b[2m > \u001b[22m普通用户不能批准提现\n\u001b[31m\u001b[1mError\u001b[22m: expected 403 \"Forbidden\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m515:10\u001b[22m\u001b[39m\n    \u001b[90m513| \u001b[39m          remark\u001b[33m:\u001b[39m \u001b[32m'我批准'\u001b[39m\n    \u001b[90m514| \u001b[39m        })\n    \u001b[90m515| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m403\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m516| \u001b[39m\n    \u001b[90m517| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[23/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mPOST /commission/withdrawals/:id/reject\u001b[2m > \u001b[22m管理员应该能够拒绝提现\n\u001b[31m\u001b[1mTypeError\u001b[22m: Cannot read properties of undefined (reading 'withdrawId')\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m550:53\u001b[22m\u001b[39m\n    \u001b[90m548| \u001b[39m        })\u001b[33m;\u001b[39m\n    \u001b[90m549| \u001b[39m\n    \u001b[90m550| \u001b[39m      \u001b[35mconst\u001b[39m withdrawId \u001b[33m=\u001b[39m withdrawResponse\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mdata\u001b[33m.\u001b[39mwithdrawId\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m                                                    \u001b[31m^\u001b[39m\n    \u001b[90m551| \u001b[39m\n    \u001b[90m552| \u001b[39m      \u001b[90m// 拒绝提现\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[24/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/rules\u001b[2m > \u001b[22m应该能够获取佣金规则\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m571:10\u001b[22m\u001b[39m\n    \u001b[90m569| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/commission/rules`\u001b[39m)\n    \u001b[90m570| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mstarUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m571| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m572| \u001b[39m\n    \u001b[90m573| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[25/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/rules\u001b[2m > \u001b[22m应该包含不同层级的佣金规则\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m590:10\u001b[22m\u001b[39m\n    \u001b[90m588| \u001b[39m          includeInactive\u001b[33m:\u001b[39m \u001b[35mtrue\u001b[39m\n    \u001b[90m589| \u001b[39m        })\n    \u001b[90m590| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m591| \u001b[39m\n    \u001b[90m592| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[26/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/rates\u001b[2m > \u001b[22m应该能够获取当前佣金费率\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m601:10\u001b[22m\u001b[39m\n    \u001b[90m599| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/commission/rates`\u001b[39m)\n    \u001b[90m600| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mnormalUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m601| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m602| \u001b[39m\n    \u001b[90m603| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[27/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/rates\u001b[2m > \u001b[22m不同用户级别应该有不同的费率\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m612:10\u001b[22m\u001b[39m\n    \u001b[90m610| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/commission/rates`\u001b[39m)\n    \u001b[90m611| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mnormalUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m612| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m613| \u001b[39m\n    \u001b[90m614| \u001b[39m      \u001b[35mconst\u001b[39m starResponse \u001b[33m=\u001b[39m \u001b[35mawait\u001b[39m \u001b[34mrequest\u001b[39m(app)\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[28/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/statistics\u001b[2m > \u001b[22m应该能够获取佣金统计\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m632:10\u001b[22m\u001b[39m\n    \u001b[90m630| \u001b[39m          period\u001b[33m:\u001b[39m \u001b[32m'month'\u001b[39m\n    \u001b[90m631| \u001b[39m        })\n    \u001b[90m632| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m633| \u001b[39m\n    \u001b[90m634| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[29/30]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/commission.test.ts\u001b[2m > \u001b[22m佣金管理API测试\u001b[2m > \u001b[22mGET /commission/statistics\u001b[2m > \u001b[22m应该支持不同时间周期\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/commission.test.ts:\u001b[2m650:12\u001b[22m\u001b[39m\n    \u001b[90m648| \u001b[39m            period\u001b[33m:\u001b[39m period\n    \u001b[90m649| \u001b[39m          })\n    \u001b[90m650| \u001b[39m          \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m           \u001b[31m^\u001b[39m\n    \u001b[90m651| \u001b[39m\n    \u001b[90m652| \u001b[39m        \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[30/30]⎯\u001b[22m\u001b[39m\n\n",
  "endTime": "2025-12-09T12:32:46.941Z",
  "duration": 8127
}