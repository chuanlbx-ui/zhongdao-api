{
  "name": "商城管理系统 - shops.test.ts",
  "command": "npm test tests/api/shops.test.ts",
  "startTime": "2025-12-09T12:10:58.584Z",
  "status": "failed",
  "output": "",
  "error": "Command failed: npm test tests/api/shops.test.ts\n\n\u001b[31m⎯⎯⎯⎯⎯⎯\u001b[39m\u001b[1m\u001b[41m Failed Tests 14 \u001b[49m\u001b[22m\u001b[31m⎯⎯⎯⎯⎯⎯⎯\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mPOST /shops\u001b[2m > \u001b[22mVIP用户应该能够创建云店\n\u001b[31m\u001b[1mError\u001b[22m: expected 201 \"Created\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m81:10\u001b[22m\u001b[39m\n    \u001b[90m 79| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mvipUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m 80| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(shopData)\n    \u001b[90m 81| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m201\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m 82| \u001b[39m\n    \u001b[90m 83| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mPOST /shops\u001b[2m > \u001b[22m普通用户不能创建云店\n\u001b[31m\u001b[1mError\u001b[22m: expected 403 \"Forbidden\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m101:10\u001b[22m\u001b[39m\n    \u001b[90m 99| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mnormalUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m100| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(shopData)\n    \u001b[90m101| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m403\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m102| \u001b[39m\n    \u001b[90m103| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mPOST /shops\u001b[2m > \u001b[22m二星店长应该能够创建五通店\n\u001b[31m\u001b[1mError\u001b[22m: expected 201 \"Created\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m122:10\u001b[22m\u001b[39m\n    \u001b[90m120| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mstar2User\u001b[33m.\u001b[39mtokens\u001b[33m.\u001b[39maccessToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m121| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(shopData)\n    \u001b[90m122| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m201\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m123| \u001b[39m\n    \u001b[90m124| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mGET /shops\u001b[2m > \u001b[22m应该能够获取店铺列表\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m146:10\u001b[22m\u001b[39m\n    \u001b[90m144| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mvipUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m145| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mquery\u001b[39m({ page\u001b[33m:\u001b[39m \u001b[34m1\u001b[39m\u001b[33m,\u001b[39m perPage\u001b[33m:\u001b[39m \u001b[34m10\u001b[39m })\n    \u001b[90m146| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m147| \u001b[39m\n    \u001b[90m148| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mGET /shops\u001b[2m > \u001b[22m应该支持按店铺类型筛选\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m163:10\u001b[22m\u001b[39m\n    \u001b[90m161| \u001b[39m          shopType\u001b[33m:\u001b[39m \u001b[32m'CLOUD'\u001b[39m\n    \u001b[90m162| \u001b[39m        })\n    \u001b[90m163| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m164| \u001b[39m\n    \u001b[90m165| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mGET /shops\u001b[2m > \u001b[22m应该支持按状态筛选\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m182:10\u001b[22m\u001b[39m\n    \u001b[90m180| \u001b[39m          status\u001b[33m:\u001b[39m \u001b[32m'ACTIVE'\u001b[39m\n    \u001b[90m181| \u001b[39m        })\n    \u001b[90m182| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m183| \u001b[39m\n    \u001b[90m184| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mGET /shops\u001b[2m > \u001b[22m应该支持搜索店铺名称\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m196:10\u001b[22m\u001b[39m\n    \u001b[90m194| \u001b[39m          search\u001b[33m:\u001b[39m \u001b[32m'测试'\u001b[39m\n    \u001b[90m195| \u001b[39m        })\n    \u001b[90m196| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m197| \u001b[39m\n    \u001b[90m198| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mGET /shops/:id\u001b[2m > \u001b[22m不存在的店铺ID应返回404\n\u001b[31m\u001b[1mError\u001b[22m: expected 404 \"Not Found\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m224:10\u001b[22m\u001b[39m\n    \u001b[90m222| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/shops/\u001b[39m\u001b[36m${\u001b[39mfakeId\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m223| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mvipUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m224| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m404\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m225| \u001b[39m\n    \u001b[90m226| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[8/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mPOST /shops/:id/upgrade\u001b[2m > \u001b[22m应该能够申请店铺升级\n\u001b[31m\u001b[1mTypeError\u001b[22m: Cannot read properties of undefined (reading 'id')\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m297:45\u001b[22m\u001b[39m\n    \u001b[90m295| \u001b[39m        })\u001b[33m;\u001b[39m\n    \u001b[90m296| \u001b[39m\n    \u001b[90m297| \u001b[39m      \u001b[35mconst\u001b[39m shopId \u001b[33m=\u001b[39m shopResponse\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mdata\u001b[33m.\u001b[39mid\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m                                            \u001b[31m^\u001b[39m\n    \u001b[90m298| \u001b[39m\n    \u001b[90m299| \u001b[39m      \u001b[35mconst\u001b[39m upgradeData \u001b[33m=\u001b[39m {\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[9/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mPOST /shops/:id/upgrade\u001b[2m > \u001b[22m应该验证升级条件\n\u001b[31m\u001b[1mError\u001b[22m: expected 400 \"Bad Request\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m325:10\u001b[22m\u001b[39m\n    \u001b[90m323| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mvipUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m324| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(upgradeData)\n    \u001b[90m325| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m400\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m326| \u001b[39m\n    \u001b[90m327| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[10/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mPOST /shops/wutong/claim-gift\u001b[2m > \u001b[22m五通店用户应该能够申请赠品\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m418:10\u001b[22m\u001b[39m\n    \u001b[90m416| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mstar2User\u001b[33m.\u001b[39mtokens\u001b[33m.\u001b[39maccessToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m417| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34msend\u001b[39m(orderData)\n    \u001b[90m418| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m419| \u001b[39m\n    \u001b[90m420| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[11/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mPOST /shops/wutong/claim-gift\u001b[2m > \u001b[22m应该验证赠品申请条件\n\u001b[31m\u001b[1mError\u001b[22m: expected 403 \"Forbidden\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m434:10\u001b[22m\u001b[39m\n    \u001b[90m432| \u001b[39m          ]\n    \u001b[90m433| \u001b[39m        })\n    \u001b[90m434| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m403\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m435| \u001b[39m\n    \u001b[90m436| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mfalse\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[12/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mGET /shops/my\u001b[2m > \u001b[22m用户应该能够查看自己的店铺\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m504:10\u001b[22m\u001b[39m\n    \u001b[90m502| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/shops/my`\u001b[39m)\n    \u001b[90m503| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mvipUserToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m504| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m505| \u001b[39m\n    \u001b[90m506| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[13/14]⎯\u001b[22m\u001b[39m\n\n\u001b[41m\u001b[1m FAIL \u001b[22m\u001b[49m api/shops.test.ts\u001b[2m > \u001b[22m店铺管理API测试\u001b[2m > \u001b[22mGET /shops/my\u001b[2m > \u001b[22m没有店铺的用户应该返回空列表\n\u001b[31m\u001b[1mError\u001b[22m: expected 200 \"OK\", got 500 \"Internal Server Error\"\u001b[39m\n\u001b[36m \u001b[2m❯\u001b[22m api/shops.test.ts:\u001b[2m517:10\u001b[22m\u001b[39m\n    \u001b[90m515| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mget\u001b[39m(\u001b[32m`\u001b[39m\u001b[36m${\u001b[39m\u001b[33mAPI_BASE\u001b[39m\u001b[36m}\u001b[39m\u001b[32m/shops/my`\u001b[39m)\n    \u001b[90m516| \u001b[39m        \u001b[33m.\u001b[39m\u001b[35mset\u001b[39m(\u001b[32m'Authorization'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`Bearer \u001b[39m\u001b[36m${\u001b[39mnewUser\u001b[33m.\u001b[39mtokens\u001b[33m.\u001b[39maccessToken\u001b[36m}\u001b[39m\u001b[32m`\u001b[39m)\n    \u001b[90m517| \u001b[39m        \u001b[33m.\u001b[39m\u001b[34mexpect\u001b[39m(\u001b[34m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[90m   | \u001b[39m         \u001b[31m^\u001b[39m\n    \u001b[90m518| \u001b[39m\n    \u001b[90m519| \u001b[39m      \u001b[34mexpect\u001b[39m(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39m\u001b[34mtoBe\u001b[39m(\u001b[35mtrue\u001b[39m)\u001b[33m;\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertStatus ../node_modules/supertest/lib/test.js:\u001b[2m309:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m ../node_modules/supertest/lib/test.js:\u001b[2m365:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test._assertFunction ../node_modules/supertest/lib/test.js:\u001b[2m342:13\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Test.assert ../node_modules/supertest/lib/test.js:\u001b[2m195:23\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m localAssert ../node_modules/supertest/lib/test.js:\u001b[2m138:14\u001b[22m\u001b[39m\n\u001b[90m \u001b[2m❯\u001b[22m Server.<anonymous> ../node_modules/supertest/lib/test.js:\u001b[2m152:11\u001b[22m\u001b[39m\n\n\u001b[31m\u001b[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[14/14]⎯\u001b[22m\u001b[39m\n\n",
  "endTime": "2025-12-09T12:11:04.001Z",
  "duration": 5417
}